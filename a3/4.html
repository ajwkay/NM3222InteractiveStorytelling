<!DOCTYPE HTML>
<html>

<!-- HEADER -->
<head>

<meta charset="UTF-8">

<title>Memoirs of a Withered Rose</title>

<script type="bitsyGameData" id="exportedGameData">
Memoirs of a Withered Rose

# BITSY VERSION 6.1

! ROOM_FORMAT 1

PAL 0
NAME Day
116,116,103
158,148,129
255,171,151

PAL 2
NAME Night
1,19,74
134,113,195
172,181,255

PAL 3
110,101,130
176,178,207
147,148,255

ROOM 0
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,56,44
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,56,44
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,57,58
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
cy,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
0,0,0,7b,7b,7b,7b,77,7b,a,a,a,a,a,a,a
0,0,0,7a,77,77,7a,7a,7a,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7d,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58
59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59
NAME Junction
EXT 13,0 1 13,15 FX slide_u
EXT 12,0 1 12,15 FX slide_u
EXT 11,0 1 11,15 FX slide_u
EXT 10,0 1 10,15 FX slide_u
EXT 9,0 1 9,15 FX slide_u
EXT 0,0 1 0,15 FX slide_u
EXT 1,0 1 1,15 FX slide_u
EXT 2,0 1 2,15 FX slide_u
EXT 15,12 14 0,12 FX slide_r
EXT 15,11 14 0,11 FX slide_r
EXT 15,10 14 0,10 FX slide_r
EXT 15,9 14 0,9 FX slide_r
EXT 15,8 14 0,8 FX slide_r
EXT 15,7 14 0,7 FX slide_r
EXT 15,6 14 0,6 FX slide_r
EXT 15,5 14 0,5 FX slide_r
EXT 15,4 14 0,4 FX slide_r
EXT 15,3 14 0,3 FX slide_r
EXT 0,8 18 15,8 FX fade_b
EXT 0,7 18 15,7 FX fade_b
PAL 0

ROOM 1
3j,3j,3j,3g,3g,3g,3g,3g,3g,3g,3j,au,aw,ax,3j,3j
4z,4z,4z,4z,7o,7p,7q,7r,4z,aq,ar,at,av,ay,b1,b3
4z,4z,4z,7m,7n,7k,7k,7s,7t,ap,ao,as,b8,az,b0,b2
4z,4z,4z,7l,7k,7k,7k,7k,7u,an,9x,b7,b5,b6,a3,b4
4z,4z,4z,7i,77,77,77,77,7v,9u,9v,9w,a0,a1,a4,a7
7w,7w,7w,7x,77,77,77,77,76,9t,9e,9j,am,9j,a5,a6
78,78,78,79,77,77,77,77,76,9r,9q,al,9j,al,a9,a8
7c,78,78,79,77,77,77,77,76,9s,9p,ah,aj,ai,ab,aa
7c,78,78,79,77,77,77,77,76,a,9o,ag,ak,af,ac,bc
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,bb
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,bb
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,ba
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,9n,3s
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,3t,14
NAME Riverside
EXT 0,5 b 15,5 FX slide_l
EXT 0,6 b 15,6 FX slide_l
EXT 15,13 3 0,13 FX slide_r
EXT 15,12 3 0,12 FX slide_r
EXT 9,15 0 9,0 FX slide_d
EXT 10,15 0 10,0 FX slide_d
EXT 11,15 0 11,0 FX slide_d
EXT 12,15 0 12,0 FX slide_d
EXT 13,15 0 13,0 FX slide_d
EXT 2,15 0 2,0 FX slide_d
EXT 1,15 0 1,0 FX slide_d
EXT 0,15 0 0,0 FX slide_d
EXT 12,8 16 7,15 FX fade_w
PAL 0

ROOM 3
3g,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,41
3i,3i,3i,3i,44,44,44,44,44,44,44,3i,3i,3i,47,48
3i,3i,3i,3i,44,4s,4l,4l,4l,4x,4z,3i,3i,44,49,42
3i,3i,3i,3i,4t,4u,50,50,50,4y,4w,3i,44,4a,4b,42
3h,21,22,1y,4f,4q,4m,4m,4m,4v,4k,2t,2v,2x,3i,42
3p,1z,24,23,1i,4e,53,4z,53,4i,2y,2s,2u,2w,3i,42
a,1q,1p,2n,25,4c,4z,52,4z,4h,30,3f,1q,1p,46,42
a,1r,1s,2q,2r,a,a,a,a,a,30,3e,1r,1s,46,42
a,1r,1s,2p,2o,a,a,a,a,a,3c,3d,1r,1s,46,42
a,1w,1v,2n,25,a,a,a,a,a,30,3f,1w,1v,46,42
a,27,2a,26,25,a,a,a,a,a,30,31,34,35,51,42
b9,28,29,2b,2i,a,a,a,a,a,3b,32,33,36,44,42
a,a,2l,2m,2j,a,a,a,a,a,37,38,39,a,44,42
3m,3m,3m,a,a,a,a,a,a,a,a,a,3r,3r,45,43
18,18,18,3q,a,a,a,a,a,a,3u,3s,18,18,18,18
1l,1l,1l,1a,3w,a,a,a,a,a,3t,14,1l,1l,1l,1l
NAME Residence A
EXT 7,6 4 9,12 FX fade_b
EXT 5,15 14 5,0 FX slide_d
EXT 6,15 14 6,0 FX slide_d
EXT 7,15 14 7,0 FX slide_d
EXT 8,15 14 8,0 FX slide_d
EXT 9,15 14 9,0 FX slide_d
EXT 0,13 1 15,13 FX slide_l
EXT 0,12 1 15,12 FX slide_l
PAL 0

ROOM 4
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,o,0,0,0,0,0,0,0,0,0,0,0
0,0,0,dv,ev,e0,ee,ee,ee,ee,ee,ee,ef,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,du,dm,dm,dm,dm,e3,a,a,dz,dn,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME House A
EXT 9,12 3 7,6 FX fade_b
EXT 10,12 3 7,6 FX fade_w
EXT 4,3 1e 4,12
PAL 3

ROOM 6
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,dv,ev,e0,ee,ee,ee,ee,ee,ee,ef,0,0,0
0,0,0,dv,0,0,0,ez,f0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,du,dm,dm,dm,dm,e3,a,a,e2,dn,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME House B
EXT 9,12 14 1,2
EXT 10,12 14 1,2 FX fade_w
PAL 3

ROOM 8
1a,3g,3g,3g,3g,3g,3g,3g,3g,3g,3g,3g,3g,3g,3g,41
f1,a,a,a,a,a,a,a,a,a,a,a,a,a,a,42
f1,a,a,a,a,a,a,a,a,a,a,a,a,a,a,42
a,a,a,5g,5e,5c,5a,5a,5b,5d,5f,a,a,a,a,42
a,a,5j,5h,f4,f3,f2,f2,f2,f2,5i,5k,a,a,a,42
a,a,5l,f4,f2,f4,f2,f3,f4,f2,f2,5m,a,a,a,42
a,5q,5n,f4,f3,f3,f2,f4,f2,f4,f3,5p,5r,a,a,cx
a,5s,f3,f4,f3,f3,f2,f4,f4,f3,f2,f2,5t,a,a,a
a,5u,f3,f2,f3,f3,f2,f3,f4,f2,f2,f3,5v,a,a,a
a,5w,5z,f4,f2,f4,f2,f3,f2,f2,f2,61,5y,a,a,cw
a,a,75,f2,f2,f4,f3,f3,f4,f4,f4,60,a,a,a,42
a,a,62,64,f4,f4,f2,f4,f4,f4,65,63,a,a,a,42
a,a,a,66,68,6a,6c,6c,6b,69,67,a,a,a,a,42
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,86
58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,cv
59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,cu
NAME City Gates
ITM 3 14,13
ITM 9 1,1
EXT 0,12 14 15,12 FX slide_l
EXT 0,11 14 15,11 FX slide_l
EXT 0,10 14 15,10 FX slide_l
EXT 0,9 14 15,9 FX slide_l
EXT 0,8 14 15,8 FX slide_l
EXT 0,7 14 15,7 FX slide_l
EXT 0,6 14 15,6 FX slide_l
EXT 0,5 14 15,5 FX slide_l
EXT 0,4 14 15,4 FX slide_l
EXT 0,3 14 15,3 FX slide_l
PAL 0

ROOM 12
m,q,z,t,s,s,r,x,q,w,m,l,l,l,l,l
q,s,t,s,s,y,s,r,v,s,w,m,j,j,j,j
l,l,l,l,l,0,l,l,l,l,l,j,j,j,j,j
k,j,j,j,j,0,m,0,0,0,0,0,m,j,j,j
k,j,j,j,j,0,0,0,l,l,l,0,0,m,j,j
k,j,j,j,j,l,l,l,l,l,l,l,0,m,j,j
k,j,j,j,0,0,0,0,0,0,0,0,0,m,j,j
k,j,0,0,0,m,m,0,0,0,0,0,0,m,j,j
k,j,0,m,l,j,j,l,l,l,l,l,l,j,j,j
k,j,0,m,j,j,j,j,0,0,m,j,j,j,j,j
k,j,0,0,j,j,j,j,0,0,0,0,0,0,m,j
k,j,0,m,j,j,j,0,0,m,l,0,0,0,m,j
k,j,0,0,0,0,m,0,0,m,j,l,l,0,0,m
k,j,l,0,0,0,m,0,0,m,j,j,j,0,0,m
k,j,j,l,l,0,0,0,0,m,j,j,0,0,0,0
k,j,j,j,j,l,l,l,l,j,j,j,0,0,0,0
NAME Forrest
EXT 13,15 v 13,1
EXT 15,15 v 15,1
PAL 2

ROOM 13
s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s
s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s
s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s
s,s,s,0,0,0,0,0,0,0,0,0,0,s,s,s
s,s,s,0,0,0,0,0,0,0,0,0,0,s,s,s
s,s,s,0,0,0,0,0,0,0,0,0,0,s,s,s
s,s,s,0,0,0,0,0,0,0,0,0,0,s,s,s
s,s,s,0,0,0,0,0,0,0,0,0,0,s,s,s
s,s,s,0,0,0,0,0,0,0,0,0,0,s,s,s
s,s,s,0,0,0,0,0,0,0,0,0,0,s,s,s
s,s,s,0,0,0,0,0,0,0,0,0,0,s,s,s
s,s,s,0,0,0,0,0,0,0,0,0,0,s,s,s
s,s,s,0,0,0,0,0,0,0,0,0,0,s,s,s
s,s,s,0,0,0,0,0,0,0,0,0,0,s,s,s
s,s,s,s,s,s,s,0,s,s,s,s,s,s,s,s
s,s,s,s,s,s,s,0,s,s,s,s,s,s,s,s
NAME Tomb
ITM j 7,14
END 0 6,4
END 0 7,3
END 0 8,4
END 0 7,5
PAL 3

ROOM 14
4z,4z,53,4z,3w,a,a,a,a,a,56,4z,53,4z,4z,4z
4z,4z,4z,4z,a,a,a,a,a,a,56,4z,4z,4z,4z,4z
4g,52,4g,4g,a,a,a,a,a,a,57,4g,4g,4g,54,4g
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58
59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59
NAME Marketplace
EXT 5,0 3 5,15 FX slide_u
EXT 6,0 3 6,15 FX slide_u
EXT 7,0 3 7,15 FX slide_u
EXT 8,0 3 8,15 FX slide_u
EXT 9,0 3 9,15 FX slide_u
EXT 1,2 6 9,12 FX fade_b
EXT 0,3 0 15,3 FX slide_l
EXT 0,4 0 15,4 FX slide_l
EXT 0,5 0 15,5 FX slide_l
EXT 0,6 0 15,6 FX slide_l
EXT 0,7 0 15,7 FX slide_l
EXT 0,8 0 15,8 FX slide_l
EXT 0,9 0 15,9 FX slide_l
EXT 0,10 0 15,10 FX slide_l
EXT 0,11 0 15,11 FX slide_l
EXT 0,12 0 15,12 FX slide_l
EXT 15,12 8 0,12 FX slide_r
EXT 15,11 8 0,11 FX slide_r
EXT 15,10 8 0,10 FX slide_r
EXT 15,9 8 0,9 FX slide_r
EXT 15,8 8 0,8 FX slide_r
EXT 15,7 8 0,7 FX slide_r
EXT 15,6 8 0,6 FX slide_r
EXT 15,5 8 0,5 FX slide_r
EXT 15,4 8 0,4 FX slide_r
EXT 15,3 8 0,3 FX slide_r
PAL 0

ROOM 15
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,8p,8q,8q,8q,8q,8q,8q,8q,db
0,0,0,0,0,0,0,8o,8t,0,0,0,0,0,0,d9
0,0,0,0,0,0,0,8o,8s,8v,8w,9f,9g,8w,8x,d9
0,0,0,0,0,0,0,8r,8s,92,9h,9c,9d,9i,8y,d9
0,0,0,0,0,0,0,8o,8s,92,93,96,99,eg,8y,d9
0,0,0,0,0,0,0,8o,8s,92,9l,98,97,9k,8y,d9
0,0,0,0,0,0,0,8r,8s,92,95,9a,9b,94,8y,d9
0,0,0,0,0,0,0,8o,8s,91,90,90,90,90,8z,d9
0,0,0,0,0,0,0,8o,8s,0,0,0,0,0,0,d9
NAME Living Room
ITM a 14,8
EXT 8,13 b 8,13
EXT 9,15 18 9,0 FX slide_d
EXT 10,15 18 10,0 FX slide_d
EXT 11,15 18 11,0 FX slide_d
EXT 12,15 18 12,0 FX slide_d
EXT 13,15 18 13,0 FX slide_d
EXT 14,15 18 14,0 FX slide_d
EXT 8,15 18 8,0 FX slide_d
EXT 8,10 b 8,10
PAL 3

ROOM 16
bk,c8,c8,c8,c8,c8,c8,c8,c8,c8,c8,c8,c8,c8,c8,bj
bq,bp,cc,cd,ce,cf,cc,cd,ce,cf,cc,cd,ce,cf,bt,bu
8o,bo,cb,ca,ch,cg,cb,ca,ch,cg,cb,ca,ch,cg,bs,bf
8o,bn,bw,c7,c9,bv,bv,c7,c9,bv,bv,c7,c9,bx,br,bf
8o,4z,by,c0,c0,c0,c0,c0,c0,c0,c0,c0,c0,bz,4z,bf
8o,4z,c1,c2,c4,c3,c5,c2,c3,c4,c2,c4,c2,c6,4z,bf
8o,4z,0,0,0,0,0,0,0,0,0,0,0,0,4z,bf
8o,4z,0,ci,cj,ck,0,0,0,0,ci,cj,ck,0,4z,bf
8o,4z,0,ci,cj,ck,0,0,0,0,ci,cj,ck,0,4z,bf
8o,4z,0,ci,cj,ck,0,0,0,0,ci,cj,ck,0,4z,bf
8o,4z,0,ci,cj,ck,0,0,0,0,ci,cj,ck,0,4z,bf
8o,4z,0,ci,cj,ck,0,0,0,0,ci,cj,ck,0,4z,bf
8o,4z,0,ci,cj,ck,0,0,0,0,ci,cj,ck,0,4z,bf
8o,4z,0,0,0,0,0,0,0,0,0,0,0,0,4z,bf
8o,bl,4z,4z,4z,cm,0,0,0,bm,4z,4z,4z,4z,bm,bf
bi,bh,bh,bh,cl,cn,cr,cq,ct,co,cp,bh,bh,bh,bh,bg
NAME Church
ITM 8 2,13
EXT 6,15 1 12,9 FX fade_w
EXT 7,15 1 12,9
EXT 8,15 1 12,9 FX fade_w
PAL 0

ROOM 18
bk,d3,d3,d3,d3,d3,d3,d4,dl,0,0,0,0,0,0,d9
d2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d9
d2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d9
ep,0,0,0,dh,dc,dj,0,0,0,0,0,0,0,0,d9
eq,a,a,a,er,0,dk,0,0,0,0,0,0,0,0,d9
0,o,o,o,0,0,d2,0,0,0,0,0,0,0,0,d9
0,0,0,0,0,0,d2,0,0,0,0,0,0,0,0,df
0,0,0,0,0,0,d2,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,d2,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,d2,0,0,0,0,0,0,0,0,de
0,0,0,0,0,0,d2,0,0,0,0,0,0,0,0,d9
0,0,0,0,0,0,d2,0,0,0,0,0,0,0,0,d9
bk,d3,d3,d3,d3,d3,d4,0,0,0,0,0,0,0,0,d9
d2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d9
d2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d9
da,dc,dc,dc,dc,dc,dc,dc,dc,dc,di,0,0,dh,dc,dd
NAME Castle Main
EXT 9,0 15 9,15 FX slide_u
EXT 14,0 15 14,15 FX slide_u
EXT 10,0 15 10,15 FX slide_u
EXT 11,0 15 11,15 FX slide_u
EXT 12,0 15 12,15 FX slide_u
EXT 13,0 15 13,15 FX slide_u
EXT 8,0 15 8,15 FX slide_u
EXT 12,15 19 11,0 FX fade_b
EXT 11,15 19 10,0 FX fade_b
EXT 15,7 0 0,7 FX fade_w
EXT 15,8 0 0,8 FX fade_w
EXT 2,4 1a 2,4
EXT 3,4 1a 3,4
EXT 1,4 1a 1,4
PAL 3

ROOM 19
0,0,0,0,0,0,0,0,0,dv,dq,dr,dt,dq,dr,do
0,0,0,0,0,0,0,0,0,dv,dq,dr,dt,dq,dr,do
0,0,0,0,0,0,0,0,0,dv,dq,dr,ds,dq,dr,do
0,0,0,0,0,0,0,0,0,dv,0,0,0,0,0,do
0,0,0,0,0,0,0,0,0,dv,0,0,0,0,0,do
0,0,0,0,0,0,0,0,0,du,dm,dm,dm,dm,dm,dn
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME Staircase
EXT 13,0 e 14,11 FX fade_b
EXT 14,0 e 15,11 FX fade_w
EXT 10,0 18 11,15 FX fade_w
EXT 11,0 18 12,15 FX fade_w
PAL 3

ROOM b
81,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j
8a,8b,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z
82,8c,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z
82,8d,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z
82,8e,8f,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z
82,44,8n,7w,7w,7w,7w,7w,7w,7w,7w,7w,7w,7w,7w,7w
82,44,8k,78,78,78,78,78,78,78,78,78,78,78,78,78
82,44,8k,78,78,78,8m,87,88,88,88,88,88,88,88,88
82,44,8k,78,78,78,8m,86,89,89,89,89,89,89,89,89
82,44,8k,78,78,0,8m,86,89,89,89,89,89,89,89,89
82,44,8k,7e,7e,78,8m,86,9m,89,89,89,89,89,89,89
82,44,8k,7e,7e,78,8m,86,89,89,89,89,89,89,89,89
82,44,8k,7e,78,78,8m,86,89,89,89,89,89,89,89,89
82,44,8k,78,78,78,8m,86,9m,89,89,89,89,89,89,89
82,8g,8l,8h,8h,8h,8j,8i,89,89,89,89,89,89,89,89
83,84,84,84,84,84,84,85,89,89,89,89,89,89,89,89
NAME Garden
ITM 6 2,12
EXT 15,5 1 0,5 FX slide_r
EXT 15,6 1 0,6 FX slide_r
EXT 8,13 15 8,13
EXT 8,10 15 8,10
PAL 0

ROOM e
e8,e9,e9,e9,e9,e9,e9,e9,e9,e9,e9,e9,e9,e9,e9,ea
e7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,eb
e7,0,dz,dm,dm,e1,0,e2,dm,dm,dm,dm,dm,e3,0,eb
e7,0,do,0,0,0,o,0,0,0,0,0,0,e4,0,eb
e7,0,do,0,0,0,0,0,0,0,0,0,o,0,0,eb
e7,0,do,0,0,0,0,0,0,0,0,0,0,e3,0,eb
e7,0,do,0,0,0,0,0,0,0,0,0,0,dv,0,eb
e7,0,do,0,0,0,0,0,0,0,0,0,0,dv,0,eb
e7,0,do,0,0,0,0,0,0,0,0,0,0,dv,0,eb
e7,0,e0,0,0,0,0,0,0,0,0,0,0,dv,0,eb
e7,0,0,o,0,0,0,0,0,0,0,0,0,dv,0,eb
e7,0,dz,0,0,0,0,0,0,0,0,0,0,o,ec,ed
e7,0,do,0,0,0,0,0,0,0,0,0,0,0,o,o
e7,0,do,0,0,0,0,0,0,0,0,0,0,0,0,0
e7,0,do,0,0,0,0,0,0,0,0,0,0,0,0,0
e6,e5,do,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME Castle Upstairs Corridor
EXT 13,4 f 13,4
EXT 6,2 j 6,2
EXT 2,10 h 2,10
EXT 14,11 19 13,0 FX fade_w
EXT 15,11 19 14,0 FX fade_b
PAL 3

ROOM f
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,dy,ee,ee,ee,ee,ef,0,0
0,0,0,0,0,0,0,0,dv,a,a,0,0,e0,0,0
0,0,0,0,0,0,0,0,dv,0,0,0,0,0,o,0
0,0,0,0,0,0,0,0,dv,0,0,0,0,dz,0,0
0,0,0,0,0,0,0,0,dv,0,0,0,0,do,0,0
0,0,0,0,0,0,0,0,dv,a,0,0,0,do,0,0
0,0,0,0,0,0,0,0,dv,a,a,0,0,do,0,0
0,0,0,0,0,0,0,0,dv,0,0,0,0,do,0,0
0,0,0,0,0,0,0,0,dv,0,0,a,a,do,0,0
0,0,0,0,0,0,0,0,du,dm,dm,dm,dm,dn,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME Castle Room 1
ITM 7 9,10
EXT 13,4 e 13,4
PAL 3

ROOM h
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,dy,ee,ee,ee,ee,ee,ef,0,0,0,0,0,0,0
0,0,e4,0,0,0,a,a,do,0,0,0,0,0,0,0
0,o,0,0,0,0,0,0,do,0,0,0,0,0,0,0
0,0,e1,0,0,0,0,0,e0,ee,ee,ee,ef,0,0,0
0,0,dv,0,0,0,0,0,0,0,0,0,do,0,0,0
0,0,dv,0,0,0,0,0,0,0,0,0,do,0,0,0
0,0,dv,0,0,0,0,0,0,0,0,0,do,0,0,0
0,0,du,dm,dm,dm,dm,dm,dm,dm,dm,dm,dn,0,0,0
NAME Castle Room 3
EXT 2,10 e 2,10
PAL 3

ROOM j
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,o,0,0,0,0,0,0,0,0,0
0,0,dy,ee,ee,e4,0,e0,ef,0,0,0,0,0,0,0
0,0,dv,a,a,0,0,0,do,0,0,0,0,0,0,0
0,0,dv,0,0,0,0,0,do,0,0,0,0,0,0,0
0,0,dv,0,0,0,0,a,do,0,0,0,0,0,0,0
0,0,dv,0,0,0,a,a,do,0,0,0,0,0,0,0
0,0,dv,a,a,0,0,0,do,0,0,0,0,0,0,0
0,0,du,dm,dm,dm,dm,dm,dn,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME Castle Room 2
EXT 6,2 e 6,2
PAL 3

ROOM 1a
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
em,o,o,o,0,0,0,0,0,0,0,0,0,0,0,0
eo,a,a,a,ei,ej,ek,0,0,0,0,0,0,0,0,0
eo,a,a,a,ey,ew,do,0,0,0,0,0,0,0,0,0
eo,a,a,a,a,a,do,0,0,0,0,0,0,0,0,0
eo,a,a,a,a,a,do,0,0,0,0,0,0,0,0,0
eo,a,a,a,a,a,do,0,0,0,0,0,0,0,0,0
eo,a,a,a,a,a,do,0,0,0,0,0,0,0,0,0
eo,a,a,a,a,a,do,0,0,0,0,0,0,0,0,0
eo,a,a,a,a,a,do,0,0,0,0,0,0,0,0,0
dm,dm,dm,dm,dm,dm,dn,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME Balcony
EXT 2,4 18 2,4
EXT 3,4 18 3,4
EXT 1,4 18 1,4
PAL 0

ROOM 1c
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,dy,ee,ee,ee,ee,ee,ee,ee,ee,ef,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,ev,dz,dm,dm,dm,dm,dm,dm,es,0,0,0
0,0,0,0,o,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME A Upstairs
ITM 2 4,11
EXT 4,12 4 4,3
PAL 3

ROOM 1d
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,dy,ee,ee,ee,ee,ee,ee,ee,ee,ef,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,du,dm,dm,dm,dm,dm,e1,ev,e2,dn,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME B Upstairs
ITM c 5,4
EXT 10,12 1t 4,3
PAL 2

ROOM 1e
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,dy,ee,ee,ee,ee,ee,ee,ee,ee,ef,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,ev,dz,dm,dm,dm,dm,dm,dm,es,0,0,0
0,0,0,0,o,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME A Upstairs Copy
EXT 4,12 4 4,3
EXT 10,4 1m 10,4
EXT 10,5 1m 10,5
EXT 11,6 1m 11,6
PAL 3

ROOM 1m
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,dy,ee,ee,ee,ee,ee,ee,ee,ee,ef,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,ev,dz,dm,dm,dm,dm,dm,dm,es,0,0,0
0,0,0,0,o,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME Room Upstairs Night
EXT 4,12 1o 4,3
PAL 2

ROOM 1n
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,dy,ee,ee,ee,ee,ee,ee,ee,ee,ef,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,o,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,ev,dz,dm,dm,dm,dm,dm,dm,es,0,0,0
0,0,0,0,o,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME Room Upstairs Night Copy
EXT 4,12 1o 4,3
EXT 10,4 1c 10,4
EXT 10,5 1c 10,5
EXT 11,6 1c 11,6
PAL 2

ROOM 1o
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,o,0,0,0,0,0,0,0,0,0,0,0
0,0,0,dv,ev,e0,ee,ee,ee,ee,ee,ee,ef,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,du,dm,dm,dm,dm,e3,a,a,dz,dn,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME House A Night
EXT 9,12 1p 7,7
EXT 10,12 1p 7,6
EXT 4,3 1n 4,12
PAL 2

ROOM 1p
3g,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,41
3i,3i,3i,3i,44,44,44,44,44,44,44,3i,3i,3i,47,48
3i,3i,3i,3i,44,4s,4l,4l,4l,4x,4z,3i,3i,44,49,42
3i,3i,3i,3i,4t,4u,50,50,50,4y,4w,3i,44,4a,4b,42
3h,21,22,1y,4f,4q,4m,4m,4m,4v,4k,2t,2v,2x,3i,42
3p,1z,24,23,1i,4e,53,4z,53,4i,2y,2s,2u,2w,3i,42
a,1q,1p,2n,25,4c,4z,52,4z,4h,30,3f,1q,1p,46,42
a,1r,1s,2q,2r,a,a,a,a,a,30,3e,1r,1s,46,42
a,1r,1s,2p,2o,a,a,a,a,a,3c,3d,1r,1s,46,42
a,1w,1v,2n,25,a,a,a,a,a,30,3f,1w,1v,46,42
a,27,2a,26,25,a,a,a,a,a,30,31,34,35,51,42
b9,28,29,2b,2i,a,a,a,a,a,3b,32,33,36,44,42
a,a,2l,2m,2j,a,a,a,a,a,37,38,39,a,44,42
3m,3m,3m,a,a,a,a,a,a,a,a,a,3r,3r,45,43
18,18,18,3q,a,a,a,a,a,a,3u,3s,18,18,18,18
1l,1l,1l,1a,3w,a,a,a,a,a,3t,14,1l,1l,1l,1l
NAME Residence Night
EXT 7,6 1o 9,12
EXT 5,15 1q 5,1
EXT 6,15 1q 6,1
EXT 7,15 1q 7,1
EXT 8,15 1q 8,1
EXT 9,15 1q 9,1
EXT 0,13 1u 15,13
EXT 0,12 1u 15,12
PAL 2

ROOM 1q
4z,4z,53,4z,3w,a,a,a,a,a,56,4z,53,4z,4z,4z
4z,4z,4z,4z,a,a,a,a,a,a,56,4z,4z,4z,4z,4z
4g,52,4g,4g,a,a,a,a,a,a,57,4g,4g,4g,54,4g
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58
59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59
NAME Marketplace Night
EXT 5,0 1p 5,15
EXT 6,0 1p 6,15
EXT 7,0 1p 7,15
EXT 8,0 1p 8,15
EXT 9,0 1p 9,15
EXT 1,2 1t 9,11
EXT 0,3 1r 14,3
EXT 0,4 1r 14,4
EXT 0,5 1r 14,5
EXT 0,6 1r 14,6
EXT 0,7 1r 14,7
EXT 0,8 1r 14,8
EXT 0,9 1r 14,9
EXT 0,10 1r 14,10
EXT 0,11 1r 14,11
EXT 0,12 1r 14,12
EXT 15,12 1s 1,12
EXT 15,11 1s 1,11
EXT 15,10 1s 1,10
EXT 15,9 1s 1,9
EXT 15,8 1s 1,8
EXT 15,7 1s 1,7
EXT 15,6 1s 1,6
EXT 15,5 1s 1,5
EXT 15,4 1s 1,4
EXT 15,3 1s 1,3
PAL 2

ROOM 1r
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,56,44
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,56,44
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,57,58
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
f8,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
f7,0,0,7b,7b,7b,7b,77,7b,a,a,a,a,a,a,a
f7,0,0,7a,77,77,7a,7a,7a,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7d,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58
59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59
NAME Junction Night
EXT 13,0 1u 13,15
EXT 12,0 1u 12,15
EXT 11,0 1u 11,15
EXT 10,0 1u 10,15
EXT 9,0 1u 9,15
EXT 0,0 1u 0,15
EXT 1,0 1u 1,15
EXT 2,0 1u 2,15
EXT 15,12 1q 0,12
EXT 15,11 1q 0,11
EXT 15,10 1q 0,10
EXT 15,9 1q 0,9
EXT 15,8 1q 0,8
EXT 15,7 1q 0,7
EXT 15,6 1q 0,6
EXT 15,5 1q 0,5
EXT 15,4 1q 0,4
EXT 15,3 1q 0,3
PAL 2

ROOM 1s
1a,3g,3g,3g,3g,3g,3g,3g,3g,3g,3g,3g,3g,3g,3g,41
f1,a,a,a,a,a,a,a,a,a,a,a,a,a,a,42
f1,a,a,a,a,a,a,a,a,a,a,a,a,a,a,42
a,a,a,5g,5e,5c,5a,5a,5b,5d,5f,a,a,a,a,42
a,a,5j,5h,f2,f2,f4,f3,f2,f2,5i,5k,a,a,a,42
a,a,5l,f2,f4,f2,f4,f2,f2,f2,f2,5m,a,a,a,42
a,5q,5n,f3,f2,f4,f3,f3,f3,f4,f2,f2,5r,a,a,cx
a,5s,f2,f2,f4,f2,f4,f2,f2,f4,f3,f2,5t,a,a,a
a,5u,f2,f4,f3,f2,f3,f2,f3,f3,f2,f3,5v,a,a,a
a,5w,5z,f3,f2,f2,f3,f2,f2,f4,f2,61,5y,a,a,cw
a,a,75,f2,f3,f2,f3,f4,f3,f2,f2,60,a,a,a,42
a,a,62,6w,f2,f2,f2,f2,f3,f2,65,63,a,a,a,42
a,a,a,66,68,6a,6c,74,73,69,67,a,a,a,a,42
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,86
58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,cv
59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,cu
NAME City Gates Night
EXT 0,12 1q 15,12
EXT 0,11 1q 15,11
EXT 0,10 1q 15,10
EXT 0,9 1q 15,9
EXT 0,8 1q 15,8
EXT 0,7 1q 15,7
EXT 0,6 1q 15,6
EXT 0,5 1q 15,5
EXT 0,4 1q 15,4
EXT 0,3 1q 15,3
PAL 2

ROOM 1t
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,dv,ev,e0,ee,ee,ee,ee,ee,ee,ef,0,0,0
0,0,0,dv,0,0,0,ez,f0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,dv,0,0,0,0,0,0,0,0,do,0,0,0
0,0,0,du,dm,dm,dm,dm,e3,a,a,e2,dn,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
NAME House B Night
EXT 9,12 1q 1,2
EXT 10,12 1q 1,2
EXT 4,3 1d 10,12
PAL 2

ROOM 1u
3j,3j,3j,3g,3g,3g,3g,3g,3g,3g,3j,au,aw,ax,3j,3j
4z,4z,4z,4z,7o,7p,7q,7r,4z,aq,ar,at,av,ay,b1,b3
4z,4z,4z,7m,7n,7k,7k,7s,7t,ap,ao,as,b8,az,b0,b2
4z,4z,4z,7l,7k,7k,7k,7k,7u,an,9x,b7,b5,b6,a3,b4
4z,4z,4z,7i,77,77,77,77,7v,9u,9v,9w,a0,a1,a4,a7
7w,7w,7w,7x,77,77,77,77,76,9t,9e,9j,am,9j,a5,a6
78,78,78,79,77,77,77,77,76,9r,9q,al,9j,al,a9,a8
7c,78,78,79,77,77,77,77,76,9s,9p,ah,aj,ai,ab,aa
7c,78,78,79,77,77,77,77,76,a,9o,ag,ak,af,ac,bc
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,bb
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,bb
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,ba
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,a,a
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,9n,3s
7c,78,78,79,77,77,77,77,76,a,a,a,a,a,3t,14
NAME Riverside Night
EXT 15,13 1p 1,13
EXT 15,12 1p 1,12
EXT 9,15 1r 9,1
EXT 10,15 1r 10,1
EXT 11,15 1r 11,1
EXT 12,15 1r 12,1
EXT 13,15 1r 13,1
EXT 2,15 1r 2,1
EXT 1,15 1r 1,1
EXT 0,15 1r 0,1
EXT 12,8 1v 7,14
EXT 0,5 1w 15,5 FX slide_l
EXT 0,6 1w 15,6 FX slide_l
PAL 2

ROOM 1v
bk,c8,c8,c8,c8,c8,c8,c8,c8,c8,c8,c8,c8,c8,c8,bj
bq,bp,cc,cd,ce,cf,cc,cd,ce,cf,cc,cd,ce,cf,bt,bu
8o,bo,cb,ca,ch,cg,cb,ca,ch,cg,cb,ca,ch,cg,bs,bf
8o,bn,bw,c7,c9,bv,bv,c7,c9,bv,bv,f9,fa,bx,br,bf
8o,4z,by,c0,c0,c0,c0,c0,c0,c0,c0,c0,c0,bz,4z,bf
8o,4z,c1,c2,c4,c3,c5,c2,c3,c4,c2,c4,c2,c6,4z,bf
8o,4z,0,0,0,0,0,0,0,0,0,0,0,0,4z,bf
8o,4z,0,ci,cj,ck,0,0,0,0,ci,cj,ck,0,4z,bf
8o,4z,0,ci,cj,ck,0,0,0,0,ci,cj,ck,0,4z,bf
8o,4z,0,ci,cj,ck,0,0,0,0,ci,cj,ck,0,4z,bf
8o,4z,0,ci,cj,ck,0,0,0,0,ci,cj,ck,0,4z,bf
8o,4z,0,ci,cj,ck,0,0,0,0,ci,cj,ck,0,4z,bf
8o,4z,0,ci,cj,ck,0,0,0,0,ci,cj,ck,0,4z,bf
8o,4z,0,0,0,0,0,0,0,0,0,0,0,0,4z,bf
8o,bl,4z,4z,4z,cm,0,0,0,bm,4z,4z,4z,4z,bm,bf
bi,bh,bh,bh,cl,cn,cr,cq,ct,co,cp,bh,bh,bh,bh,bg
NAME Church Night
EXT 6,15 1u 12,8
EXT 7,15 1u 12,8
EXT 8,15 1u 12,8
EXT 11,3 1x 13,14
EXT 12,3 1x 14,14
EXT 11,3 1x 13,14
PAL 2

ROOM 1w
81,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j,3j
8a,8b,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z
82,8c,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z
82,8d,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z
82,8e,8f,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z,4z
82,44,8n,7w,7w,7w,7w,7w,7w,7w,7w,7w,7w,7w,7w,7w
82,44,8k,78,78,78,78,78,78,78,78,78,78,78,78,78
82,44,8k,78,78,78,8m,87,88,88,88,88,88,88,88,88
82,44,8k,78,78,78,8m,86,89,89,89,89,89,89,89,89
82,44,8k,78,78,0,8m,86,89,89,89,89,89,89,89,89
82,44,8k,7e,7e,78,8m,86,9m,89,89,89,89,89,89,89
82,44,8k,7e,7e,78,8m,86,89,89,89,89,89,89,89,89
82,44,8k,7e,78,78,8m,86,89,89,89,89,89,89,89,89
82,44,8k,78,78,78,8m,86,9m,89,89,89,89,89,89,89
82,8g,8l,8h,8h,8h,8j,8i,89,89,89,89,89,89,89,89
83,84,84,84,84,84,84,85,89,89,89,89,89,89,89,89
NAME Garden Night
EXT 8,13 15 8,13
EXT 8,10 15 8,10
EXT 15,5 1u 0,5 FX slide_r
EXT 15,6 1u 0,6 FX slide_r
PAL 2

ROOM 1x
m,l,k,7g,7k,7k,7k,7k,7f,m,0,0,m,l,l,l
m,k,k,7g,7k,7k,7k,7k,7f,0,0,0,k,j,j,j
m,k,k,7g,7k,7k,7k,7k,7f,0,0,0,k,j,j,j
m,k,k,7g,7k,7k,7k,7k,7f,0,0,0,0,k,j,j
m,k,k,7g,7k,7k,7k,7k,7f,0,0,0,0,k,j,j
m,j,0,7g,7k,7k,7k,7k,7f,0,0,0,0,k,j,j
m,j,0,7g,7k,7k,7k,7k,7f,0,0,0,0,k,j,j
m,j,0,7g,7k,7k,7k,7k,7f,0,0,0,0,k,j,j
m,0,0,7g,7k,7k,7k,7k,7f,0,0,0,0,k,j,j
0,0,0,7g,7k,7k,7k,7k,7f,0,0,0,0,0,k,j
0,0,0,7g,7k,7k,7k,7k,7f,0,0,0,0,0,k,j
0,0,0,7g,7k,7k,7k,7k,7f,0,0,0,0,0,k,j
0,0,0,7g,7k,7k,7k,7k,7f,0,0,0,0,0,0,j
0,0,0,7g,7k,7k,7k,7k,7f,0,0,0,0,0,0,j
58,58,58,58,58,58,58,58,58,58,58,58,58,f5,f6,58
59,59,59,59,59,59,59,59,59,59,59,59,59,59,59,59
NAME Forest Entrance
EXT 14,14 1v 12,3
EXT 13,14 1v 11,3
EXT 10,0 1y 13,15
EXT 11,0 1y 14,15
PAL 2

ROOM 1y
j,q,z,t,s,s,r,x,q,w,l,l,l,l,l,j
q,s,t,s,s,y,s,r,v,s,w,l,l,l,l,j
k,l,l,l,l,0,l,l,l,l,l,l,l,l,l,j
k,l,l,l,l,0,l,0,0,0,0,0,l,l,l,j
k,l,l,l,l,0,l,0,l,l,l,0,0,0,l,j
k,l,l,l,l,0,0,0,l,l,l,l,0,0,j,j
k,l,l,l,l,l,l,l,l,l,l,l,l,0,j,j
k,l,0,0,0,0,0,0,0,0,0,0,0,0,j,j
k,l,0,0,l,l,l,l,l,l,l,l,l,l,j,j
k,k,0,0,l,l,l,l,0,0,0,l,l,l,j,j
k,k,k,0,l,l,l,l,0,l,0,l,l,l,l,j
k,k,k,0,0,l,l,0,0,l,0,0,0,0,j,j
k,k,k,0,0,l,l,0,0,l,l,l,0,0,0,j
k,k,l,k,0,l,l,0,l,l,l,l,0,0,0,j
k,k,l,l,0,0,0,0,l,l,l,l,l,0,0,j
k,k,l,l,l,l,l,l,l,l,l,l,l,0,0,j
NAME Forest
ITM d 12,11
ITM e 8,9
ITM f 4,12
ITM g 4,7
ITM h 13,6
ITM i 7,4
EXT 5,1 13 7,15
PAL 2

TIL 10
11111011
11110101
11110011
11110101
11110110
11110110
11110110
11110110
WAL true

TIL 13
11111111
11111111
11111111
11111111
11111111
11111111
11111110
11111101
WAL true

TIL 14
01010111
01101111
01011111
10111111
01111111
11111111
11111111
11111111
WAL true

TIL 15
11111011
11110101
11101101
11010101
10110101
01010110
11010101
01011011
WAL true

TIL 17
00000000
00000000
00000000
00000000
00000000
00000000
00000000
11111111
WAL true

TIL 18
01010101
10101010
01010101
10101010
11111111
00000000
11111111
11111111
WAL true

TIL 19
10111111
11011111
10101111
10110111
10101011
10101101
01101010
10101011
WAL true

TIL 21
11111111
11111111
11111111
11000000
11011111
11010000
11011111
10100000
WAL true

TIL 22
11111111
11111111
11111111
00000000
11111111
00000000
11111111
00000000
WAL true

TIL 23
11101111
00101111
11101111
01011111
11011111
10111111
10111111
10111111
WAL true

TIL 24
11111111
00000000
11111111
00000000
11111111
00000000
11111111
00000000
WAL true

TIL 25
11110010
11110000
11110101
11110000
11110010
11110000
11110101
11110000
WAL true

TIL 26
10111111
10111111
11011111
11011111
01101111
11101111
00110111
11110111
WAL true

TIL 27
10000000
11111111
10000000
01111111
01000000
01111111
00100000
00111111
WAL true

TIL 28
10010000
00001111
01001000
00000111
10110100
00000011
01011101
00000000
WAL true

TIL 29
00000000
11111111
00000000
11111111
00000000
11111111
11111111
11111111
WAL true

TIL 30
10110111
00000111
01010111
00000111
10110111
00000111
01010111
00000111
WAL true

TIL 31
11111100
11111101
11111100
11111011
11111000
11110011
11110100
11110111
WAL true

TIL 32
11101000
11101111
11101000
11011111
10111111
01111111
11111111
11111111
WAL true

TIL 33
00000000
11111111
00000000
11111111
11111111
11111111
11111111
11111111
WAL true

TIL 34
00000000
11111111
00000000
11111111
00000000
11111111
00000000
11111111
WAL true

TIL 35
00000001
11111111
00000001
11111110
00000010
11111110
00000101
11111100
WAL true

TIL 36
00000100
11111000
00001010
11110000
11101101
11000000
10111010
00000000
WAL true

TIL 37
10110011
00000000
01011101
00000000
10111010
00000000
01011101
00000000
WAL false

TIL 38
11111111
00000000
01011101
00000000
10111010
00000000
01011101
00000000

TIL 39
11111110
00000000
01011101
00000000
10111010
00000000
01011101
00000000

TIL 40
11111111
11111111
11111111
11111111
11111111
11111111
11111111
10000001
WAL true

TIL 41
10101010
01000100
10101010
11111101
00001010
11101101
10101000
01101101

TIL 42
11101101
11101010
11101101
11101000
11101101
11101010
11101101
11101000
WAL true

TIL 43
11101101
11101000
11101101
11101010
11101101
11101111
00000000
11111111

TIL 44
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL true

TIL 45
11111111
11111111
11111111
11111111
11111111
11111111
00000000
11111111
WAL true

TIL 46
01111111
01111111
01111111
01111111
01111111
01111111
01111111
01111111

TIL 47
11111111
11111110
11111110
11111101
11111101
11111011
11111011
11110111

TIL 48
01101101
11101000
11101101
11101010
11101101
11101000
11101101
11101010

TIL 49
11110111
11101111
11101111
11011111
11011111
10111111
10111111
01111111

TIL 50
10101010
01010101
10101010
01010101
10101010
01010101
10101010
01010101
WAL true

TIL 51
01111111
01111111
01111111
11111111
11111111
11111111
11111111
11111111
WAL true

TIL 52
11000011
10111101
10111101
10110101
10111101
10111101
10111101
00000000
>
11000011
10100001
10100001
10100001
10100001
10100001
10100001
00000000

TIL 53
11111111
11000111
10101011
10000011
10101011
11000111
11111111
11111111
WAL true

TIL 54
11000011
10111101
10111101
10110101
10111101
10111101
10111101
00000000
WAL true

TIL 55
10111010
10000000
10011101
10000000
10111010
10000000
10011101
00000000
WAL true

TIL 56
10110110
00000110
01010110
00000110
10110110
00000110
01010110
00000110
WAL true

TIL 57
10110110
00000110
01010110
00000110
10110110
00000110
01010110
00000000
WAL true

TIL 58
11111111
11111111
11111111
11111111
11111111
11111111
11111111
00000000
WAL true

TIL 59
11111111
10101010
01000100
10101010
00010001
10101010
01000100
10101010
WAL true

TIL 60
00010001
11000011
00000010
00100110
11000100
00001100
00011001
00010000
>
00000001
00101011
00000010
11000110
00100100
00001100
00011001
00010000
WAL true

TIL 61
00000000
00000100
00111000
01000000
00000000
00001010
00110100
00000001
>
00000000
00100000
00010100
00001000
00000000
01100000
00011000
00000001
WAL true

TIL 62
10101100
00000110
01011011
00000001
10111010
00000000
01011101
00000000
WAL true

TIL 63
00110010
01100000
11011101
10000000
00111010
00000000
01011101
00000000
WAL true

TIL 64
00000000
00011100
00000010
10000000
11001100
01100000
00110000
00011100
>
00000000
00000100
00011000
10000000
11000010
01100100
00110000
00011100
WAL true

TIL 65
00000000
00110000
01001000
00000001
00000011
01000110
00001101
00111000
>
00000000
00001000
00110000
00000001
01100011
00000110
00001101
00111000
WAL true

TIL 66
10110110
00000011
01011100
00000000
10111010
00000000
01011101
00000000
WAL false

TIL 67
01101010
11000000
00011101
00000000
10111010
00000000
01011101
00000000
WAL false

TIL 68
00000110
10000011
11100000
00111000
10001110
00000011
01011100
00000000
>
00000000
10001100
11100000
00111000
10001110
00000011
01011100
00000000
WAL true

TIL 69
00100000
11000001
00000111
00011100
01110010
11000000
00011101
00000000
>
00000000
00100001
11000111
00011100
01110010
11000000
00011101
00000000
WAL true

TIL 70
00000000
10000000
11100000
00111000
00001110
00000011
00000000
00000000

TIL 71
00000000
00000001
00000111
00011100
01110000
11000000
00000000
00000000

TIL 72
00000000
00000000
00000000
00000000
00000000
11000000
01111110
00000011

TIL 73
00000000
00111000
00000100
01000000
00000000
00000011
01111110
11000000
>
00000000
00000100
00011000
00000000
00110000
00000011
01111110
11000000
WAL true

TIL 74
00000000
00001000
00110100
00000000
00000000
00100100
00000000
11111111
>
00000000
00010100
00001000
00000000
00010100
00101000
00000000
11111111
WAL true

TIL 75
10000000
11000100
01001010
01100000
10100100
00110010
01011000
00001000
>
10000000
11000000
01000100
01100000
10101010
00110000
01011000
00001000
WAL true

TIL 76
00000010
01000011
00100011
00100110
01001010
10001011
01000111
00001010
>
00000011
00000111
00001011
01000110
10000111
10000111
01001011
00100010
WAL true

TIL 77
01000000
00100010
00100010
01000100
01000010
00100010
00000010
00000100
>
00000100
00100010
01000010
01000100
00000100
01000010
01000000
00100000
WAL true

TIL 78
10101010
01010101
00000000
00000000
01010101
10101010
00000000
00000000

TIL 79
01001000
11010000
11001001
01010010
01010010
11001000
11000010
01000000
>
01000000
11000000
11010000
01001010
01011001
11010001
11001010
01010000
WAL true

TIL 81
01010101
10001000
01010101
00111111
01100000
10100111
01101011
00101011
WAL true

TIL 82
01101111
10101111
01101111
00101111
01101111
10101111
01101111
00101111
WAL true

TIL 83
01101000
10100111
01100000
00111111
01010101
10001000
01010101
00100010
WAL true

TIL 84
11111111
11111111
00000000
11111111
01010101
00100010
01010101
10001000
WAL true

TIL 85
10101101
11001010
00001101
11111000
01010101
00100010
01010101
10001000
WAL true

TIL 86
11101101
11101010
11101101
11101000
11101101
11101010
11101101
11101000
WAL true

TIL 87
01111111
10111111
11000000
11101111
11101101
11101000
11101101
11101010
WAL true

TIL 88
11111111
11111111
00000000
11111111
01010101
10001000
01010101
00100010
WAL true

TIL 89
01010101
10001000
01010101
00100010
01010101
10001000
01010101
00100010
WAL true

TIL 90
11111111
11111111
11111111
11111111
11111111
00000000
11111111
01010101

TIL 91
11011111
01011111
11011111
01011111
11011111
01000000
11111111
01010101

TIL 92
11011111
01011111
11011111
01011111
11011111
01011111
11011111
01011111

TIL 93
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL false

TIL 94
11011111
10101111
11011111
11111111
11111011
11110101
11111011
11111111
WAL false

TIL 95
11111011
11110101
11111011
11111111
11011111
10101111
11011111
11111111
WAL false

TIL 96
01111110
10111101
11011101
11101100
11111001
11110110
11110111
11111010

TIL 97
01010010
01011111
01011111
01011111
01010111
01011011
01011101
10111110

TIL 98
01001010
11111010
11111010
11111010
11101010
11011010
10111010
01111101

TIL 99
01111110
10111101
00111011
10110111
10011111
01101111
11101111
01011111

TIL a
10111010
00000000
01011101
00000000
10111010
00000000
01011101
00000000
NAME Flooring
WAL false

TIL c
00000001
00000011
00000110
00001111
00011111
00100000
01111111
11111111
WAL true

TIL d
11111111
11111111
00000000
11111111
11111111
00000000
11111111
11111111
WAL true

TIL e
10000000
11000000
00100000
11110000
11111000
00000100
11111110
11111111
WAL true

TIL f
11111111
11111111
11000111
11000111
11111111
11111111
11111111
11111111
WAL true

TIL g
11111111
11111111
11111111
11111111
11001111
11001111
11001111
11001111
WAL true

TIL h
11111111
11111111
11111111
11111111
11001111
11001111
11001111
11001111
NAME DOOR
WAL false

TIL i
11111111
10000001
10111101
10100101
10100101
10111101
10000001
11111111
NAME Walls
WAL true

TIL j
00100000
00000010
00000111
10101111
01110010
11111010
00100010
00100000
WAL true

TIL k
00100000
00000010
00000111
00101111
01110010
11111010
00100010
00100000
WAL true

TIL l
00000000
00000010
00000111
10101111
01110010
11111010
00100010
00100000
WAL true

TIL m
00000000
00000010
00000111
00101111
01110010
11111010
00100010
00100000
WAL true

TIL n
00000000
11101110
00000000
10110111
00000000
11101110
00000000
01110111
WAL false

TIL o
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME WALL
WAL true

TIL p
11111111
10000001
10111101
10100101
10100101
10111101
10000001
11111111
NAME FAKE WALLZ

TIL q
10000001
11000011
00000111
00001111
00011111
00111111
01111111
11111111
WAL true

TIL r
10111101
11011011
11100111
11110111
11111011
11111101
11111110
11111111
WAL true

TIL s
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL true

TIL t
11111101
11111011
11110111
11101111
11011111
10111111
01111111
11111111
WAL true

TIL u
10111111
11011111
11101111
11110111
11111011
11111101
11111110
11111111
WAL true

TIL v
11111111
11111111
11111111
11111111
11111111
11111111
11111111
01111111
WAL true

TIL w
10000000
11000000
11100000
11110000
11111000
11111100
11111110
11111111
WAL true

TIL x
10000011
11000111
11100001
11110001
11111000
11111100
11111110
01111111
WAL true

TIL y
11111111
11111111
11111111
11111111
11111111
11100111
11100111
11100111
NAME door

TIL z
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111110
WAL true

TIL 1a
11011010
11101010
11110110
11111010
11111100
11111110
11111110
11111110
WAL true

TIL 1b
10111111
10111111
10111111
10111111
10111111
10111111
10111111
10111111
WAL true

TIL 1c
00000000
00000000
00000000
00000000
00000000
00000000
00000000
11111111
WAL true

TIL 1f
01010101
10100010
01010101
11111111
00000000
11111111
11111110
11111101
WAL true

TIL 1g
11110110
11110110
11110110
11110110
11110110
11110110
11110110
11110110
WAL true

TIL 1i
01110110
10000101
11011010
11100010
11110001
11110001
11110101
11110000
NAME IMPT
WAL true

TIL 1j
00000000
00000000
00000000
00000000
00000000
00000000
00000000
11111111
WAL true

TIL 1k
10000000
10000000
10000000
10000000
10000000
10000000
00000000
10000000
WAL true

TIL 1l
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL true

TIL 1m
11111111
00000001
01101101
01101101
00000001
01101101
01101101
00000001
WAL true

TIL 1n
10111101
10111101
10111101
10110101
10111101
10111101
10111101
00000000

TIL 1p
11111111
01010101
10101011
01010101
10101011
01010101
10101011
01010101
WAL true

TIL 1q
11111111
11010101
10101010
11010101
10101010
11010101
10101010
11010101
WAL true

TIL 1r
10101010
11010101
10101010
11010101
10101010
11010101
10101010
11010101
WAL true

TIL 1s
10101011
01010101
10101011
01010101
10101011
01010101
10101011
01010101
WAL true

TIL 1v
10101011
01010101
10101011
01010101
10101011
01010101
10101011
11111111
WAL true

TIL 1w
10101010
11010101
10101010
11010101
10101010
11010101
10101010
11111111
WAL true

TIL 1x
10000000
11111111
10000000
11111111
10000000
11111111
10000000
11111111
WAL true

TIL 1y
11111111
11111111
11111111
00001111
11110111
00011011
11110101
00101110
WAL true

TIL 1z
10111111
00100000
01111111
01000000
01111111
10000000
11111111
10000000
WAL true

TIL 2a
00000000
11111111
00000000
11111111
00000000
11111111
00000000
11111111
WAL true

TIL 2b
00011011
11111011
00001011
11111101
00000010
11111111
11111111
11111111
WAL true

TIL 2d
01111111
01111111
01111111
01111111
01111111
01111111
01111111
01111111
WAL true

TIL 2f
01111111
01111111
01111110
01111110
01111110
01111110
01111110
01111110
WAL true

TIL 2i
11110010
11110000
11110101
11110000
11110010
01110000
10110101
11010000
WAL true

TIL 2j
11101010
11110000
01001101
00000000
10111010
00000000
01011101
00000000
WAL false

TIL 2l
01111111
00111111
00000000
00000000
01011101
00000000
10111010
00000000
WAL false

TIL 2m
11111111
11111111
00000000
00000000
10111010
00000000
01011101
00000000
WAL false

TIL 2n
01001111
01010111
01010011
01000101
01010001
01100101
01110101
01111001
WAL true

TIL 2o
10110010
11010000
10100101
11110000
01110010
10110000
11010101
11100000
WAL true

TIL 2p
01111110
01111110
01111110
01111110
01111111
01111111
01111111
01111111
WAL true

TIL 2q
01111111
01111111
01111111
01111111
01111111
01111111
01111110
01111110
WAL true

TIL 2r
11110010
11110000
11110101
11110000
11110010
11110000
11110101
01110000
WAL true

TIL 2s
11110111
11110100
11111011
11111010
11111011
11111101
11111101
11111101
WAL true

TIL 2t
11111111
11111111
11111111
11110000
11101111
11011000
10101111
01110100
WAL true

TIL 2u
11111111
00000000
11111111
00000000
11111111
00000000
11111111
00000000
WAL true

TIL 2v
11111111
11111111
11111111
00000000
11111111
00000000
11111111
00000000
WAL true

TIL 2w
11111101
00000101
11111110
00000010
11111110
00000001
11111111
00000001
WAL true

TIL 2x
11110111
11101111
11101111
00000111
11111011
00001011
11111011
00000101
WAL true

TIL 2y
10110110
01010101
01000011
01000111
10010111
10000111
10110111
00000111
NAME IMPT 2
WAL true

TIL 2z
11111110
11111110
11111110
11111110
11111110
11111110
11111110
11111110
WAL true

TIL 3a
00000001
00000001
00000001
00000001
00000001
00000001
00000001
00000001

TIL 3b
10110111
00000111
01010111
00000111
10110111
00000111
01010110
00000101
WAL true

TIL 3c
10110110
00000101
01010010
00000111
10110111
00000110
01010101
00000011
WAL true

TIL 3d
10111110
10111110
10111110
10111110
01111110
11111110
11111110
11111110
WAL true

TIL 3e
11111110
11111110
11111110
11111110
11111110
11111110
10111110
00111110
WAL true

TIL 3f
11100110
11010110
10010110
01000110
00010110
01001110
01011110
00111110
WAL true

TIL 3g
10101010
01000100
10101010
11111111
00000000
11111111
11111111
11111111
WAL true

TIL 3h
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL true

TIL 3i
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111

TIL 3j
10101010
01000100
10101010
11111111
00000000
11111111
11111111
11111111

TIL 3k
11111111
11111111
11111111
11111111
11111111
11111111
11111111
00000000

TIL 3l
01010101
00100010
01010101
11111111
00000000
11111111
00000000
11111111
WAL true

TIL 3m
10111010
00000000
01011101
00000000
10111010
00000000
00000000
11111111
WAL false

TIL 3n
01010101
00100010
01010101
11111111
00000000
11111111
11111111
01111111
WAL true

TIL 3o
01010101
00100010
01010101
11111111
00000000
11111111
00000000
11111111
WAL true

TIL 3p
11111111
00000000
01011101
00000000
10111010
00000000
01011101
00000000
WAL false

TIL 3q
10111010
11000000
10101101
10110000
10101010
10101100
01101010
10101010
WAL true

TIL 3r
10111010
00000000
01011101
00000000
10111010
00000000
10111010
11111111

TIL 3s
10111011
00000101
01001101
00010101
10110101
01010110
11010101
01011011
WAL true

TIL 3t
10111011
00000101
01010111
00000101
10110111
00000110
01010110
00000110
WAL true

TIL 3u
10111010
00000000
01011101
00000000
10111010
00000000
01011100
00000001

TIL 3v
11111111
11111111
11111111
11111111
11111111
11111111
11111111
01111111
WAL true

TIL 3w
10111010
10000000
10011101
10000000
10111010
10000000
10011101
10000000
WAL true

TIL 3x
11111111
00000000
01011101
00000000
10111010
00000000
01011101
00000000

TIL 3y
11111111
00000000
01011101
00000000
10111010
00000000
01011101
00000000

TIL 3z
11111111
11111111
11111111
11111111
11111111
11111111
11111111
00000000
WAL true

TIL 4a
11111111
11111110
11111110
11111101
11111101
11111011
11111011
11110111

TIL 4b
01111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL true

TIL 4c
10111111
10111111
01011111
01011111
01011111
00101111
00101111
00000000
WAL true

TIL 4e
11111111
11111111
11111111
11111111
01111111
01111111
01111111
10111111
WAL true

TIL 4f
11110101
11110101
11110101
11110101
11110101
11110101
11110101
11110101
WAL true

TIL 4g
11111111
11111111
11111111
11111111
11111111
11111111
11111111
00000000
WAL true

TIL 4h
11111101
11111101
11111010
11111010
11111010
11110100
11110100
00000000
WAL true

TIL 4i
11111111
11111111
11111111
11111111
11111110
11111110
11111110
11111101
WAL true

TIL 4j
00001011
00001011
00001011
00001011
00001011
00001011
10001011
01001011
WAL true

TIL 4k
01010111
01010111
01010111
01010111
01010111
01010111
11010111
01010111
WAL true

TIL 4l
11111111
11111111
11111111
11111111
11111111
00000000
11111111
01010101
WAL true

TIL 4m
10101010
01010101
10101010
11111111
00000000
11111111
11111111
11111111
WAL true

TIL 4n
11000000
11000000
11000000
11000000
11000000
11000000
11000000
11000000
WAL true

TIL 4o
11111111
11111111
11111111
11111111
11111111
00000011
11111011
00001011
WAL true

TIL 4p
11111111
11111111
11111111
11111111
11111111
11000000
11011111
11010000
WAL true

TIL 4q
01011010
01010101
01011010
01011111
01100000
01011111
10111111
01111111
WAL true

TIL 4s
11111111
11111111
11111111
11111111
11111111
11100000
11011111
10110101
WAL true

TIL 4t
11111111
11111110
11111101
11111011
11110101
11110101
11110101
11110101
WAL true

TIL 4u
01011010
11010101
01011010
01010101
01011010
01010101
01011010
01010101
WAL true

TIL 4v
10101101
01010101
10101101
11111101
00000011
11111101
11111110
11111111
WAL true

TIL 4w
01111111
10111111
01011111
01101111
01110111
01010111
01010111
01010111
WAL true

TIL 4x
11111111
11111111
11111111
11111111
11111111
00000011
11111101
01010110
WAL true

TIL 4y
10101101
01010101
10101101
01010101
10101101
01010101
10101101
01010101
WAL true

TIL 4z
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL true

TIL 5a
11111111
00000000
00110000
01001000
00000000
00010010
00000100
00000000
>
11111111
00000000
00001000
00010110
00000000
00101000
01010000
00000000
WAL true

TIL 5b
11000000
01111110
00000011
00100000
01011000
00000000
00100100
00011000
>
11000000
01111110
00000011
00110100
00001000
00000000
00101000
10010000
WAL true

TIL 5c
00000011
01111110
11000000
00001100
00110010
00000000
00010010
00001100
>
00000011
01111110
11000000
00011000
00100000
01000010
00001100
00010000
WAL true

TIL 5d
10111010
00000000
11001101
01110000
00011100
00000111
00000001
00000000
WAL true

TIL 5e
10111010
00000000
01010011
00001110
00111000
11100000
10000000
00000000
WAL true

TIL 5f
10111010
00000000
01011101
00000000
10111010
00000000
11011101
01100000

TIL 5g
10111010
00000000
01011111
00000000
10111010
00000000
01011011
00000110

TIL 5h
10011100
00110000
01100000
11000110
10001001
00000000
00110100
00001000
>
10011100
00110000
01100000
11011000
10000110
00000000
00001010
00010100
WAL true

TIL 5i
00111010
00001100
00000110
01100011
00011001
00000000
10110000
01001000
>
00111010
00001100
00000110
00010011
01100001
00000000
00000100
00111000
WAL true

TIL 5j
10111010
00000000
01011101
00000000
10111001
00000011
01000110
00001100

TIL 5k
10111010
00000000
01011101
00000000
10111010
11000000
01101101
00110000

TIL 5l
10101000
00011000
01110000
00100010
11100101
01000000
11010010
10001100
>
10101000
00011000
01110000
00100110
11100000
01000000
11000100
10000010
WAL true

TIL 5m
00010010
00011000
00001101
11000100
00110110
00000010
00110011
01000001
>
00010010
00011000
00001101
00100100
11000110
00000010
01000011
00110001
WAL true

TIL 5n
10000000
00000000
00110100
00001000
00000000
00000000
00001000
00010000
>
10000000
00000000
00001000
00110100
00000000
00000000
00110100
00001000
WAL true

TIL 5p
00000001
00001000
01110000
00000000
00000100
00011000
01000000
00000000
>
00000001
00110000
00001100
00000000
00000000
00000100
00011000
00000000
WAL true

TIL 5q
10111001
00000001
01011011
00000010
10111010
00000110
01010100
00000100
WAL false

TIL 5r
10111010
10000000
11011101
01000000
01011010
01100000
00101101
00100000
WAL true

TIL 5s
10110100
00000100
01001100
00001000
10101000
00001000
01001000
00001000
WAL false

TIL 5t
00101010
00100000
00110101
00010000
00010010
00010000
00010101
00010000
WAL true

TIL 5u
10101000
00001000
01001000
00001000
10101000
00001100
01000100
00000100
WAL false

TIL 5v
00010010
00010000
00010101
00010000
00010010
00110000
00101101
00100000
WAL true

TIL 5w
10110100
00000100
01010110
00000010
10111010
00000011
01011101
00000001
WAL false

TIL 5x
10111010
11000000
01001101
01100000
00101010
00110000
00011001
00001000
WAL true

TIL 5y
00101010
00100000
01101101
01000000
01011010
11000000
10011101
10000000
WAL true

TIL 5z
00000000
00000100
00011010
00000000
00000000
00010100
00001000
10000000
>
00000000
00100000
00010100
00001000
00000000
00000000
00011000
10000000
WAL true

TIL 6a
00000000
00111010
00000100
00000000
00011000
11000000
01111110
00000011
>
00000000
00001000
00110000
00000010
00001101
11000000
01111110
00000011
WAL true

TIL 6b
00000000
01001000
00110100
00000000
00110000
00000011
01111110
11000000
>
00001000
00110000
01000000
00010000
00001000
00000011
01111110
11000000
WAL true

TIL 6c
00000000
00011000
00100100
00000000
00000100
01100010
00000000
11111111
>
00000000
00100000
00011000
00000000
00100010
00010000
00000000
11111111
WAL true

TIL 6d
00000000
00000000
00000000
00000000
10000000
11000000
01100000
00110000

TIL 6e
00001000
00011000
00110000
00100000
01100000
01000000
11000000
10000000

TIL 6f
00010000
00011000
00001100
00000100
00000110
00000010
00000011
00000001

TIL 6g
10000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL 6h
00000001
00000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL 6i
00000001
00000001
00000011
00000010
00000010
00000110
00000100
00000100

TIL 6j
10000000
10000000
11000000
01000000
01000000
01100000
00100000
00100000

TIL 6k
00000100
00000100
00001100
00001000
00001000
00001000
00001000
00001000

TIL 6l
00100000
00100000
00110000
00010000
00010000
00010000
00010000
00010000

TIL 6m
00001000
00001000
00001000
00001000
00001000
00001100
00000100
00000100

TIL 6n
00010000
00010000
00010000
00010000
00010000
00110000
00100000
00100000

TIL 6o
00000100
00000100
00000110
00000010
00000010
00000011
00000001
00000001

TIL 6p
10000000
11000000
01000000
01100000
00100000
00110000
00011000
00001000

TIL 6q
00100000
00100000
01100000
01000000
01000000
11000000
10000000
10000000

TIL 6r
00000000
00000000
00000000
00000000
00000000
00000000
00000000
10000000

TIL 6s
00000001
00000011
00000010
00000110
00000100
00001100
00011000
00010000

TIL 6t
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000001

TIL 6u
00001100
00000110
00000011
00000001
00000000
00000000
00000000
00000000

TIL 6v
00110000
01100000
11000000
10000000
00000000
00000000
00000000
00000000

TIL 6w
00000001
01100010
00001000
10000100
11000000
01100000
00110000
00011100
>
00100000
00010000
00000001
10000000
11000100
01101010
00110000
00011100
WAL true

TIL 6x
00000000
00000000
00000000
00000001
00000011
00000110
00001100
00111000

TIL 6y
00000110
00000011
00000000
00000000
00000000
00000000
00000000
00000000

TIL 6z
01100000
11000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL 7a
00100010
00100010
10101010
10101010
10101010
10101010
10001000
11111111

TIL 7b
11111111
00100010
10101010
10101010
10101010
10101010
10001000
10001000

TIL 7c
11101010
11010101
11000000
11000000
11010101
11101010
11000000
11000000
>
11101010
11010101
11000000
11000000
11010101
11101010
11000000
11000000

TIL 7d
11111111
11011111
11011111
10111111
10111111
10111111
01111111
00000000
WAL true

TIL 7e
10101010
01010101
00000000
00000000
01010101
10101010
00000000
00000000

TIL 7f
00000001
01000001
00100001
00100101
01001001
10001001
01000101
00001001
>
00000001
00000101
00001001
01000101
10000101
10000101
01001001
00100001
WAL true

TIL 7g
10000000
10000000
10010001
10001010
10001010
10010000
10001001
10010000
>
10010000
10001000
10010000
10001010
10001001
10010001
10000010
10000000
WAL true

TIL 7h
11111000
11111000
11111001
11110010
11110010
11101000
11100010
11100000
>
11111100
11111000
11111000
11110010
11110001
11100001
11101010
11110000
WAL true

TIL 7i
11110000
11110000
11101001
11101001
11101100
11100100
11101000
11100000
>
11110000
11110000
11100100
11100100
11100100
11100010
11100100
11100000
WAL true

TIL 7j
11111111
11111110
11111101
11111110
11111010
11111000
11110010
11110000
>
11111111
11111110
11111100
11111110
11111001
11111001
11110010
11110000
WAL true

TIL 7k
11000000
00100010
00100010
01000100
01000010
00100010
00000010
00000100
>
00000100
00100010
01000010
01000100
00000100
01000010
01000000
00100000
WAL true

TIL 7l
11111100
11111100
11111000
11111010
11111010
11110001
11110010
11110000
>
11111100
11111100
11111001
11111001
11111001
11110010
11110000
11110000
WAL true

TIL 7m
11111111
11111111
11111111
11111111
11111111
11111110
11111110
11111100
WAL true

TIL 7n
11100000
11000000
10010010
00100001
00010000
00010001
00100000
00000000
>
11100010
11000001
10000000
00010010
00100001
00010010
00100000
00000000
WAL true

TIL 7o
11111111
11111111
11111111
11111111
11111111
11111110
11111000
11110010
>
11111111
11111111
11111111
11111111
11111111
11111110
11111001
11110000
WAL true

TIL 7p
11111111
11111111
11111111
11111111
11000000
00010000
00100100
00010000
>
11111111
11111111
11111111
11111111
11000000
00010010
00010000
00010010
WAL true

TIL 7q
11111111
11111111
11111111
11111111
00000011
01001000
00101000
01000000
>
11111111
11111111
11111111
11111111
00000011
00100000
01000100
00000100
WAL true

TIL 7r
11111111
11111111
11111111
11111111
11111111
01111111
00011111
00001111
>
11111111
11111111
11111111
11111111
11111111
01111111
00011111
00001111
WAL true

TIL 7s
00000111
01000011
00100001
00100100
01001000
10001000
01000100
00001000
>
00000111
00000011
00001001
01000100
10000100
10000100
01001000
00100000
WAL true

TIL 7t
11111111
11111111
11111111
11111111
11111111
01111111
01111111
00111111
WAL true

TIL 7u
00111111
00111111
00011111
00011111
01011111
10001111
01001111
00001111
>
00111111
00111111
00011111
01011111
10011111
10001111
01001111
00101111
WAL true

TIL 7v
00001111
01001111
00100111
00100111
01000111
10000111
01000111
00000111
>
00001111
00001111
00000111
01000111
10000111
10000111
01000111
00100111
WAL true

TIL 7w
11111111
00000000
00000000
00000000
01010101
10101010
00000000
00000000

TIL 7x
11100000
11010000
11001001
01010010
01010010
11001000
11000010
01000000
>
11100000
11000000
11010000
01001010
01011001
11010001
11001010
01010000
WAL true

TIL 8a
01101011
10101101
01101101
00101101
01101110
10101110
01101110
00101111
WAL true

TIL 8b
11111111
11111111
11111111
11111111
11111111
11111111
11111111
01111111
WAL false

TIL 8c
01111111
01111111
10111111
10111111
10111111
11011111
11011111
11011111
WAL false

TIL 8d
11101111
11101111
11101111
11110111
11110111
11110111
11111011
11111011
WAL false

TIL 8e
11111101
11111101
11111101
11111110
11111110
11111110
11111111
11111111
WAL false

TIL 8f
11111111
11111111
11111111
11111111
11111111
11111111
01111111
01111111
WAL true

TIL 8g
11111111
11111111
11111111
11111111
11111111
11111100
11100011
00011111
WAL true

TIL 8h
01010101
10101010
00000000
01010101
10101010
00000000
11111111
11111111

TIL 8i
11101101
11101000
11101101
11101010
11101101
11101000
11101101
01101010
WAL true

TIL 8j
01010100
10101010
00000000
01010100
10101010
00000000
11111110
11111111

TIL 8k
00101010
01010101
00000000
00000000
01010101
00101010
00000000
00000000

TIL 8l
01010101
00101010
00000000
01010101
00101010
00000000
11111111
11111111

TIL 8m
10101010
01010100
00000000
00000000
01010100
10101010
00000000
00000000

TIL 8n
01111111
00000000
00000000
00000000
01010101
00101010
00000000
00000000

TIL 8o
10101111
01101111
10101111
01101111
10101111
01101111
10101111
01101111
WAL true

TIL 8p
10101010
01010101
10111111
01100000
10100111
01101011
10101101
01101110
WAL true

TIL 8q
10101010
01010101
11111111
00000000
11111111
11111111
11111111
11111111
WAL true

TIL 8r
10101111
01101111
10101111
01101000
10101100
01101010
10101111
01101111
WAL true

TIL 8s
10000000
10000000
10000000
10000000
10000000
10000000
10000000
10000000

TIL 8t
00000000
10000000
10000000
10000000
10000000
10000000
10000000
10000000

TIL 8u
00000001
00000001
00000001
00000001
00000001
00000001
00000001
00000001

TIL 8v
10101010
01111111
11000000
01011111
11011111
01011111
11011111
01011111

TIL 8w
10101010
11111111
00000000
11111111
11111111
11111111
11111111
11111111

TIL 8x
10101010
11111111
00000010
11111011
11111010
11111011
11111010
11111011

TIL 8y
11111010
11111011
11111010
11111011
11111010
11111011
11111010
11111011

TIL 8z
11111010
11111011
11111010
11111011
11111010
00000011
11111110
01010101

TIL 9a
11111110
11111011
11111011
11110111
11110111
11101111
11101111
11111111
WAL false

TIL 9b
01111111
11011111
11011111
11101111
11101111
11110111
11110111
11111111
WAL false

TIL 9c
11111110
01111101
01111101
10001011
10110011
11011111
11101111
11110000
WAL false

TIL 9d
01111111
10111110
10111110
11011001
11000101
11111011
11110111
00001111
WAL false

TIL 9e
01011001
01100111
10011111
01111111
11111111
11111111
11111111
11111111
WAL true

TIL 9f
10101010
11111111
00000000
11111111
11111111
11111110
11111110
11111111

TIL 9g
10101010
11111111
00000000
11111111
11111111
01111111
01111111
11111111

TIL 9h
11011111
10101110
11011110
11111111
11111011
11110101
11111011
11111111
WAL false

TIL 9i
11111011
01110101
01111011
11111111
11011111
10101111
11011111
11111111
WAL false

TIL 9j
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL true

TIL 9k
01011111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL false

TIL 9l
11111010
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL false

TIL 9m
01010101
10001000
01010101
00100010
01010101
10001000
01010101
00100010
WAL false

TIL 9n
10111010
00000000
01011101
00000000
10111010
00000000
01011100
00000001
WAL false

TIL 9o
00101111
00101111
01010111
00010111
10110111
00001011
01011011
00000000
WAL true

TIL 9p
01111111
10111111
10111111
10111111
01011111
01011111
01011111
00101111
WAL true

TIL 9q
11111111
11111111
11111111
11111111
11111111
11111111
01111111
01111111
WAL true

TIL 9r
10110101
00000101
01010101
00000010
10111010
00000010
01011101
00000001
WAL true

TIL 9s
10111001
00000000
01011101
00000000
10111010
00000000
01011101
00000000

TIL 9t
01010101
01010101
01010101
01010110
01011001
01101011
00001011
00001011
WAL true

TIL 9u
11111111
11111100
11110011
11001101
10110101
01010101
01010101
01010101
WAL true

TIL 9v
01010111
10010111
01001011
01001011
01001011
01010101
01010101
01010110
WAL true

TIL 9w
11111111
11111111
11111111
11111110
11111001
11100111
10011111
01111111
WAL true

TIL 9x
10111111
01011111
01011111
01011111
10101111
10101111
10101111
01010111
WAL true

TIL 9y
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL true

TIL 9z
11111111
11111111
11111111
00000000
11111111
11111111
11111111
11111111
WAL true

TIL a0
11111111
11100111
10011001
01111110
11111111
11111111
11100111
11100111
WAL true

TIL a1
11111111
11111111
11111111
01111111
10011111
11100111
11111001
11111110
WAL true

TIL a2
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL true

TIL a3
11111111
11111110
11111110
11111110
11111101
11111101
11111101
11111010
WAL true

TIL a4
11111010
11110011
11110101
11110101
11110101
11101001
11101001
01101001
WAL true

TIL a5
10011101
11100111
11111001
11111110
11111111
11111111
11111111
11111111
WAL true

TIL a6
01010101
01010100
11010101
01110100
10011100
11010000
11010101
11010000
WAL true

TIL a7
11111111
00111111
11001111
01110011
01011101
01010101
01010101
01010101
WAL true

TIL a8
10101010
10100000
10101101
01000000
01011010
01000000
10011101
10000000
WAL true

TIL a9
11111111
11111111
11111111
11111111
11111111
11111111
11111110
11111110
WAL true

TIL aa
10111010
00000000
01011101
00000000
10111010
00000000
01011101
00000000

TIL ab
11111110
11111101
11111101
11111101
11111010
11111010
11111011
11110100
WAL true

TIL ac
11110100
11110100
11101111
11101000
11101111
11010000
11011111
00000000
WAL true

TIL ad
11111111
11111111
11111111
11111111
11111111
11111111
11111111
00000000

TIL af
00011111
00011111
10001111
00001111
11001111
00001111
11101111
00000000
WAL true

TIL ag
11111000
11111000
11110001
11110000
11110011
11110000
11110111
00000000
WAL true

TIL ah
11111111
11111111
11111111
11111110
11111100
11111100
11111000
11111000

TIL ai
11111111
11111111
11111111
01111111
00111111
00111111
00011111
00011111

TIL aj
11000011
10000001
00000000
00000000
00000000
00000000
01111110
00000000
WAL true

TIL ak
11111111
00000000
11111111
00000000
11111111
00000000
11111111
00000000

TIL al
10000001
01100110
01100110
00000000
00000000
01100110
01100110
10000001

TIL am
10000001
10000001
11100111
11100111
11100111
11100111
11100111
11111111

TIL an
11111010
11111101
11111101
11111101
11111110
11111110
11111110
11111111

TIL ao
01010101
01010110
01011001
01100111
10011111
01111111
10111111
10111111

TIL ap
11010101
11010101
11010101
11010101
11010101
11010110
11011010
11100010

TIL aq
11111111
11111111
11111111
11111111
11111110
11111001
11100111
11011101

TIL ar
11111110
11111001
11100111
10011101
01110101
11010101
01010101
01010101

TIL as
10011111
01111111
11111111
11111111
11111111
11111111
11111111
11111110

TIL at
01110101
11010101
01010101
01010101
01010101
01010110
01011001
01100111

TIL au
10101010
01000100
10101010
11111111
00000000
11111001
11100111
10011101

TIL av
01010101
01010101
01011101
01100111
11011001
00111110
11111111
11011011

TIL aw
10101010
01000100
10101010
11111111
01110110
11010101
01010101
01010101

TIL ax
10101010
01000100
10101010
11111111
00000000
10011111
01100111
01011001

TIL ay
01010110
01010101
01010101
01010101
11010101
01110101
10011101
11100111

TIL az
11111001
11111110
11111111
11111111
11111111
11111111
11111111
01111111

TIL b0
10010101
01110101
10011101
11100111
11111001
11111110
11111111
11111111

TIL b1
01111111
10011111
01100111
01011001
01010110
01010101
01010101
01010101

TIL b2
01010111
01010111
01010111
01010111
11010111
01110111
01001111
01011111

TIL b3
11111111
11111111
11111111
11111111
01111111
10011111
01101111
01010111

TIL b4
01011111
10111111
10111111
10111111
01111111
01111111
01111111
11111111

TIL b5
11111111
11111111
11111111
11111111
00001100
00000000
11111111
11111111
>
11111111
11111111
11111111
11111111
00110000
00000000
11111111
11111111

TIL b6
01111111
01110101
10111010
10111010
00110101
00111111
11111111
11111111
>
01111111
01111111
10111111
10111111
00111111
00111111
11111111
11111111

TIL b7
11111110
11111110
11111101
11111101
11111100
11111100
11111111
11111111
>
11111110
10101110
01011101
01011101
10101100
11111100
11111111
11111111

TIL b8
11011011
11011011
11111111
11000011
10011001
10111101
00111100
01111110

TIL b9
00000000
01000100
11111111
01000100
11111111
01000100
11111111
01000100
WAL true

TIL ba
10010000
00010100
01011111
00010100
10011111
00010100
01011111
00010100
WAL true

TIL bb
10010010
00010000
01010101
00010000
10010010
00010000
01010101
00010000
WAL true

TIL bc
00000010
01000000
11110101
01010000
11110010
01010000
11110101
01010000
WAL true

TIL bd
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL be
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000

TIL bf
11110101
11110110
11110101
11110110
11110101
11110110
11110101
11110110
WAL true

TIL bg
01110101
10110110
11010101
11100110
00000101
11111110
01010101
10101010
WAL true

TIL bh
11111111
11111111
11111111
11111111
00000000
11111111
01010101
10101010
WAL true

TIL bi
01101110
10101101
01101011
10100111
01100000
10111111
01010101
10101010
WAL true

TIL bj
10101010
01010101
11111110
00000101
11100110
11010101
11010110
10110101
WAL true

TIL bk
01010101
10101010
01111111
10100000
01100111
10101011
01101011
10101101
WAL true

TIL bl
11111110
11111101
11111011
11110111
11101111
11011111
10111111
01111111
WAL true

TIL bm
01111111
10111111
11011111
11101111
11110111
11111011
11111101
11111110
WAL true

TIL bn
11111101
11111110
11111110
11111111
11111111
11111111
11111111
11111111
WAL true

TIL bo
11011111
11101111
11101111
11110111
11110111
11111011
11111011
11111101
WAL true

TIL bp
11111111
11111111
11111111
01111111
01111111
10111111
10111111
11011111
WAL true

TIL bq
10101100
01101110
10101110
01101111
10101111
01101111
10101111
01101111
WAL true

TIL br
10111111
01111111
01111111
11111111
11111111
11111111
11111111
11111111
WAL true

TIL bs
11111011
11110111
11110111
11101111
11101111
11011111
11011111
10111111
WAL true

TIL bt
11111111
11111111
11111111
11111110
11111110
11111101
11111101
11111011
WAL true

TIL bu
10110101
01110110
01110101
11110110
11110101
11110110
11110101
11110110
WAL true

TIL bv
11111111
11111111
11111111
00000000
11111111
11111111
11111111
11111111
WAL true

TIL bw
11111111
11111111
11111111
00000000
01111111
01111111
01111111
01111111
WAL true

TIL bx
11111111
11111111
11111111
00000000
11111110
11111110
11111110
11111110
WAL true

TIL by
01111111
01111111
01111111
01111111
01111111
01111111
01111111
01111111

TIL bz
11111110
11111110
11111110
11111110
11111110
11111110
11111110
11111110

TIL c0
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111

TIL c1
00000000
00111101
00000000
01111111
00000000
00101111
00000000
00000000

TIL c2
00000000
10111111
00000000
11100111
00000000
10111111
00000000
00000000

TIL c3
00000000
11111111
00000000
11111110
00000000
10111111
00000000
00000000

TIL c4
00000000
11111111
00000000
11111111
00000000
11111111
00000000
00000000

TIL c5
00000000
11111111
00000000
11101111
00000000
11111110
00000000
00000000

TIL c6
00000000
11111100
00000000
11101110
00000000
11111100
00000000
00000000

TIL c7
11011101
11100001
11111111
00000000
11111111
11111111
11111111
11111111
WAL true

TIL c8
10101010
01010101
11111111
00000000
11111111
11111111
11111111
11111111
WAL true

TIL c9
10111011
10000111
11111111
00000000
11111111
11111111
11111111
11111111
WAL true

TIL ca
00000001
11111101
11111101
01111101
01111101
10111101
10111101
11011101

TIL cb
11111100
11111110
11111110
11111111
11111111
11111111
11111111
11111111

TIL cc
11111111
11111111
11111111
11111111
11111110
11111101
11111100
11111101

TIL cd
11111111
11111001
11100101
10011101
01111101
11111101
00000001
11111111

TIL ce
11111111
10011111
10100111
10111001
10111110
10111111
10000000
11111111

TIL cf
11111111
11111111
11111111
11111111
01111111
10111111
00111111
10111111

TIL cg
00111111
01111111
01111111
11111111
11111111
11111111
11111111
11111111

TIL ch
10000000
10111111
10111111
10111110
10111110
10111101
10111001
10111011

TIL ci
00000000
00000000
01111111
11111111
00100000
00000000
00000000
00000000

TIL cj
00000000
00000000
11111111
11111111
00000000
00000000
00000000
00000000

TIL ck
00000000
00000000
11111110
11111111
00000100
00000000
00000000
00000000

TIL cl
11111110
11111101
11111011
11110111
00001111
11101111
01101111
10101111
WAL true

TIL cm
11111110
11111101
11111011
11110111
11101111
11011111
10111111
01111111
WAL true

TIL cn
11111111
11111111
11111111
11111111
11111111
11111110
11111100
11111000
WAL true

TIL co
11111111
11111111
11111111
11111111
11111111
01111111
00111111
00011111
WAL true

TIL cp
01111111
10111111
11011111
11101111
11110000
11110111
11110110
11110101
WAL true

TIL cq
00000000
11111111
00000000
11111111
00000000
11111111
00000000
11111111

TIL cr
00000000
11111111
00000000
01111111
00000000
00111111
00000000
00011111

TIL cs
00000000
11111111
00000000
01111111
00000000
00111111
00000000
00011111

TIL ct
00000000
11111111
00000000
11111110
00000000
11111100
00000000
11111000

TIL cu
11111101
10101010
01000101
10101000
00010101
10101010
01000101
10101000
WAL true

TIL cv
01101101
01101010
01101101
10101000
10101101
10101010
11001101
00001000
WAL true

TIL cw
11111111
01111111
01111111
10111111
10111111
11011111
11011111
11101111
WAL true

TIL cx
11101111
11011111
11011111
10111111
10111111
01111111
01111111
11111111
WAL true

TIL cy
11101010
11010101
11000000
11000000
11010101
11101010
00000000
00000000

TIL cz
01010101
10001000
01010101
11111010
00001101
11101000
10101101
01101010

TIL d0
01010101
10001000
01010101
11111111
00000000
11111111
11111111
11111111
WAL true

TIL d1
01101011
10100111
01100000
01111111
10101010
00010001
10101010
01000100
WAL true

TIL d2
01101111
10101111
01101111
10101111
01101111
10101111
01101111
10101111
WAL true

TIL d3
01010101
10101010
11111111
00000000
11111111
11111111
11111111
11111111
WAL true

TIL d4
01101111
10101111
11101111
00001111
11110111
11111011
11111101
11111110
WAL true

TIL d5
11111110
11111101
11111011
11110111
00001111
11101111
01101111
10101111
WAL true

TIL d6
11111000
11110100
11101100
11011100
00011100
11011100
01011000
11010000
WAL true

TIL d7
01111111
10111111
11011111
11101111
11110000
01110111
00110101
00010110
WAL true

TIL d8
01101111
10101111
11101111
00001111
11110111
11111011
11111101
11111110
WAL true

TIL d9
00000101
00000110
00000101
00000110
00000101
00000110
00000101
00000110
WAL true

TIL da
01101111
10101111
01101111
10101111
01100000
10111111
01010101
10101010
WAL true

TIL db
01010101
10101010
11111101
00000110
11110101
11110110
11110101
11110110
WAL true

TIL dc
00000000
00000000
00000000
00000000
00000000
11111111
01010101
10101010
WAL true

TIL dd
00000101
00000110
00000101
00000110
00000101
11111110
01010101
10101010
WAL true

TIL de
00000000
00000000
00000111
00000110
00000101
00000110
00000101
00000110
WAL true

TIL df
00000111
00000000
00000111
00000011
00000001
00000000
00000000
00000000
WAL true

TIL dh
00000000
00000000
00000000
00000000
00000000
00111111
00110101
00101010
WAL true

TIL di
00000000
00000000
00000000
00000000
00000000
11110100
01010110
10110111
WAL true

TIL dj
00000000
00000000
00000000
00000000
00000000
11100000
01101000
10101100
WAL true

TIL dk
01101110
10101111
01101111
10101111
01101111
10101111
01101111
10101111
WAL true

TIL dl
10000000
10000000
10000000
10000000
10000000
10000000
10000000
10000000

TIL dm
11111111
10101010
01010101
00000000
00000000
00000000
00000000
00000000
WAL true

TIL dn
11000000
10100000
01000000
00000000
00000000
00000000
00000000
00000000
WAL true

TIL do
11000000
10100000
11000000
10100000
11000000
10100000
11000000
10100000
WAL true

TIL dp
01000000
10100000
11000000
10100000
11000000
10100000
11000000
10100000
WAL true

TIL dq
01111111
00000000
00111111
00000000
01111111
00000000
00111111
00000000

TIL dr
11111110
00000000
11111100
00000000
11111110
00000000
11111100
00000000

TIL ds
11000101
10100011
11000101
10100011
11000101
10101011
11010101
11111111
WAL true

TIL dt
11000101
10100011
11000101
10100011
11000101
10100011
11000101
10100011
WAL true

TIL du
00000101
00000010
00000101
00000000
00000000
00000000
00000000
00000000
WAL true

TIL dv
00000101
00000011
00000101
00000011
00000101
00000011
00000101
00000011
WAL true

TIL dy
00000000
00000000
00000000
00000000
00000000
00000010
00000101
00000011
WAL true

TIL dz
11111111
10101010
11010101
10100000
11000000
10100000
11000000
10100000
WAL true

TIL e0
11000000
10100000
11000000
10100000
11000000
10101010
11010101
11111111
WAL true

TIL e1
11111111
10101011
01010101
00000011
00000101
00000011
00000101
00000011
WAL true

TIL e2
11111111
10101010
11010101
10100000
11000000
10100000
11000000
10100000
WAL true

TIL e3
11111111
10101011
01010101
00000011
00000101
00000011
00000101
00000011
WAL true

TIL e4
00000101
00000011
00000101
00000011
00000101
10101011
01010101
11111111
WAL true

TIL e5
00000000
00000000
00000000
00000000
00000000
00000000
11111111
10101010

TIL e6
01000000
11000000
01000000
11000000
01000000
11000000
01111111
10101010

TIL e7
01000000
11000000
01000000
11000000
01000000
11000000
01000000
11000000

TIL e8
01010101
11111111
01000000
11000000
01000000
11000000
01000000
11000000

TIL e9
01010101
11111111
00000000
00000000
00000000
00000000
00000000
00000000

TIL ea
01010101
11111110
00000011
00000010
00000011
00000010
00000011
00000010

TIL eb
00000011
00000010
00000011
00000010
00000011
00000010
00000011
00000010

TIL ec
01111111
00000000
00111111
00000000
01111111
00000000
00111111
00000000

TIL ed
11111100
00000000
11111000
00000000
11111100
00000000
11111000
00000000

TIL ee
00000000
00000000
00000000
00000000
00000000
10101010
01010101
11111111
WAL true

TIL ef
00000000
00000000
00000000
00000000
00000000
10100000
01000000
10100000

TIL eg
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
WAL false

TIL eh
01010000
10101000
11111000
10001000
11001000
10101000
10011000
10001000
WAL true

TIL ei
01010101
01101010
01111111
00000000
01111111
01111111
01111111
01111111
WAL true

TIL ej
01010101
10101010
11111111
00000000
11111110
11111110
11111110
11111110
WAL true

TIL ek
01000000
10100000
11000000
10100000
11000000
10100000
11000000
10100000
WAL true

TIL em
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
WAL true

TIL en
00000011
00000011
00000000
00000000
00000000
00000000
00000000
00000000
WAL true

TIL eo
11100100
11010100
11001101
11000100
11100100
11010100
11001101
11000100
WAL true

TIL ep
01101111
10101111
01101111
10101111
01101111
10101111
01101111
10101111
WAL true

TIL eq
01101111
10101111
11101111
00001111
11110111
11111011
11111101
11111110
WAL true

TIL er
00110100
00101000
00111100
00000000
00111100
00111100
00111100
00111100
WAL true

TIL es
10100000
01000000
10100000
00000000
00000000
00000000
00000000
00000000

TIL eu
11110000
11110000
11110000
11110000
00001111
00001111
00001111
00001111

TIL ev
00000000
01111110
00000000
01111110
00000000
01111110
00000000
01111110

TIL ew
11111110
11111110
11111110
00000000
10111010
00000000
01011101
00000000
WAL false

TIL ey
01111111
01111111
01111111
00000000
10111010
00000000
01011101
00000000
WAL false

TIL ez
10000000
11111111
10010010
01000101
00111111
00000000
00000000
00000000
>
10000000
11111111
10100100
01010000
00111111
00000000
00000000
00000000

TIL f0
00000101
11111101
01000111
00001011
11111111
00000000
00000000
00000000
>
00000101
11111101
00001111
11000011
11111111
00000000
00000000
00000000

TIL f1
11111110
11111110
11111110
11111110
11111110
11111110
11111110
11111110

TIL f2
00000000
00010000
01100000
00000000
00000100
00111000
00000000
00000000
>
00000000
00011000
00100100
00000000
01101000
10010000
00000000
00000000
WAL true

TIL f3
00000000
00010000
00101100
00000000
01000100
10000011
00000000
00000000
>
00000000
00100000
11011000
00000000
00110000
00001100
00000000
00000000
WAL true

TIL f4
00000000
00011000
00100100
10000000
00000001
00100100
00000010
00000000
>
00000000
00001000
00010100
00000000
01000000
10100110
00001000
00000000
WAL true

TIL f5
11110000
11110000
11110000
11110000
11111000
11111110
11111111
00000000
WAL true

TIL f6
00001111
00001111
00001111
00001111
00011111
01111111
11111111
00000000
WAL true

TIL f7
00100000
11100000
00100000
11100000
00100000
11100000
00100000
11100000

TIL f8
11101010
11010101
11000000
11000000
11010101
11101010
00000000
11110000

TIL f9
11011101
11100001
11111111
00000000
11111111
11111111
11111111
11111111
WAL false

TIL fa
10111011
10000111
11111111
00000000
11111111
11111111
11111111
11111111
WAL false

SPR 11
10100000
01010000
10101000
00000100
00000010
00000101
00110100
10110100
NAME Guard 1
DLG SPR_t
POS 8 14,8

SPR 12
00000000
10110100
00110100
00000101
00000010
01000100
10101000
01010000
NAME Guard 2
DLG SPR_s
POS 8 14,7

SPR 14
00000000
00000000
11100000
11100000
01010000
11000000
01000000
01000000
>
00000000
00000000
11100000
11100000
01010000
11000000
01000000
01000000
NAME Lucy
DLG SPR_i
POS 1a 1,11

SPR 15
01110000
01110000
00100000
01110000
01110000
01110000
00100000
00100000
NAME Jeeves
DLG SPR_j
POS 1a 2,11

SPR 16
00000000
00011011
10011010
01100011
01100011
01111000
01111010
01011010
NAME Harold
DLG SPR_l
POS 15 11,8

SPR 18
10101010
01010101
11111111
00000000
11111111
00100001
10101011
00000111
>
10101010
01010101
11111111
00000000
11111111
00001101
01010011
00000111
NAME Fireplace 2
DLG SPR_r
POS 15 11,7

SPR 19
10101010
01010101
11111111
00000000
11111111
10010010
11001000
11100001
>
10101010
01010101
11111111
00000000
11111111
10000100
11010110
11101000
DLG SPR_31
POS 15 10,7

SPR 20
11111000
00000000
11111000
11111000
10111000
11111000
11111000
00011000
DLG SPR_3s
POS f 10,3

SPR 21
01111111
01111111
01111111
01111111
01111111
01111111
01111111
01111111
DLG SPR_3t
POS h 10,13

SPR 22
00000000
01111111
01111111
01111111
00000000
01111111
01111111
01111111
DLG SPR_3u
POS h 10,12

SPR 23
00011111
00000000
00011111
00011111
00011101
00011111
00011111
00011000
DLG SPR_3v
POS h 6,9

SPR 24
11111000
00000000
11111000
11111000
10111000
11111000
11111000
00011000
DLG SPR_3w
POS h 7,9

SPR 25
11110000
00000000
11110000
11110000
11110000
00000000
00000000
00000000
POS i 10,12

SPR 26
01111111
01111111
01111111
01111111
01111111
00000000
01111111
01111111
POS i 14,14

SPR 27
00000000
01111111
01111111
01111111
01111111
01111111
01111111
01111111
POS i 14,13

SPR 28
00011111
00000000
00011111
00011111
00011101
00011111
00011111
00011000
POS i 13,12

SPR 29
11111000
00000000
11111000
11111000
10111000
11111000
11111000
00011000
POS i 14,12

SPR 39
00000000
11011111
11011111
11011111
11011111
11011111
11011111
11011111
DLG SPR_17
POS z 11,10

SPR 40
11111100
11111110
11000000
11000000
11010100
11111110
11111110
11000110
DLG SPR_1i

SPR 41
00111111
01111111
00000011
00000011
00101011
01111111
01100011
01100011
DLG SPR_1j

SPR 42
00111111
01111111
00000011
00000011
00101011
01111111
01100011
01100011
DLG SPR_1k

SPR 43
00111111
01111111
00000011
00000011
00101011
01111111
01100011
01100011
DLG SPR_1l

SPR 44
00111111
01111111
00000011
00000011
00101011
01111111
01100011
01100011
DLG SPR_1m

SPR 45
00111111
01111111
00000011
00000011
00101011
01111111
01100011
01100011
DLG SPR_1n

SPR 46
00000000
00111000
01000100
10010010
10111010
10010010
10010010
10000010
POS 13 7,4

SPR 47
00000000
00010000
00011000
00100100
01000100
01010100
00101000
00011000
>
00000000
00000100
00001100
00010100
00100110
00101010
00100100
00011000
DLG SPR_1x
POS 13 3,4

SPR 48
00000000
00010000
00011000
00100100
01000100
01010100
00101000
00011000
>
00000000
00000100
00001100
00010100
00100110
00101010
00100100
00011000
DLG SPR_1w
POS 13 3,6

SPR 49
00000000
00010000
00011000
00100100
01000100
01010100
00101000
00011000
>
00000000
00000100
00001100
00010100
00100110
00101010
00100100
00011000
DLG SPR_1v
POS 13 3,8

SPR 50
00000000
01111110
10000001
10101101
10000001
01111110
00011000
00011000
NAME Marketplace
DLG SPR_27
POS s 9,1

SPR 51
00000000
01111110
10000001
10110101
10000001
01111110
00011000
00011000
NAME Castle Entrance
DLG SPR_28

SPR 52
00000000
01111110
10000001
10101101
10000001
01111110
00011000
00011000
NAME Marketplace
DLG SPR_29

SPR 53
00000000
01111110
10000001
10101101
10000001
01111110
00011000
00011000
NAME Marketplace
DLG SPR_2a
POS 5 14,5

SPR 54
00000000
01111110
10000001
10101101
10000001
01111110
00011000
00011000
NAME Marketplace
DLG SPR_2b

SPR 55
00000000
01111110
10000001
10101101
10000001
01111110
00011000
00011000
NAME Drawbridge Sign
DLG SPR_7

SPR 56
00000000
00000000
00000000
00000000
00000000
00010000
00010000
00010000
NAME Dying Flower
DLG SPR_z
POS b 3,9

SPR 57
00000000
00000000
00000000
00000000
00010000
00101000
00100000
00100000
DLG SPR_10
POS b 4,9

SPR 58
00000000
00000000
00000000
00000100
00000100
00000100
00100100
00110100
DLG SPR_11
POS b 4,11

SPR 59
00000000
00000000
00000100
00000000
00001100
00000110
00000100
00000100
DLG SPR_12
POS b 3,11

SPR 66
11111110
11111110
11111110
11111110
11111110
11111110
11111110
11111110
POS h 11,13

SPR 67
00000000
11111110
11111110
11111110
00000000
11111110
11111110
11111110
POS h 11,12

SPR 68
00000000
00001000
00010000
00010000
11010000
11100000
00010000
10010000
DLG SPR_5d
POS 6 7,6

SPR 69
00000000
00000000
01111110
01111110
01111110
00000000
01000010
01000010
DLG SPR_5e
POS 6 6,6

SPR 70
00000000
11111110
11111110
11111110
00000000
11111110
11111110
11111110
DLG SPR_2x
POS 1c 11,4

SPR 71
11111110
11111110
11111110
11111110
11111110
11111110
11111110
11111110
POS 1c 11,5

SPR 72
00000000
01111110
11111111
11111111
11011011
11011011
11111111
00000000
>
00000000
01111110
11111111
11111111
11011011
11011011
11111111
00000000
DLG SPR_30
POS 1c 11,11

SPR 73
11111111
10000000
10000000
10000000
11111111
11111111
01111111
01111101
DLG SPR_2t
POS 1c 7,4

SPR 74
11111111
00000001
00000001
00000001
11111111
11111111
11111110
10111110
DLG SPR_2u
POS 1c 8,4

SPR 75
00111111
00111111
00011111
00000000
00000000
00000000
00000000
00000000
DLG SPR_2v
POS 1c 7,5

SPR 76
11111100
11111100
11111000
00000000
00000000
00000000
00000000
00000000
DLG SPR_2w
POS 1c 8,5

SPR 77
00000000
00100000
00100000
00100000
00000000
00000000
00000000
00000000
DLG SPR_a
POS 1c 4,5

SPR 78
00000000
00000100
00000100
00000100
00000000
00000000
00000000
00000000
DLG SPR_14
POS 1c 5,5

SPR 79
00000000
00000001
00000010
00000010
00011010
00011100
00000010
00010010
DLG SPR_2y
POS 1c 11,8

SPR 80
00000000
00000100
00000100
00000100
00000000
00000000
00000000
00000000
DLG SPR_1d
POS 1m 5,5

SPR 81
00000000
00100000
00100000
00100000
00000000
00000000
00000000
00000000
DLG SPR_4k
POS 1m 4,5

SPR 82
11111100
11111100
11111000
00000000
00000000
00000000
00000000
00000000
DLG SPR_4h
POS 1m 8,5

SPR 83
00111111
00111111
00011111
00000000
00000000
00000000
00000000
00000000
DLG SPR_4i
POS 1m 7,5

SPR 84
11111111
00000001
00000001
00000001
11111111
11111111
11111110
10111110
DLG SPR_4g
POS 1e 8,4

SPR 85
11111111
10000000
10000000
10000000
11111111
11111111
01111111
01111101
DLG SPR_4j
POS 1e 7,4

SPR 86
00000000
01111110
11111111
11111111
11011011
11011011
11111111
00000000
>
00000000
01111110
11111111
11111111
11011011
11011011
11111111
00000000
DLG SPR_4b
POS 1e 11,11

SPR 87
11111110
11111110
11111110
11111110
11111110
11111110
11111110
11111110
POS 1e 11,5

SPR 88
00000000
11111110
11111110
11111110
00000000
11111110
11111110
11111110
POS 1e 11,4

SPR 89
00000000
11111110
11110110
11101010
10110110
01011110
10111110
11111110
DLG SPR_46
POS 1e 5,4

SPR 90
10000000
11111111
01100101
00101000
00011111
00000000
00000000
00000000
>
10000000
11111111
01011000
00100100
00011111
00000000
00000000
00000000
DLG SPR_58
POS 1t 7,4

SPR 91
00001001
11111001
00010101
01100011
11111111
00000000
00000000
00000000
>
00001001
11111001
00100101
00001011
11111111
00000000
00000000
00000000
DLG SPR_59
POS 1t 8,4

SPR 92
01111110
01001010
01010010
01001010
01111110
00000000
01111110
01010010
>
01111110
01010010
01001010
01010010
01111110
00000000
01111110
01001010
DLG SPR_5a
POS 1t 11,7

SPR 93
01001010
01010010
01111110
00000000
01111110
01111110
00000000
00000000
>
01010010
01001010
01111110
00000000
01111110
01111110
00000000
00000000
DLG SPR_5b
POS 1t 11,8

SPR 94
00000000
00001000
00010000
00010000
11010000
11100000
00010000
10010000
POS 1t 7,6

SPR 95
00000000
00000000
01111110
01111110
01111110
00000000
01000010
01000010
POS 1t 6,6

SPR 96
00000000
00010000
00001000
00001000
00001011
00000111
00001000
00001001
POS 1t 5,6

SPR 97
00000000
00000000
00010000
01110010
00111010
00100010
01111110
01111111
>
00000000
00000000
00100000
00111010
01110010
00010010
01111110
01111111
DLG SPR_5f
POS 1t 5,10

SPR 98
01010000
00000000
01010000
00100000
00100000
00100000
00100000
01110000
>
00000000
00100000
00000000
00100000
00100000
00100000
00100000
01110000
DLG SPR_5g
POS 1v 2,6

SPR 99
01010000
00000000
01010000
00100000
00100000
00100000
00100000
01110000
>
00000000
00100000
00000000
00100000
00100000
00100000
00100000
01110000
DLG SPR_5h
POS 1v 2,12

SPR A
00011000
00011000
00111100
00111100
00111100
00111100
00011000
00011000
>
00011000
00011000
00111100
00111100
01011010
01011010
00011000
00011000
POS 1c 7,7

SPR d
00000000
00011000
00011000
01111110
01111110
00111100
00100100
01100110
>
00000000
00011000
00011000
01111110
10111101
00111100
00100100
01100110
NAME Jason
DLG SPR_m
POS 14 4,8

SPR f
00000000
01111110
10000001
10111001
10000001
01111110
00011000
00011000
NAME Garden Signpost
DLG SPR_0

SPR g
00000000
01111110
10000001
10110101
10000001
01111110
00011000
00011000
NAME Castle Signpost
DLG SPR_1

SPR h
00000000
01111110
10000001
10101101
10000001
01111110
00011000
00011000
NAME Marketplace Signpost
DLG SPR_2

SPR i
00000000
00011000
00011000
01100000
01100000
01111000
01111000
01011000
>
00000000
00011000
00011000
01100000
01100000
01111000
01111000
01011000
NAME Gary
DLG SPR_3
POS b 2,7

SPR j
00000000
01111110
10000001
10101101
10000001
01111110
00011000
00011000
NAME Drawbridge Sign
DLG SPR_4

SPR k
00000000
01111110
10000001
10110101
10000001
01111110
00011000
00011000
NAME Residences A
DLG SPR_5

SPR l
00000000
01111110
10000001
10110101
10000001
01111110
00011000
00011000
NAME Residence B
DLG SPR_6

SPR m
00000000
01111110
10000001
10110101
10000001
01111110
00011000
00011000
NAME Residence C
DLG SPR_h

SPR v
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
NAME Special Stall
DLG SPR_8
POS 14 10,10

SPR 1h
00000000
00100100
00111100
01011010
00111100
00111100
00011000
00011000
NAME Weaver
DLG SPR_n
POS 6 4,10

SPR 1i
00000000
00000000
00010000
01110010
00111010
00100010
01111110
01111111
>
00000000
00000000
00100000
00111010
01110010
00010010
01111110
01111111
NAME Weaving Machine
DLG SPR_o
POS 6 5,10

SPR 1k
00000000
11011111
11011111
11011111
11011111
11011111
11011111
11011111
NAME Bed (Inactive)
DLG SPR_3f
POS j 3,7

SPR 1l
00000000
11111110
11111110
11111110
11111110
11111110
11111110
11111110
NAME Bed (Inactive)
DLG SPR_3g
POS j 4,7

SPR 1m
11111111
11111111
11101111
11110111
11111011
10111111
11111111
11111111
DLG SPR_3l
POS j 7,5

SPR 1n
00000000
00000000
00001011
00001011
00001011
00001011
00001011
00000000
DLG SPR_3m
POS j 6,6

SPR 1o
11111111
11111111
11110011
10111111
10011111
11011111
11111111
11111111
DLG SPR_3k
POS j 7,6

SPR 1p
00000000
00000000
00001011
00001011
00001011
00001011
00001011
00000000

SPR 1q
00011111
00000000
00011111
00011111
00011101
00011111
00011111
00011000
DLG SPR_3o
POS j 3,3

SPR 1r
11111000
00000000
11111000
11111000
10111000
11111000
11111000
00011000
DLG SPR_3n
POS j 4,3

SPR 1t
00000000
11011111
11011111
11011111
11011111
11011111
11011111
11011111
DLG SPR_3p
POS f 11,10

SPR 1u
00000000
11111110
11111110
11111110
11111110
11111110
11111110
11111110
DLG SPR_3q
POS f 12,10

SPR 1v
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
DLG SPR_3h
POS f 9,8

SPR 1w
00000000
11010000
11010000
11010000
11010000
11010000
00000000
00000000
DLG SPR_3j
POS f 10,8

SPR 1x
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
DLG SPR_3i
POS f 9,7

SPR 1y
00111100
00000000
00111100
00111100
00111100
00000000
00000000
00000000
POS i 9,12

SPR 1z
00011111
00000000
00011111
00011111
00011101
00011111
00011111
00011000
DLG SPR_3r
POS f 9,3

SPR 2a
11111111
11100111
11101111
11111111
10011111
11011011
11110011
11111111
DLG SPR_3z
POS h 3,14

SPR 2b
11111111
11111111
10000101
10000111
10000101
10000101
10000111
11111111
DLG SPR_40
POS h 4,14

SPR 2c
00000000
00000000
00000000
00000000
00011110
00000000
00011110
00011110
DLG SPR_3x
POS h 3,13

SPR 2d
00000000
00000000
00000000
00000000
01111000
00000000
01111000
01111000
DLG SPR_3y
POS h 4,13

SPR 2e
00000000
00000000
00000000
01111110
01111110
01111110
01100110
01111110
>
00000000
00000000
01111110
01000010
00111100
01111110
01100110
01111110
DLG SPR_u

SPR 2f
00000000
01111110
10000001
10110001
10000001
01111110
00011000
00011000
NAME To City Gates
DLG SPR_v

SPR 2g
00000000
01111110
10000001
10101001
10000001
01111110
00011000
00011000
NAME Castle
DLG SPR_w

SPR 2h
00111100
00100100
01011010
01011010
00111100
00111100
00011000
00011000
NAME Nun
DLG SPR_6v
POS 16 12,6

SPR 2i
00000000
11011111
11011111
11011111
11011111
11011111
11011111
11011111

SPR 2j
00000000
11111110
11111110
11111110
11111110
11111110
11111110
11111110

SPR 2k
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111

SPR 2l
00000000
00000000
00001011
00001011
00001011
00001011
00001011
00000000

SPR 2m
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111

SPR 2n
00000000
00000000
00001011
00001011
00001011
00001011
00001011
00000000

SPR 2o
00011111
00000000
00011111
00011111
00011101
00011111
00011111
00011000

SPR 2p
11111000
00000000
11111000
11111000
10111000
11111000
11111000
00011000

SPR 2q
00000000
11011111
11011111
11011111
11011111
11011111
11011111
11011111
POS k 3,7

SPR 2r
00000000
11111110
11111110
11111110
11111110
11111110
11111110
11111110
POS k 4,7

SPR 2s
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
POS k 7,5

SPR 2t
00000000
00000000
00001011
00001011
00001011
00001011
00001011
00000000

SPR 2u
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
POS k 7,6

SPR 2v
00000000
00000000
00001011
00001011
00001011
00001011
00001011
00000000
POS k 6,6

SPR 2w
00011111
00000000
00011111
00011111
00011101
00011111
00011111
00011000
POS k 3,3

SPR 2y
11111000
00000000
11111000
11111000
10111000
11111000
11111000
00011000
POS k 4,3

SPR 3a
00000000
11111110
11111110
11111110
11111110
11111110
11111110
11111110
DLG SPR_18
POS z 12,10

SPR 3b
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
POS z 9,6

SPR 3c
00000000
11010000
11010000
11010000
11010000
11010000
00000000
00000000
POS z 10,7

SPR 3d
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
POS z 9,7

SPR 3e
00011111
00000000
00011111
00011111
00011101
00011111
00011111
00011000
POS z 9,3

SPR 3f
11111000
00000000
11111000
11111000
10111000
11111000
11111000
00011000
POS z 10,3

SPR 3g
00000000
00000000
00000000
01111110
01111110
01111110
01100110
01111110
>
00000000
00000000
01111110
01000010
00111100
01111110
01100110
01111110
DLG SPR_16

SPR 3h
01111111
01111111
01111111
01111111
01111111
00000000
01111111
01111111
DLG SPR_19
POS 10 7,12

SPR 3i
00000000
01111111
01111111
01111111
01111111
01111111
01111111
01111111
DLG SPR_1a
POS 10 7,11

SPR 3j
00011111
00000000
00011111
00011111
00011101
00011111
00011111
00011000
POS 10 6,9

SPR 3k
11111000
00000000
11111000
11111000
10111000
11111000
11111000
00011000
POS 10 7,9

SPR 3l
00000000
00000000
00000000
11010000
11010000
11010000
11010000
00000000
POS 10 4,11

SPR 3m
00000000
11010000
11010000
11010000
11010000
00000000
00000000
00000000
POS 10 4,12

SPR 3n
01111111
01111111
01111111
01111111
01111111
00000000
01111111
01111111
DLG SPR_1b
POS 11 14,14

SPR 3o
00000000
01111111
01111111
01111111
01111111
01111111
01111111
01111111
DLG SPR_1c
POS 11 14,13

SPR 3p
00011111
00000000
00011111
00011111
00011101
00011111
00011111
00011000
POS 11 13,12

SPR 3q
11111000
00000000
11111000
11111000
10111000
11111000
11111000
00011000
POS 11 14,12

SPR 3r
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
POS 10 3,12

SPR 3s
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111
POS 10 3,11

SPR 3t
00111100
00000000
00111100
00111100
00111100
00000000
00000000
00000000
POS 11 9,12

SPR 3u
11110000
00000000
11110000
11110000
11110000
00000000
00000000
00000000
POS 11 10,12

SPR 3w
11111100
11111110
11000000
11000000
11010100
11111110
11111110
11000110
DLG SPR_1e

SPR 3x
11111100
11111110
11000000
11000000
11010100
11111110
11111110
11000110
DLG SPR_1f

SPR 3y
11111100
11111110
11000000
11000000
11010100
11111110
11111110
11000110
DLG SPR_1g

SPR 3z
11111100
11111110
11000000
11000000
11010100
11111110
11111110
11000110
DLG SPR_1h

SPR 4a
00000000
00010000
00011000
00100100
01000100
01010100
00101000
00011000
>
00000000
00000100
00001100
00010100
00100110
00101010
00100100
00011000
DLG SPR_1u
POS 13 3,10

SPR 4b
00000000
00010000
00011000
00100100
01000100
01010100
00101000
00011000
>
00000000
00000100
00001100
00010100
00100110
00101010
00100100
00011000
DLG SPR_1t
POS 13 3,12

SPR 4c
00000000
00010000
00011000
00100100
01000100
01010100
00101000
00011000
>
00000000
00000100
00001100
00010100
00100110
00101010
00100100
00011000
DLG SPR_1s
POS 13 12,4

SPR 4d
00000000
00010000
00011000
00100100
01000100
01010100
00101000
00011000
>
00000000
00000100
00001100
00010100
00100110
00101010
00100100
00011000
DLG SPR_1r
POS 13 12,6

SPR 4e
00000000
00010000
00011000
00100100
01000100
01010100
00101000
00011000
>
00000000
00000100
00001100
00010100
00100110
00101010
00100100
00011000
DLG SPR_1q
POS 13 12,8

SPR 4f
00000000
00010000
00011000
00100100
01000100
01010100
00101000
00011000
>
00000000
00000100
00001100
00010100
00100110
00101010
00100100
00011000
DLG SPR_1p
POS 13 12,10

SPR 4g
00000000
00010000
00011000
00100100
01000100
01010100
00101000
00011000
>
00000000
00000100
00001100
00010100
00100110
00101010
00100100
00011000
DLG SPR_1o
POS 13 12,12

SPR 4i
00000000
11011111
11011111
11011111
11011111
11011111
11011111
11011111

SPR 4j
00000000
11111110
11111110
11111110
11111110
11111110
11111110
11111110

SPR 4k
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111

SPR 4l
00000000
00000000
00001011
00001011
00001011
00001011
00001011
00000000

SPR 4m
11111111
11111111
11111111
11111111
11111111
11111111
11111111
11111111

SPR 4n
00011111
00000000
00011111
00011111
00011101
00011111
00011111
00011000

SPR 4o
11111000
00000000
11111000
11111000
10111000
11111000
11111000
00011000

SPR 4p
00000000
01111110
10000001
10111001
10000001
01111110
00011000
00011000
NAME To Garden
DLG SPR_1y
POS l 8,0

SPR 4q
00000000
01111110
10000001
10110101
10000001
01111110
00011000
00011000
NAME Castle
DLG SPR_1z
POS l 0,7

SPR 4r
00000000
01111110
10000001
10101101
10000001
01111110
00011000
00011000
NAME Marketplace
DLG SPR_20
POS l 11,15

SPR 4s
00000000
01111110
10000001
10110101
10000001
01111110
00011000
00011000
NAME Castle Entrance
DLG SPR_21
POS n 3,1

SPR 4t
00000000
01111110
10000001
10110101
10000001
01111110
00011000
00011000
NAME To Residence A
DLG SPR_22
POS n 14,0

SPR 4u
00000000
01111110
10000001
10110101
10000001
01111110
00011000
00011000
NAME Residence B
DLG SPR_23
POS n 1,6

SPR 4v
00000000
01111110
10000001
10110101
10000001
01111110
00011000
00011000
NAME City Gates
DLG SPR_24
POS n 10,14

SPR 4w
00000000
01111110
10000001
10110001
10000001
01111110
00011000
00011000

SPR 4x
00000000
01111110
10000001
10101001
10000001
01111110
00011000
00011000

SPR 4y
00000000
01111110
10000001
10101101
10000001
01111110
00011000
00011000
NAME Marketplace 2
DLG SPR_25
POS o 4,14

SPR 4z
00000000
01111110
10000001
10101101
10000001
01111110
00011000
00011000
NAME Marketplace
DLG SPR_26
POS q 14,5

SPR 5a
00000000
00000000
00000000
00010000
01101000
00101000
00001000
00001000
DLG SPR_32
POS b 5,11

SPR 5b
00000000
00000000
00000000
00010000
00101100
00101000
00100000
00100000
DLG SPR_33
POS b 3,13

SPR 5c
00000000
00000000
00000000
00000000
00000000
00000000
00010000
00010000
DLG SPR_34
POS b 4,13

SPR 5d
00000000
00000000
00000000
00101000
00010000
00010000
00010000
00010110
DLG SPR_35
POS b 5,13

SPR 5e
00000000
11111110
10101110
00011110
11111110
00000000
00000010
00000010
DLG SPR_36
POS 15 12,8

SPR 5f
10101111
01101111
10101000
01101000
10101100
01101010
10101111
01101111
POS 15 7,10

SPR 5g
10000000
10000000
10000000
10000000
10000000
10000000
10000000
10000000

SPR 5h
10101111
01101111
10101000
01101000
10101100
01101010
10101111
01101111
POS 15 7,13

SPR 5i
00000000
01111110
10000001
10101101
10000001
01111110
00011000
00011000

SPR 5j
01010000
00000000
01010000
00100000
00100000
00100000
00100000
01110000
>
00000000
00100000
00000000
00100000
00100000
00100000
00100000
01110000
DLG SPR_3a
POS 16 2,12

SPR 5k
00001010
00000000
00001010
00000100
00000100
00000100
00000100
00001110
>
00000000
00000100
00000000
00000100
00000100
00000100
00000100
00001110
DLG SPR_39
POS 16 13,12

SPR 5l
00001010
00000000
00001010
00000100
00000100
00000100
00000100
00001110
>
00000000
00000100
00000000
00000100
00000100
00000100
00000100
00001110
DLG SPR_37
POS 16 13,6

SPR 5m
01010000
00000000
01010000
00100000
00100000
00100000
00100000
01110000
>
00000000
00100000
00000000
00100000
00100000
00100000
00100000
01110000
DLG SPR_38
POS 16 2,6

SPR 5n
00000000
11111111
10000000
10010011
10000000
11111111
00000000
01000000
>
00000000
11111111
10101000
10000011
10101000
11111111
00000000
01000000
DLG SPR_3b
POS 16 7,6

SPR 5o
00000000
11111111
00000001
00001001
00000001
11111111
00000000
00000010
>
00000000
11111111
00010101
00000001
00010101
11111111
00000000
00000010
DLG SPR_3c
POS 16 8,6

SPR 6a
00000000
00010000
00001000
00001000
00001011
00000111
00001000
00001001
DLG SPR_5c
POS 6 5,6

SPR 6b
01111110
01001010
01010010
01001010
01111110
00000000
01111110
01010010
>
01111110
01010010
01001010
01010010
01111110
00000000
01111110
01001010
DLG SPR_2o
POS 6 11,7

SPR 6c
01001010
01010010
01111110
00000000
01111110
01111110
00000000
00000000
>
01010010
01001010
01111110
00000000
01111110
01111110
00000000
00000000
DLG SPR_3e
POS 6 11,8

SPR 6d
10000000
11111111
01100101
00101000
00011111
00000000
00000000
00000000
>
10000000
11111111
01011000
00100100
00011111
00000000
00000000
00000000
DLG SPR_2m
POS 6 7,4

SPR 6e
00001001
11111001
00010101
01100011
11111111
00000000
00000000
00000000
>
00001001
11111001
00100101
00001011
11111111
00000000
00000000
00000000
DLG SPR_2n
POS 6 8,4

SPR 6g
00000000
01111111
01111001
01111001
00000000
01111111
01111111
01111111
DLG SPR_2c
POS 1d 4,4

SPR 6h
01111111
01111111
01111111
01111111
01111111
01111111
01111111
01111111
DLG SPR_2d
POS 1d 4,5

SPR 6i
00000000
11111111
11011111
11101110
11111111
00000000
01000000
01000000
DLG SPR_2e
POS 1d 7,4

SPR 6j
00000000
11111110
11111110
01111110
11111110
00000000
00000100
00000100
DLG SPR_2f
POS 1d 8,4

SPR 6k
00000000
00100000
00010000
00010000
00010110
00001110
00010000
00010010
DLG SPR_2g
POS 1d 6,4

SPR 6l
00000000
00000001
00000010
00000010
00011010
00011100
00000010
00010010
DLG SPR_2z
POS 1c 11,9

SPR 6m
00000000
00000000
10001110
11011111
00000000
11011111
11011111
11011111
DLG SPR_2h
POS 1d 11,4

SPR 6n
00000000
00000000
00000011
00000111
00000000
00000111
00000111
00000111
DLG SPR_2i
POS 1d 10,4

SPR 6o
00010000
00111100
00011100
01110100
01110100
01010100
00010000
00111000
DLG SPR_2j
POS 1d 4,9

SPR 6p
00000000
01111110
11111111
00000000
11111111
11011011
11011011
11111111
>
00000000
00000000
01111110
11111111
11111111
11011011
11011011
11111111
DLG SPR_67
POS 1d 4,11

SPR 6q
10000000
11111111
01100101
00101000
00011111
00000000
00000000
00000000
>
10000000
11111111
01011000
00100100
00011111
00000000
00000000
00000000
DLG SPR_2k
POS 4 10,4

SPR 6r
00001001
11111001
00010101
01100011
11111111
00000000
00000000
00000000
>
00001001
11111001
00100101
00001011
11111111
00000000
00000000
00000000
DLG SPR_2l
POS 4 11,4

SPR 6s
00000000
00001000
00010000
00010000
11010000
11100000
00010000
10010000
DLG SPR_2s
POS 4 11,5

SPR 6t
00000000
00010000
00001000
00001000
00001011
00000111
00001000
00001001
DLG SPR_2r
POS 4 9,5

SPR 6u
00000000
00000000
01111110
01111110
01111110
00000000
01000010
01000010
DLG SPR_2q
POS 4 10,5

SPR 6v
01111110
01001010
01010010
01001010
01111110
00000000
01111110
01010010
>
01111110
01010010
01001010
01010010
01111110
00000000
01111110
01001010
DLG SPR_3d
POS 4 4,10

SPR 6w
01001010
01010010
01111110
00000000
01111110
01111110
00000000
00000000
>
01010010
01001010
01111110
00000000
01111110
01111110
00000000
00000000
DLG SPR_2p
POS 4 4,11

SPR 6x
00010000
00110000
00011000
00010000
00110000
00010000
00010000
00111000
DLG SPR_41
POS 4 11,10

SPR 6y
00000000
01111111
01111111
01100011
01100011
01100011
01100011
01111111
DLG SPR_42
POS 1c 4,4

SPR 6z
00000000
11111110
11110110
11101010
10110110
01011110
10111110
11111110
DLG SPR_43
POS 1c 5,4

SPR 7a
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_9
POS 14 3,8

SPR 7b
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_b
POS 14 7,8

SPR 7c
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_c
POS 14 10,8

SPR 7d
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_d
POS 14 13,8

SPR 7e
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_e
POS 14 4,6

SPR 7f
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_f
POS 14 4,11

SPR 7g
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_g
POS 14 7,5

SPR 7h
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_k
POS 14 10,6

SPR 7i
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_p
POS 14 12,4

SPR 7j
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_q
POS 14 1,5

SPR 7k
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_x
POS 14 7,11

SPR 7l
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_y
POS 14 12,10

SPR 7m
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_13

SPR 7n
00000000
00000100
00000100
00000100
00000000
00000000
00000000
00000000
DLG SPR_15
POS 1e 5,5

SPR 7o
00000000
00100000
00100000
00100000
00000000
00000000
00000000
00000000
DLG SPR_4l
POS 1e 4,5

SPR 7p
11111100
11111100
11111000
00000000
00000000
00000000
00000000
00000000
DLG SPR_4f
POS 1e 8,5

SPR 7q
00111111
00111111
00011111
00000000
00000000
00000000
00000000
00000000
DLG SPR_4e
POS 1e 7,5

SPR 7r
11111111
00000001
00000001
00000001
11111111
11111111
11111110
10111110
DLG SPR_4c
POS 1m 8,4

SPR 7s
11111111
10000000
10000000
10000000
11111111
11111111
01111111
01111101
DLG SPR_4d
POS 1m 7,4

SPR 7t
00000000
01111110
11111111
11111111
11011011
11011011
11111111
00000000
>
00000000
01111110
11111111
11111111
11011011
11011011
11111111
00000000
DLG SPR_4a
POS 1m 11,11

SPR 7u
11111110
11111110
11111110
11111110
11111110
11111110
11111110
11111110
DLG SPR_4x
POS 1m 11,5

SPR 7v
00000000
11111110
11111110
11111110
00000000
11111110
11111110
11111110
DLG SPR_4w
POS 1m 11,4

SPR 7w
00000000
11111110
11110110
11101010
10110110
01011110
10111110
11111110
DLG SPR_45
POS 1m 5,4

SPR 7x
00000000
01111111
01111111
01100011
01100011
01100011
01100011
01111111
POS 1m 4,4

SPR 7y
00000000
00000001
00000010
00000010
00011010
00011100
00000010
00010010
DLG SPR_48
POS 1m 11,7

SPR 7z
00000000
00000001
00000010
00000010
00011010
00011100
00000010
00010010
DLG SPR_47
POS 1m 11,8

SPR 8a
00000000
01111111
01111111
01100011
01100011
01100011
01100011
01111111
POS 1e 4,4

SPR 8b
00000000
00000001
00000010
00000010
00011010
00011100
00000010
00010010
DLG SPR_49
POS 1e 11,7

SPR 8c
00000000
00000001
00000010
00000010
00011010
00011100
00000010
00010010
DLG SPR_4t
POS 1e 11,8

SPR 8d
00000000
00000100
00000100
00000100
00000000
00000000
00000000
00000000
DLG SPR_44
POS 1n 5,5

SPR 8e
00000000
00100000
00100000
00100000
00000000
00000000
00000000
00000000
DLG SPR_4m
POS 1n 4,5

SPR 8f
11111100
11111100
11111000
00000000
00000000
00000000
00000000
00000000
DLG SPR_4n
POS 1n 8,5

SPR 8g
00111111
00111111
00011111
00000000
00000000
00000000
00000000
00000000
DLG SPR_4o
POS 1n 7,5

SPR 8h
11111111
00000001
00000001
00000001
11111111
11111111
11111110
10111110
DLG SPR_4p
POS 1n 8,4

SPR 8i
11111111
10000000
10000000
10000000
11111111
11111111
01111111
01111101
DLG SPR_4q
POS 1n 7,4

SPR 8j
00000000
01111110
11111111
11111111
11011011
11011011
11111111
00000000
>
00000000
01111110
11111111
11111111
11011011
11011011
11111111
00000000
DLG SPR_4r
POS 1n 11,11

SPR 8k
11111110
11111110
11111110
11111110
11111110
11111110
11111110
11111110
POS 1n 11,5

SPR 8l
00000000
11111110
11111110
11111110
00000000
11111110
11111110
11111110
POS 1n 11,4

SPR 8m
00000000
11111110
11110110
11101010
10110110
01011110
10111110
11111110
DLG SPR_4s
POS 1n 5,4

SPR 8n
00000000
01111111
01111111
01100011
01100011
01100011
01100011
01111111
POS 1n 4,4

SPR 8o
00000000
00000001
00000010
00000010
00011010
00011100
00000010
00010010
DLG SPR_4u
POS 1n 11,8

SPR 8p
00000000
00000001
00000010
00000010
00011010
00011100
00000010
00010010
DLG SPR_4v
POS 1n 11,7

SPR 8q
10000000
11111111
01100101
00101000
00011111
00000000
00000000
00000000
>
10000000
11111111
01011000
00100100
00011111
00000000
00000000
00000000
DLG SPR_54
POS 1o 10,4

SPR 8r
00001001
11111001
00010101
01100011
11111111
00000000
00000000
00000000
>
00001001
11111001
00100101
00001011
11111111
00000000
00000000
00000000
DLG SPR_53
POS 1o 11,4

SPR 8s
00000000
00001000
00010000
00010000
11010000
11100000
00010000
10010000
DLG SPR_55
POS 1o 11,5

SPR 8t
00000000
00010000
00001000
00001000
00001011
00000111
00001000
00001001
DLG SPR_4y
POS 1o 9,5

SPR 8u
00000000
00000000
01111110
01111110
01111110
00000000
01000010
01000010
DLG SPR_4z
POS 1o 10,5

SPR 8v
01111110
01001010
01010010
01001010
01111110
00000000
01111110
01010010
>
01111110
01010010
01001010
01010010
01111110
00000000
01111110
01001010
DLG SPR_50
POS 1o 4,10

SPR 8w
01001010
01010010
01111110
00000000
01111110
01111110
00000000
00000000
>
01010010
01001010
01111110
00000000
01111110
01111110
00000000
00000000
DLG SPR_51
POS 1o 4,11

SPR 8x
00010000
00110000
00011000
00010000
00110000
00010000
00010000
00111000
DLG SPR_52
POS 1o 11,10

SPR 8y
00000000
10110100
00110100
00000101
00000010
01000100
10101000
01010000
DLG SPR_56
POS 1s 14,7

SPR 8z
10100000
01010000
10101000
00000100
00000010
00000101
00110100
10110100
DLG SPR_57
POS 1s 14,8

SPR 9a
00001010
00000000
00001010
00000100
00000100
00000100
00000100
00001110
>
00000000
00000100
00000000
00000100
00000100
00000100
00000100
00001110
DLG SPR_5i
POS 1v 13,6

SPR 9b
00001010
00000000
00001010
00000100
00000100
00000100
00000100
00001110
>
00000000
00000100
00000000
00000100
00000100
00000100
00000100
00001110
DLG SPR_5j
POS 1v 13,12

SPR 9c
00000000
11111111
10000000
10010011
10000000
11111111
00000000
01000000
>
00000000
11111111
10101000
10000011
10101000
11111111
00000000
01000000
DLG SPR_5k
POS 1v 7,6

SPR 9d
00000000
11111111
00000001
00001001
00000001
11111111
00000000
00000010
>
00000000
11111111
00010101
00000001
00010101
11111111
00000000
00000010
DLG SPR_5l
POS 1v 8,6

SPR 9e
00000000
00000000
00000000
00000000
00000000
00010000
00010000
00010000
DLG SPR_5m
POS 1w 3,9

SPR 9f
00000000
00000000
00000000
00000000
00010000
00101000
00100000
00100000
DLG SPR_5n
POS 1w 4,9

SPR 9g
00000000
00000000
00000000
00000100
00000100
00000100
00100100
00110100
DLG SPR_5o
POS 1w 4,11

SPR 9h
00000000
00000000
00000100
00000000
00001100
00000110
00000100
00000100
DLG SPR_5p
POS 1w 3,11

SPR 9i
00000000
00000000
00000000
00010000
01101000
00101000
00001000
00001000
DLG SPR_5q
POS 1w 5,11

SPR 9j
00000000
00000000
00000000
00010000
00101100
00101000
00100000
00100000
DLG SPR_5r
POS 1w 3,13

SPR 9k
00000000
00000000
00000000
00000000
00000000
00000000
00010000
00010000
DLG SPR_5s
POS 1w 4,13

SPR 9l
00000000
00000000
00000000
00101000
00010000
00010000
00010000
00010110
DLG SPR_5t
POS 1w 5,13

SPR 9m
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_66
POS 1q 1,5

SPR 9n
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_65
POS 1q 7,5

SPR 9o
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_64
POS 1q 12,4

SPR 9p
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_63
POS 1q 10,6

SPR 9q
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_62
POS 1q 10,8

SPR 9r
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_61
POS 1q 10,10

SPR 9s
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_60
POS 1q 12,10

SPR 9t
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_5z
POS 1q 13,8

SPR 9u
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_5y
POS 1q 7,8

SPR 9v
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_5x
POS 1q 7,11

SPR 9w
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_5w
POS 1q 4,11

SPR 9x
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_5v
POS 1q 3,8

SPR 9y
00111100
01111110
10100101
10100101
10100101
11111111
11111111
11000011
DLG SPR_5u
POS 1q 4,6

SPR 9z
00010000
11110000
00010000
11110000
00010000
11110000
00010000
11110000
DLG SPR_68
POS 1r 0,8

SPR a0
00010000
11110000
00010000
11110000
00010000
11110000
00010000
11110000
DLG SPR_69
POS 1r 0,7

SPR a1
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
DLG SPR_6a
POS 6 4,4

SPR a2
00000000
00000000
10000000
10000000
10000000
10000000
10000000
00000000
DLG SPR_6b
POS 3 4,15

SPR a3
00000000
00000000
00000000
00000000
00000000
00000000
00000000
01111100
DLG SPR_6c
POS 8 0,13

SPR a4
00000000
10000000
10000000
10000000
10000000
10000000
10000000
00000000
DLG SPR_6d
POS 14 4,0

SPR a5
00000000
00000000
00000000
00000000
00000000
00000000
00000000
01111110
DLG SPR_6e
POS 14 0,13

SPR a6
00000000
00000000
00000000
00000000
00000000
00000000
00000000
01111110
DLG SPR_6f
POS 14 15,13

SPR a7
00000000
10000000
10000000
10000000
10000000
10000000
10000000
00000000
DLG SPR_6g
POS 1p 4,15

SPR a8
00000000
10000000
10000000
10000000
10000000
10000000
10000000
00000000
DLG SPR_6h
POS 1q 4,0

SPR a9
00000000
00000000
00000000
00000000
00000000
00000000
00000000
01111110
DLG SPR_6i
POS 1q 0,13

SPR aa
00000000
00000000
00000000
00000000
00000000
00000000
00000000
01111110
DLG SPR_6j
POS 1q 15,13

SPR ab
00000000
00000000
01111100
01111100
01111100
00010000
00010000
00010000
DLG SPR_6k
POS 1r 13,1

SPR ac
00000000
00000000
00000000
00000000
00000000
00000000
00000000
01111110
DLG SPR_6l
POS 1s 0,13

SPR ad
01111110
00000000
00000000
00000000
00000000
00000000
00000000
00000000
DLG SPR_6m

SPR ae
00000000
00000000
01111100
01111100
01111100
00010000
00010000
00010000
DLG SPR_6n
POS 1u 14,11

SPR af
00000000
00000000
01111100
01111100
01111100
00010000
00010000
00010000
DLG SPR_6o
POS 0 13,1

SPR ag
00000000
00000000
00000000
00000000
00000000
00000000
00000000
01111110
DLG SPR_6p
POS 0 15,13

SPR ah
00000000
00000000
01111100
01111100
01111100
00010000
00010000
00010000
DLG SPR_6q
POS 0 1,9

SPR ai
00000000
00000000
01111100
01111100
01111100
00010000
00010000
00010000
DLG SPR_6r
POS 1 14,11

SPR aj
01111110
00000000
00000000
00000000
00000000
00000000
00000000
00000000
DLG SPR_6s
POS 1 1,5

SPR ak
01111110
00000000
00000000
00000000
00000000
00000000
00000000
00000000
DLG SPR_6w
POS 1u 1,5

SPR al
00000000
00000000
00000000
00000000
00000000
00000000
00000000
01111110
DLG SPR_6t
POS 1r 15,13

SPR am
00000000
00000000
01111100
01111100
01111100
00010000
00010000
00010000
DLG SPR_6u
POS 1r 1,9

ITM 1
01111000
01000100
01010010
01001010
01000010
01011010
01000010
00111110
NAME Diary Entry
DLG ITM_1

ITM 2
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME Message
DLG ITM_0

ITM 3
01010100
01111100
00010000
00010000
00010000
00010000
00010000
00010000
NAME Rake
DLG ITM_3

ITM 6
01111000
01000100
01010010
01001010
01000010
01011010
01000010
00111110
NAME Diary 1
DLG ITM_2

ITM 7
01111000
01000100
01010010
01001010
01000010
01011010
01000010
00111110
NAME Diary 2
DLG ITM_4

ITM 8
01111000
01000100
01010010
01001010
01000010
01011010
01000010
00111110
NAME Diary 3
DLG ITM_5

ITM 9
01111000
01000100
01010010
01001010
01000010
01011010
01000010
00111110
NAME Diary 4
DLG ITM_6

ITM a
01111000
01000100
01010010
01001010
01000010
01011010
01000010
00111110
NAME Diary 5
DLG ITM_7

ITM b
01111000
01000100
01010010
01001010
01000010
01011010
01000010
00111110
NAME Diary 6
DLG ITM_8

ITM c
01111000
01000100
01010010
01001010
01000010
01011010
01000010
00111110
NAME Diary 7
DLG ITM_9

ITM d
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME 1
DLG ITM_a

ITM e
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME 2
DLG ITM_b

ITM f
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME 3
DLG ITM_c

ITM g
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME 4
DLG ITM_d

ITM h
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME 5
DLG ITM_e

ITM i
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME 6
DLG ITM_f

ITM j
00000000
00000000
00000000
00000000
00000000
00000000
00000000
00000000
NAME 7
DLG ITM_g

DLG SPR_0
The Royal Garden

DLG SPR_1
To the Royal Castle.

DLG SPR_2
To the Marketplace

DLG SPR_3
"""
{
  - Quest_Gary == 0 ?
    {Quest_Gary = 1}What do you want? Flowers? Can't you see they're all withered and dead? Can't do no farming when all my {wvy}{clr3}tools{clr3}{wvy} are old n' broken!
  - Quest_Gary == 2 ?
    {shuffle
      - What you want? Can't you see I'm busy?
      - That damn king's too busy cryin' all day to even take care of his own castle!
      - Ever since that damn mob came to the castle, everythin's been ruined!
    }
  - Equipment == 1 ?
    {Equipment = 0}
{Flowers = Flowers + 1}
{Quest_Gary = 2}Hey wait, is that a new rake? Give it here! Here, take this, you said you wanted flowers right? It's the only one I have on me.
    You have obtained {clr3}{wvy}Blue Iris{wvy}{clr3}. ({say Flowers}/4)
  - Equipment == 0 ?
    What are you still here for? I told you I don't have any flowers cause' I don't got no farming {clr3}{wvy}equipment{wvy}{clr3}!
}
"""

DLG SPR_4
To the Drawbridge.

DLG SPR_5
To Residences A

DLG SPR_6
To Residence B

DLG SPR_h
To Residence C

DLG SPR_i
"""
{
  - Quest_Lucy == 2 ?
    I miss big sis...
  - Quest_Lucy == 0 ?
    I miss big sis...
  - Stuffed_Toy == 1 ?
    {Quest_Lucy = 2}
{Flowers = Flowers + 1}A teddy bear? And it looks just like the one big sis Frey got me for my birthday! Thank you! Here, you can have this!
    
    You have obtained {clr3}{wvy}White Chrysanthemum{wvy}{clr3}. ({say Flowers}/4)
  - Stuffed_Toy == 0 ?
    I miss big sis...
  - Quest_Lucy == 3 ?
    I miss big sis...
}
"""

DLG SPR_j
"""
{
  - Quest_Lucy == 3 ?
    {shuffle
      - Even I can empathize with how Miss Lucy must feel...
      - Princess Freya was such a kind soul, why did it have to be her...
    }
  - Quest_Lucy == 2 ?
    {Quest_Lucy = 3} Thank you so much for your help! Here, it's not much, but you can have this as a token of appreciation. Miss Lucy threw it out sometime ago but I thought it would be a bit of a waste.
    {Locket = 1}You have obtained {wvy}{clr3}Old Locket{clr3}{wvy}.
  - Quest_Lucy == 1 ?
    If only {wvy}{clr3}Princess Freya{clr3}{wvy} were still here, she would know how to cheer Miss Lucy up...
  - Quest_Lucy == 0 ?
    {Quest_Lucy = 1}Hey, you there. Could you spare some time to help me out? You see ever since she was adopted from the streets, young Lucy had always been close to the princess. But now that the princess is gone, she's been devastated ever since. Please help me find something that might cheer her up, maybe something that would remind her of {clr3} {wvy}princess Freya{wvy}{clr3}...
}
"""

DLG ITM_1
"""
{Diary = Diary + 1}You have obtained Freya's torn diary page. ({say Diary}/7){sequence
  - "June 1470: As a member of royalty, I've had a relatively good life growing up. But going out of the castle for the first time today has opened my eyes to the many problems the citizens face on a daily basis. So I've decided to write this diary to record the things I've seen and experienced. Hopefully I'll learn to be a good leader when I grow up."

  - "March 1472: Today was Lucy's birthday. She turns four this year, wow time flies doesn't it? It feels like it was just yesterday when I found her at the steps of the church! I bought her a {clr3}{wvy}stuffed teddy bear{wvy}{clr3} from a stall at the {clr3}{wvy}marketplace{wvy}{clr3} as a present, and she seemed really happy about it! I'm really looking forward to seeing her grow up!"
  - "August 1474: Today I was was introduced to my personal guard. His name is Seth, and he's around my age! He was a little shy and stiff around me at first, but after we talked for a bit I managed to get him to warm up to me. He grew up in a poor family in this city, and he joined the military to help support his parents and young siblings. I hope to learn more about him as time goes by!"
  - "June 1478: Today I was really overwhelmed by my visit to the residential areas. Plenty of poor and hungry citizens were strewn along the roads, most without a place to live. It made me wonder what I did to deserve such a good life in the castle, and I honestly felt quite bad about myself. But Seth assured me that even if it isn't fair, it's also not my fault. He told me that all I could do was to try my best for the people, and hope that they'll appreciate it. Formalities aside, Seth is a really good friend. I'm really glad to have him by my side these past few years."
  - "January 1480: I didn't feel very well today. My head was spinning when I woke up, and a doctor was immediately summoned to check up on me. Apparently I've contracted a very deadly disease which only can be cured by an extremely rare herb. My stomach hurts and my body feels weak, but I know I'll be fine. Seth has been sent out to go look for the medicine; if there's anyone who can do it, it's him" 
  - "May 1480: Everyday my body gets weaker, and I'm slowly unable to do things I could usually do. Everyone in the castle is worried for me, especially Lucy. So I try my best to put on a smile as much as I can. But really, I don't know how much more I can hold on any longer. I've come to like the {clr3}{wvy}night{wvy}{clr3}; with all the restrictions being put on me, there are really only {clr3}{wvy}certain places{wvy}{clr3} that I can {clr3}{wvy}visit{wvy}{clr3} when the sun goes down. There's an old folklore which says that if you bring {clr3}{wvy}four flowers{wvy}{clr3} of specific colors to a place deep into the forest, you'll be granted a wish. It's been four months since Seth left, and quite honestly I'm not really longing that much to be cured anymore. If I could wish for anything, it would be for Seth to get back safely, just so I can see him again..."
  - "August 1480: I've coughed out blood for the third time this week, and the week has barely even started. At this point, I've already accepted being sickly as a given. The whole castle is swarming because of me, and father has forbidden me from leaving the castle for my own safety. {shk}But I'm so sick of this place!{shk} Ever since Seth left, I've not had anyone to confide in, let alone have a decent conversation with. Even Lucy hasn't been able to come visit me for fear of her contracting the disease too. I've had enough, I'm honestly grasping at straws at this point. There's a {clr3}{wvy}secret passage{wvy}{clr3} I know hidden behind the {clr3}{wvy}church{wvy}{clr3} through the {clr3}{wvy}rightmost stained glass window{wvy}{clr3} which is left unlocked at night. It leads in the direction of the {clr3}{wvy}forest{wvy}{clr3}, and I've collected my own four flowers. I can only pray for my wish to be granted. Seth, wherever you are, I miss you..."
}
"""

DLG SPR_m
"""
{
  - Stuffed_Toy == 1 ?
    {shuffle
      - Things don't seem that much better even after the millita took over.
      - I sure hope business starts picking up soon, so many have already left this city already.
      - Sorry, I ain't opening shop today.
    }
  - Diary_2 == 1 ?
    A {clr3}{wvy}toy stall{wvy}{clr3}? Yeah, I remember there being one around here...
  - else ?
    {shuffle
      - Things don't seem that much better even after the millita took over.
      - I sure hope business starts picking up soon, so many have already left this city already.
      - Sorry, I ain't opening shop today.
    }
}
"""

DLG SPR_n
"""
{
  - Quest_Weaver == 2 ?
    {shuffle
      - I think I can empathize a little more with how the king feels now...
      - I used to hate the king, but now I'm not so sure anymore.
      - Oh my daughter... I'm so sorry...
    }
  - Quest_Weaver == 0 ?
    {Quest_Weaver = 1}Hey you, care to listen to my story? A long time ago shortly after my husband suddenly left me, I gave birth to his {clr3}{wvy}child{wvy}{clr3}. It was in the middle of the winter, and I had no means of supporting her. So I had no choice but to abandon her at the steps of the church. I know I'm no mother to her, but please could you help me {clr3}{wvy}look for her{wvy}{clr3} and check to see if she's alright? She should still have an {clr3}{wvy}old locket{wvy}{clr3} that I had left with her.
  - Locket == 0 ?
    Have you found my {clr3}{wvy}daughter{wvy}{clr3}? She should still have that {clr3}{wvy}old locket{wvy}{clr3} I left her.
  - Locket == 1 ?
    {Locket = 0}
{Quest_Weaver = 2}
{Flowers = Flowers + 1}Is that... my daughter's locket? Thank God she's alright! Where did you find her? Living in the castle? The princess took her in? Is that so... Well, in any case you can have these. I heard you're collecting them.
    
    You have obtained {clr3}{wvy}Red Rose{wvy}{clr3}. ({say Flowers}/4)
    
    {Diary = Diary + 1}
{Diary_6 = 1}You have obtained Freya's torn {clr3}{wvy}diary page{wvy}{clr3}. ({say Diary}/7)
    
    "[Page 6] May 1480: Everyday my body gets weaker, and I'm slowly unable to do things I could usually do. Everyone in the castle is worried for me, especially Lucy. So I try my best to put on a smile as much as I can. But really, I don't know how much more I can hold on any longer. I've come to like the {clr3}{wvy}night{wvy}{clr3}; with all the restrictions being put on me, there are really only {clr3}{wvy}certain places{wvy}{clr3} that I can {clr3}{wvy}visit{wvy}{clr3} when the sun goes down. There's an old folklore which says that if you bring {clr3}{wvy}four flowers{wvy}{clr3} of specific colors to a place deep into the forest, you'll be granted a wish. It's been four months since Seth left, and quite honestly I'm not really longing that much to be cured anymore. If I could wish for anything, it would be for Seth to get back safely, just so I can see him again..."
}
"""

DLG SPR_o
Looks like a loom, used for spinning wool. It's not really something I know how to use.

DLG SPR_s
"""
{shuffle
  - Are you trying to bribe me?
  - What kind of kind neglects his citizens?
  - We did nothing wrong, people's livelihoods were at stake.
}
"""

DLG SPR_t
"""
{shuffle
  - Sorry bud, rules are rules.
  - Did we really do the right thing?
  - Sometimes I do feel sorry for the king.
}
"""

DLG SPR_u
"""
{
  - Small_Key == 1 ?
    You open the chest to discover the chest is filled with gold coins! You take one. (Gold Coins: {say Coins})
  - Small_Key == 0 ?
    A locked chest which looks like it has something important. You'll need a small key of some sort to unlock it.
}
"""

DLG SPR_v
To City Gates

DLG SPR_w
To Castle.

DLG ITM_3
{Equipment = 1}You have obtained New Rake.

DLG SPR_16
Best not to try anything that might wake the king up.

DLG SPR_17
zzz...

DLG SPR_18
zzz...

DLG SPR_19
An empty bed.

DLG SPR_1a
An empty bed.

DLG SPR_1b
zzz...

DLG SPR_1c
zzz...

DLG SPR_1e
An abandoned stall.

DLG SPR_1f
An abandoned stall.

DLG SPR_1g
An abandoned stall.

DLG SPR_1h
An abandoned stall.

DLG SPR_1i
The toy stall seems closed.

DLG SPR_1j
An abandoned stall.

DLG SPR_1k
The bread store seems closed.

DLG SPR_1l
An abandoned stall.

DLG SPR_1m
An abandoned stall.

DLG SPR_1n
An abandoned stall.

DLG SPR_1o
The torches burn brightly in the night.

DLG SPR_1p
The torches burn brightly in the night.

DLG SPR_1q
The torches burn brightly in the night.

DLG SPR_1r
The torches burn brightly in the night.

DLG SPR_1s
The torches burn brightly in the night.

DLG SPR_1t
The torches burn brightly in the night.

DLG SPR_1u
The torches burn brightly in the night.

DLG SPR_1v
The torches burn brightly in the night.

DLG SPR_1w
The torches burn brightly in the night.

DLG SPR_1x
The torches burn brightly in the night.

DLG SPR_1y
To Garden

DLG SPR_1z
To Castle

DLG SPR_20
To Marketplace

DLG SPR_21
To Castle Entrance

DLG SPR_22
To Residence A.

DLG SPR_23
To Residence B.

DLG SPR_24
To City Gates.

DLG SPR_25
To Marketplace.

DLG SPR_26
To Marketplace.

DLG SPR_27
To Marketplace.

DLG SPR_28
To Castle Entrance

DLG SPR_29
To Marketplace

DLG SPR_2a
To Marketplace.

DLG SPR_2b
To Marketplace.

DLG SPR_7
To the Drawbridge.

DLG SPR_2c
zzz...

DLG SPR_2d
zzz...

DLG SPR_2e
An empty table save for some loose spools of yarn. Nothing of worth here.

DLG SPR_2f
An empty table save for some loose spools of yarn. Nothing of worth here.

DLG SPR_2g
The chair looks old and creaky. Best not to do anything to wake her up.

DLG SPR_2h
Ceramic pots that look like they are sealed tight. Smells funky too.

DLG SPR_2i
Ceramic pots that look like they are sealed tight. Smells funky too.

DLG SPR_2j
A coat hanger, with some old looking clothes on it. You'd think a seamstress would own better clothes than these.

DLG SPR_2k
The ephemeral flames of the fireplace burn with a comfortable warmth.

DLG SPR_2l
The ephemeral flames of the fireplace burn with a comfortable warmth.

DLG SPR_2m
The ephemeral flames of the fireplace burn with a comfortable warmth.

DLG SPR_2n
The ephemeral flames of the fireplace burn with a comfortable warmth.

DLG SPR_2o
A strong aroma comes from the pots upon the burning stove.

DLG SPR_2p
A strong aroma comes from the pots upon the burning stove.

DLG SPR_2q
The numerous coffee stains on the table lead you to believe that this might be a coffee table.

DLG SPR_2r
The chair looks like it's give way even if you didn't sit on it.

DLG SPR_2s
The chair looks like it's give way even if you didn't sit on it.

DLG SPR_2t
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_2u
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_2v
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_2w
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_2x
You don't really feel tired, and neither do you really want to undo your neatly made bed right now.

DLG SPR_2y
It's a chair.

DLG SPR_2z
It's a chair.

DLG SPR_30
It's an empty chest.

DLG SPR_r
The flames burn dimly, slowly but surely dying out.

DLG SPR_31
The flames burn dimly, slowly but surely dying out.

DLG SPR_z
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_10
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_11
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_12
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_32
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_33
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_34
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_35
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_36
A beat up dusty crown of faded gold lay dormant on the table.

DLG SPR_37
The candle burns relentlessly, weakly but stubbornly persisting against the wavering wind.

DLG SPR_38
The candle burns relentlessly, weakly but stubbornly persisting against the wavering wind.

DLG SPR_39
The candle burns relentlessly, weakly but stubbornly persisting against the wavering wind.

DLG SPR_3a
The candle burns relentlessly, weakly but stubbornly persisting against the wavering wind.

DLG SPR_3b
The candle burns relentlessly, weakly but stubbornly persisting against the wavering wind. On the table draped in white are pieces of bread that look like they've been left out for way too long.

DLG SPR_3c
The candle burns relentlessly, weakly but stubbornly persisting against the wavering wind. On the table draped in white are pieces of bread that look like they've been left out for way too long.

DLG SPR_3d
A strong aroma comes from the pots upon the burning stove.

DLG SPR_3e
A strong aroma comes from the pots upon the burning stove.

DLG SPR_3g
A messy bed that hasn't been made. Fortunately you aren't paid to do it.

DLG SPR_3f
A messy bed that hasn't been made. Fortunately you aren't paid to do it.

DLG SPR_3h
An empty desk. The accumulated dust indicates that it hasn't been used for quite a while.

DLG SPR_3i
An empty desk. The accumulated dust indicates that it hasn't been used for quite a while.

DLG SPR_3j
A dusty wooden chair.

DLG SPR_3k
The desk has random scribbles of crayon all over it. It almost has some kind of artistic feel to it.

DLG SPR_3l
The desk has random scribbles of crayon all over it. It almost has some kind of artistic feel to it.

DLG SPR_3m
A small wooden chair. Looks like it would break if you sat on it.

DLG SPR_3n
The closet is full of children's clothes. It's about as neat as the bed behind you.

DLG SPR_3o
The closet is full of children's clothes. It's about as neat as the bed behind you.

DLG SPR_3p
A dusty bed which looks like it hasn't been slept in for years.

DLG SPR_3q
A dusty bed which looks like it hasn't been slept in for years.

DLG SPR_3r
The closet is full of expensive and frilly clothing. The immense amount of dust around sends you into a sneezing fit.

DLG SPR_3s
The closet is full of expensive and frilly clothing. The immense amount of dust around sends you into a sneezing fit.

DLG SPR_3t
Not. Your. Bed.

DLG SPR_3u
Not. Your. Bed.

DLG SPR_3v
A neatly kept closed filled with fancy clothes.

DLG SPR_3w
A neatly kept closed filled with fancy clothes.

DLG SPR_3x
A firm wooden chair.

DLG SPR_3y
A firm wooden chair.

DLG SPR_3z
A tidy desk filled with stacks of papers and things you don't even understand a half of.

DLG SPR_40
A tidy desk filled with stacks of papers and things you don't even understand a half of.

DLG SPR_41
A coat hanger without any coats.

DLG SPR_42
"""
{
  - Diary == 7 ?

  - Diary == 6 ?

  - Diary == 5 ?

  - Diary == 4 ?

  - Diary == 3 ?

  - Diary == 2 ?

  - Diary == 1 ?

  - Diary == 0 ?
    An old battered book lay upon the table in front of you. It seems like a few pages have been ripped off from it. ({say Diary}/7)
  - Diary == 100 ?
    {Diary = 0}An old battered book lay upon the table in front of you. It seems like a few pages have been ripped off from it. ({say Diary}/7)
}
"""

DLG SPR_43
"""
{
  - Flowers == 4 ?
    Four full {clr3}{wvy}flowers{wvy}{clr3} adorn the old wooden table. (4/4)
  - Flowers == 3 ?
    Three full {clr3}{wvy}flowers{wvy}{clr3} sit comfortably on the old wooden table. (3/4)
  - Flowers == 2 ?
    Two full {clr3}{wvy}flowers{wvy}{clr3} sit nicely on the old wooden table. (2/4)
  - Flowers == 1 ?
    A lone full {clr3}{wvy}flower{wvy}{clr3} sits pretty on the old wooden table. (1/4)
  - CheckF == 0 ?
    {CheckF = 1}Loose {clr3}{wvy}flower{wvy}{clr3} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
  - Flowers == 0 ?
    Loose {wvy}{clr3}flower{clr3}{wvy} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
}
"""

DLG SPR_l
"""
{shuffle
  - Could I have done more?
  - It should have been me instead...
  - Oh Freya, my dear daughter...
  - Why did it have to be this way?
}
"""

DLG SPR_8
"""
{
  - Stuffed_Toy > 0 ?
    It's an abandoned toy stall. Nothing of interest here.
  - Diary_2 == 1 ?
    {Stuffed_Toy = 1}It's an abandoned toy stall. You found a {clr3}{wvy}stuffed teddy bear{wvy}{clr3}!
}
"""

DLG SPR_9
Its an abandoned stall. Nothing of interest here.

DLG SPR_b
Its an abandoned stall. Nothing of interest here.

DLG SPR_c
Its an abandoned stall. Nothing of interest here.

DLG SPR_d
Its an abandoned stall. Nothing of interest here.

DLG SPR_e
Its an abandoned stall. Nothing of interest here.

DLG SPR_f
Its an abandoned stall. Nothing of interest here.

DLG SPR_g
Its an abandoned stall. Nothing of interest here.

DLG SPR_k
Its an abandoned stall. Nothing of interest here.

DLG SPR_p
Its an abandoned stall. Nothing of interest here.

DLG SPR_q
Its an abandoned stall. Nothing of interest here.

DLG SPR_x
Its an abandoned stall. Nothing of interest here.

DLG SPR_y
Its an abandoned stall. Nothing of interest here.

DLG SPR_13
Its an abandoned stall. Nothing of interest here.

DLG SPR_a
"""
{
  - CheckD == 0 ?
    {CheckD = 1}An old battered book lay upon the table in front of you. It seems like a few {clr3}{wvy}pages{wvy}{clr3} have been ripped off from it. ({say Diary}/7)
  - Diary == 0 ?
    An old battered book lay upon the table in front of you. It seems like a few {clr3}{wvy}pages{wvy}{clr3} have been ripped off from it. ({say Diary}/7)
  - Diary > 0 ?
    {cycle
      - {
          - Diary_1 == 1 ?
            "[1/7] June 1470: As a member of royalty, I've had a relatively good life growing up. But going out of the castle for the first time today has opened my eyes to the many problems the citizens face on a daily basis. So I've decided to write this journal to record the things I've seen and experienced. Hopefully I'll learn to be a good leader when I grow up."
          - Diary_1 == 0 ?
            [1/7] This page is missing.
        }
      - {
          - Diary_2 == 1 ?
            "[2/7] March 1472: Today was Lucy's birthday. She turns four this year, wow time flies doesn't it? It feels like it was just yesterday when I found her at the steps of the church! I bought her a {clr3}{wvy}stuffed teddy bear{wvy}{clr3} from a stall at the {clr3}{wvy}marketplace{wvy}{clr3} as a present, and she seemed really happy about it! I'm really looking forward to seeing her grow up!"
          - Diary_2 == 0 ?
            [2/7] This page is missing.
        }
      - {
          - Diary_3 == 1 ?
            "[3/7] August 1474: Today I was was introduced to my personal guard. His name is Seth, and he's around my age! He was a little shy and stiff around me at first, but after we talked for a bit I managed to get him to warm up to me. He grew up in a poor family in this city, and he joined the military to help support his parents and young siblings. I hope to learn more about him as time goes by!"
          - Diary_3 == 0 ?
            [3/7] This page is missing.
        }
      - {
          - Diary_4 == 1 ?
            "[4/7] June 1478: Today I was really overwhelmed by my visit to the residential areas. Plenty of poor and hungry citizens were strewn along the roads, most without a place to live. It made me wonder what I did to deserve such a good life in the castle, and I honestly felt quite bad about myself. But Seth assured me that even if it isn't fair, it's also not my fault. He told me that all I could do was to try my best for the people, and hope that they'll appreciate it. Formalities aside, Seth is a really good friend. I'm really glad to have him by my side these past few years."
          - Diary_4 == 0 ?
            [4/7] This page is missing.
        }
      - {
          - Diary_5 == 1 ?
            "[5/7] January 1480: I didn't feel very well today. My head was spinning when I woke up, and a doctor was immediately summoned to check up on me. Apparently I've contracted a very deadly disease which only can be cured by an extremely rare herb. My stomach hurts and my body feels weak, but I know I'll be fine. Seth has been sent out to go look for the medicine; if there's anyone who can do it, it's him"
          - Diary_5 == 0 ?
            [5/7] This page is missing.
        }
      - {
          - Diary_6 == 1 ?
            "[6/7] May 1480: Everyday my body gets weaker, and I'm slowly unable to do things I could usually do. Everyone in the castle is worried for me, especially Lucy. So I try my best to put on a smile as much as I can. But really, I don't know how much more I can hold on any longer. I've come to like the {clr3}{wvy}night{wvy}{clr3}; with all the restrictions being put on me, there are really only {clr3}{wvy}certain places{wvy}{clr3} that I can {clr3}{wvy}visit{wvy}{clr3} when the sun goes down. There's an old folklore which says that if you bring {clr3}{wvy}four flowers{wvy}{clr3} of specific colors to a place deep into the forest, you'll be granted a wish. It's been four months since Seth left, and quite honestly I'm not really longing that much to be cured anymore. If I could wish for anything, it would be for Seth to get back safely, just so I can see him again..."
          - Diary_6 == 0 ?
            [6/7] This page is missing.
        }
      - {
          - Diary_7 == 1 ?
            "[7/7] August 1480: I've coughed out blood for the third time this week, and the week has barely even started. At this point, I've already accepted being sickly as a given. The whole castle is swarming because of me, and father has forbidden me from leaving the castle for my own safety. {shk}But I'm so sick of this place!{shk} Ever since Seth left, I've not had anyone to confide in, let alone have a decent conversation with. Even Lucy hasn't been able to come visit me for fear of her contracting the disease too. I've had enough, I'm honestly grasping at straws at this point. There's a {clr3}{wvy}secret passage{wvy}{clr3} I know hidden behind the {clr3}{wvy}church{wvy}{clr3} through the {clr3}{wvy}rightmost stained glass window{wvy}{clr3} which is left unlocked at night. It leads in the direction of the {clr3}{wvy}forest{wvy}{clr3}, and I've collected my own four flowers. I can only pray for my wish to be granted. Seth, wherever you are, I miss you..."
          - Diary_7 == 0 ?
            [7/7] This page is missing.
        }
    }
}
"""

DLG SPR_14
"""
{
  - Flowers == 4 ?
    Four full {clr3}{wvy}flowers{wvy}{clr3} adorn the old wooden table. (4/4)
  - Flowers == 3 ?
    Three full {clr3}{wvy}flowers{wvy}{clr3} sit comfortably on the old wooden table. (3/4)
  - Flowers == 2 ?
    Two full {clr3}{wvy}flowers{wvy}{clr3} sit nicely on the old wooden table. (2/4)
  - Flowers == 1 ?
    A lone full {clr3}{wvy}flower{wvy}{clr3} sits pretty on the old wooden table. (1/4)
  - CheckF == 0 ?
    {CheckF = 1}Loose {clr3}{wvy}flower{wvy}{clr3} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
  - Flowers == 0 ?
    Loose {wvy}{clr3}flower{clr3}{wvy} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
}
"""

DLG ITM_0
"""
{
  - CheckD == 0 ?
    {CheckD = 0}
{CheckF = 0}You get the feeling you're forgetting something. You should probably check all the {clr3}{wvy}items{wvy}{clr3} on your {clr3}{wvy}desk{wvy}{clr3} before you leave.
  - CheckF == 0 ?
    {CheckD = 0}
{CheckF = 0}You get the feeling you're forgetting something. You should probably check all the {clr3}{wvy}items{wvy}{clr3} on your {clr3}{wvy}desk{wvy}{clr3} before you leave.
}
"""

DLG SPR_15
"""
{
  - Flowers == 4 ?
    Four full {clr3}{wvy}flowers{wvy}{clr3} adorn the old wooden table. (4/4)
  - Flowers == 3 ?
    Three full {clr3}{wvy}flowers{wvy}{clr3} sit comfortably on the old wooden table. (3/4)
  - Flowers == 2 ?
    Two full {clr3}{wvy}flowers{wvy}{clr3} sit nicely on the old wooden table. (2/4)
  - Flowers == 1 ?
    A lone full {clr3}{wvy}flower{wvy}{clr3} sits pretty on the old wooden table. (1/4)
  - Flowers == 0 ?
    Loose {wvy}{clr3}flower{clr3}{wvy} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
  - Flowers == 100 ?
    {Flowers = 0}Loose {clr3}{wvy}flower{wvy}{clr3} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
}
"""

DLG SPR_1d
"""
{
  - Flowers == 4 ?
    Four full {clr3}{wvy}flowers{wvy}{clr3} adorn the old wooden table. (4/4)
  - Flowers == 3 ?
    Three full {clr3}{wvy}flowers{wvy}{clr3} sit comfortably on the old wooden table. (3/4)
  - Flowers == 2 ?
    Two full {clr3}{wvy}flowers{wvy}{clr3} sit nicely on the old wooden table. (2/4)
  - Flowers == 1 ?
    A lone full {clr3}{wvy}flower{wvy}{clr3} sits pretty on the old wooden table. (1/4)
  - Flowers == 0 ?
    Loose {wvy}{clr3}flower{clr3}{wvy} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
  - Flowers == 100 ?
    {Flowers = 0}Loose {clr3}{wvy}flower{wvy}{clr3} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
}
"""

DLG SPR_45
"""
{
  - Flowers == 4 ?
    Four full {clr3}{wvy}flowers{wvy}{clr3} adorn the old wooden table. (4/4)
  - Flowers == 3 ?
    Three full {clr3}{wvy}flowers{wvy}{clr3} sit comfortably on the old wooden table. (3/4)
  - Flowers == 2 ?
    Two full {clr3}{wvy}flowers{wvy}{clr3} sit nicely on the old wooden table. (2/4)
  - Flowers == 1 ?
    A lone full {clr3}{wvy}flower{wvy}{clr3} sits pretty on the old wooden table. (1/4)
  - Flowers == 0 ?
    Loose {wvy}{clr3}flower{clr3}{wvy} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
  - Flowers == 100 ?
    {Flowers = 0}Loose {clr3}{wvy}flower{wvy}{clr3} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
}
"""

DLG SPR_46
"""
{
  - Flowers == 4 ?
    Four full {clr3}{wvy}flowers{wvy}{clr3} adorn the old wooden table. (4/4)
  - Flowers == 3 ?
    Three full {clr3}{wvy}flowers{wvy}{clr3} sit comfortably on the old wooden table. (3/4)
  - Flowers == 2 ?
    Two full {clr3}{wvy}flowers{wvy}{clr3} sit nicely on the old wooden table. (2/4)
  - Flowers == 1 ?
    A lone full {clr3}{wvy}flower{wvy}{clr3} sits pretty on the old wooden table. (1/4)
  - Flowers == 0 ?
    Loose {wvy}{clr3}flower{clr3}{wvy} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
  - Flowers == 100 ?
    {Flowers = 0}Loose {clr3}{wvy}flower{wvy}{clr3} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
}
"""

DLG SPR_47
It's a chair.

DLG SPR_48
It's a chair.

DLG SPR_49
It's a chair.

DLG SPR_4a
It's an empty chest.

DLG SPR_4b
It's an empty chest.

DLG SPR_4c
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_4d
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_4e
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_4f
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_4g
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_4h
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_4i
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_4j
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_4k
"""
{
  - Diary == 100 ?
    {Diary = 0}An old battered book lay upon the table in front of you. It seems like a few {clr3}{wvy}pages{wvy}{clr3} have been ripped off from it. ({say Diary}/7)
  - Diary == 0 ?
    An old battered book lay upon the table in front of you. It seems like a few {clr3}{wvy}pages{wvy}{clr3} have been ripped off from it. ({say Diary}/7)
  - Diary > 0 ?
    {cycle
      - {
          - Diary_1 == 1 ?
            "[1/7] June 1470: As a member of royalty, I've had a relatively good life growing up. But going out of the castle for the first time today has opened my eyes to the many problems the citizens face on a daily basis. So I've decided to write this journal to record the things I've seen and experienced. Hopefully I'll learn to be a good leader when I grow up."
          - Diary_1 == 0 ?
            [1/7] This page is missing.
        }
      - {
          - Diary_2 == 1 ?
            "[2/7] March 1472: Today was Lucy's birthday. She turns four this year, wow time flies doesn't it? It feels like it was just yesterday when I found her at the steps of the church! I bought her a {clr3}{wvy}stuffed teddy bear{wvy}{clr3} from a stall at the {clr3}{wvy}marketplace{wvy}{clr3} as a present, and she seemed really happy about it! I'm really looking forward to seeing her grow up!"
          - Diary_2 == 0 ?
            [2/7] This page is missing.
        }
      - {
          - Diary_3 == 1 ?
            "[3/7] August 1474: Today I was was introduced to my personal guard. His name is Seth, and he's around my age! He was a little shy and stiff around me at first, but after we talked for a bit I managed to get him to warm up to me. He grew up in a poor family in this city, and he joined the military to help support his parents and young siblings. I hope to learn more about him as time goes by!"
          - Diary_3 == 0 ?
            [3/7] This page is missing.
        }
      - {
          - Diary_4 == 1 ?
            "[4/7] June 1478: Today I was really overwhelmed by my visit to the residential areas. Plenty of poor and hungry citizens were strewn along the roads, most without a place to live. It made me wonder what I did to deserve such a good life in the castle, and I honestly felt quite bad about myself. But Seth assured me that even if it isn't fair, it's also not my fault. He told me that all I could do was to try my best for the people, and hope that they'll appreciate it. Formalities aside, Seth is a really good friend. I'm really glad to have him by my side these past few years."
          - Diary_4 == 0 ?
            [4/7] This page is missing.
        }
      - {
          - Diary_5 == 1 ?
            "[5/7] January 1480: I didn't feel very well today. My head was spinning when I woke up, and a doctor was immediately summoned to check up on me. Apparently I've contracted a very deadly disease which only can be cured by an extremely rare herb. My stomach hurts and my body feels weak, but I know I'll be fine. Seth has been sent out to go look for the medicine; if there's anyone who can do it, it's him"
          - Diary_5 == 0 ?
            [5/7] This page is missing.
        }
      - {
          - Diary_6 == 1 ?
            "[6/7] May 1480: Everyday my body gets weaker, and I'm slowly unable to do things I could usually do. Everyone in the castle is worried for me, especially Lucy. So I try my best to put on a smile as much as I can. But really, I don't know how much more I can hold on any longer. I've come to like the {clr3}{wvy}night{wvy}{clr3}; with all the restrictions being put on me, there are really only {clr3}{wvy}certain places{wvy}{clr3} that I can {clr3}{wvy}visit{wvy}{clr3} when the sun goes down. There's an old folklore which says that if you bring {clr3}{wvy}four flowers{wvy}{clr3} of specific colors to a place deep into the forest, you'll be granted a wish. It's been four months since Seth left, and quite honestly I'm not really longing that much to be cured anymore. If I could wish for anything, it would be for Seth to get back safely, just so I can see him again..."
          - Diary_6 == 0 ?
            [6/7] This page is missing.
        }
      - {
          - Diary_7 == 1 ?
            "[7/7] August 1480: I've coughed out blood for the third time this week, and the week has barely even started. At this point, I've already accepted being sickly as a given. The whole castle is swarming because of me, and father has forbidden me from leaving the castle for my own safety. {shk}But I'm so sick of this place!{shk} Ever since Seth left, I've not had anyone to confide in, let alone have a decent conversation with. Even Lucy hasn't been able to come visit me for fear of her contracting the disease too. I've had enough, I'm honestly grasping at straws at this point. There's a {clr3}{wvy}secret passage{wvy}{clr3} I know hidden behind the {clr3}{wvy}church{wvy}{clr3} through the {clr3}{wvy}rightmost stained glass window{wvy}{clr3} which is left unlocked at night. It leads in the direction of the {clr3}{wvy}forest{wvy}{clr3}, and I've collected my own four flowers. I can only pray for my wish to be granted. Seth, wherever you are, I miss you..."
          - Diary_7 == 0 ?
            [7/7] This page is missing.
        }
    }
}
"""

DLG SPR_4l
"""
{
  - Diary == 100 ?
    {Diary = 0}An old battered book lay upon the table in front of you. It seems like a few {clr3}{wvy}pages{wvy}{clr3} have been ripped off from it. ({say Diary}/7)
  - Diary == 0 ?
    An old battered book lay upon the table in front of you. It seems like a few {clr3}{wvy}pages{wvy}{clr3} have been ripped off from it. ({say Diary}/7)
  - Diary > 0 ?
    {cycle
      - {
          - Diary_1 == 1 ?
            "[1/7] June 1470: As a member of royalty, I've had a relatively good life growing up. But going out of the castle for the first time today has opened my eyes to the many problems the citizens face on a daily basis. So I've decided to write this journal to record the things I've seen and experienced. Hopefully I'll learn to be a good leader when I grow up."
          - Diary_1 == 0 ?
            [1/7] This page is missing.
        }
      - {
          - Diary_2 == 1 ?
            "[2/7] March 1472: Today was Lucy's birthday. She turns four this year, wow time flies doesn't it? It feels like it was just yesterday when I found her at the steps of the church! I bought her a {clr3}{wvy}stuffed teddy bear{wvy}{clr3} from a stall at the {clr3}{wvy}marketplace{wvy}{clr3} as a present, and she seemed really happy about it! I'm really looking forward to seeing her grow up!"
          - Diary_2 == 0 ?
            [2/7] This page is missing.
        }
      - {
          - Diary_3 == 1 ?
            "[3/7] August 1474: Today I was was introduced to my personal guard. His name is Seth, and he's around my age! He was a little shy and stiff around me at first, but after we talked for a bit I managed to get him to warm up to me. He grew up in a poor family in this city, and he joined the military to help support his parents and young siblings. I hope to learn more about him as time goes by!"
          - Diary_3 == 0 ?
            [3/7] This page is missing.
        }
      - {
          - Diary_4 == 1 ?
            "[4/7] June 1478: Today I was really overwhelmed by my visit to the residential areas. Plenty of poor and hungry citizens were strewn along the roads, most without a place to live. It made me wonder what I did to deserve such a good life in the castle, and I honestly felt quite bad about myself. But Seth assured me that even if it isn't fair, it's also not my fault. He told me that all I could do was to try my best for the people, and hope that they'll appreciate it. Formalities aside, Seth is a really good friend. I'm really glad to have him by my side these past few years."
          - Diary_4 == 0 ?
            [4/7] This page is missing.
        }
      - {
          - Diary_5 == 1 ?
            "[5/7] January 1480: I didn't feel very well today. My head was spinning when I woke up, and a doctor was immediately summoned to check up on me. Apparently I've contracted a very deadly disease which only can be cured by an extremely rare herb. My stomach hurts and my body feels weak, but I know I'll be fine. Seth has been sent out to go look for the medicine; if there's anyone who can do it, it's him"
          - Diary_5 == 0 ?
            [5/7] This page is missing.
        }
      - {
          - Diary_6 == 1 ?
            "[6/7] May 1480: Everyday my body gets weaker, and I'm slowly unable to do things I could usually do. Everyone in the castle is worried for me, especially Lucy. So I try my best to put on a smile as much as I can. But really, I don't know how much more I can hold on any longer. I've come to like the {clr3}{wvy}night{wvy}{clr3}; with all the restrictions being put on me, there are really only {clr3}{wvy}certain places{wvy}{clr3} that I can {clr3}{wvy}visit{wvy}{clr3} when the sun goes down. There's an old folklore which says that if you bring {clr3}{wvy}four flowers{wvy}{clr3} of specific colors to a place deep into the forest, you'll be granted a wish. It's been four months since Seth left, and quite honestly I'm not really longing that much to be cured anymore. If I could wish for anything, it would be for Seth to get back safely, just so I can see him again..."
          - Diary_6 == 0 ?
            [6/7] This page is missing.
        }
      - {
          - Diary_7 == 1 ?
            "[7/7] August 1480: I've coughed out blood for the third time this week, and the week has barely even started. At this point, I've already accepted being sickly as a given. The whole castle is swarming because of me, and father has forbidden me from leaving the castle for my own safety. {shk}But I'm so sick of this place!{shk} Ever since Seth left, I've not had anyone to confide in, let alone have a decent conversation with. Even Lucy hasn't been able to come visit me for fear of her contracting the disease too. I've had enough, I'm honestly grasping at straws at this point. There's a {clr3}{wvy}secret passage{wvy}{clr3} I know hidden behind the {clr3}{wvy}church{wvy}{clr3} through the {clr3}{wvy}rightmost stained glass window{wvy}{clr3} which is left unlocked at night. It leads in the direction of the {clr3}{wvy}forest{wvy}{clr3}, and I've collected my own four flowers. I can only pray for my wish to be granted. Seth, wherever you are, I miss you..."
          - Diary_7 == 0 ?
            [7/7] This page is missing.
        }
    }
}
"""

DLG SPR_44
"""
{
  - Flowers == 4 ?
    Four full {clr3}{wvy}flowers{wvy}{clr3} adorn the old wooden table. (4/4)
  - Flowers == 3 ?
    Three full {clr3}{wvy}flowers{wvy}{clr3} sit comfortably on the old wooden table. (3/4)
  - Flowers == 2 ?
    Two full {clr3}{wvy}flowers{wvy}{clr3} sit nicely on the old wooden table. (2/4)
  - Flowers == 1 ?
    A lone full {clr3}{wvy}flower{wvy}{clr3} sits pretty on the old wooden table. (1/4)
  - Flowers == 0 ?
    Loose {wvy}{clr3}flower{clr3}{wvy} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
  - Flowers == 100 ?
    {Flowers = 0}Loose {clr3}{wvy}flower{wvy}{clr3} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
}
"""

DLG SPR_4m
"""
{
  - Diary == 100 ?
    {Diary = 0}An old battered book lay upon the table in front of you. It seems like a few {clr3}{wvy}pages{wvy}{clr3} have been ripped off from it. ({say Diary}/7)
  - Diary == 0 ?
    An old battered book lay upon the table in front of you. It seems like a few {clr3}{wvy}pages{wvy}{clr3} have been ripped off from it. ({say Diary}/7)
  - Diary > 0 ?
    {cycle
      - {
          - Diary_1 == 1 ?
            "[1/7] June 1470: As a member of royalty, I've had a relatively good life growing up. But going out of the castle for the first time today has opened my eyes to the many problems the citizens face on a daily basis. So I've decided to write this journal to record the things I've seen and experienced. Hopefully I'll learn to be a good leader when I grow up."
          - Diary_1 == 0 ?
            [1/7] This page is missing.
        }
      - {
          - Diary_2 == 1 ?
            "[2/7] March 1472: Today was Lucy's birthday. She turns four this year, wow time flies doesn't it? It feels like it was just yesterday when I found her at the steps of the church! I bought her a {clr3}{wvy}stuffed teddy bear{wvy}{clr3} from a stall at the {clr3}{wvy}marketplace{wvy}{clr3} as a present, and she seemed really happy about it! I'm really looking forward to seeing her grow up!"
          - Diary_2 == 0 ?
            [2/7] This page is missing.
        }
      - {
          - Diary_3 == 1 ?
            "[3/7] August 1474: Today I was was introduced to my personal guard. His name is Seth, and he's around my age! He was a little shy and stiff around me at first, but after we talked for a bit I managed to get him to warm up to me. He grew up in a poor family in this city, and he joined the military to help support his parents and young siblings. I hope to learn more about him as time goes by!"
          - Diary_3 == 0 ?
            [3/7] This page is missing.
        }
      - {
          - Diary_4 == 1 ?
            "[4/7] June 1478: Today I was really overwhelmed by my visit to the residential areas. Plenty of poor and hungry citizens were strewn along the roads, most without a place to live. It made me wonder what I did to deserve such a good life in the castle, and I honestly felt quite bad about myself. But Seth assured me that even if it isn't fair, it's also not my fault. He told me that all I could do was to try my best for the people, and hope that they'll appreciate it. Formalities aside, Seth is a really good friend. I'm really glad to have him by my side these past few years."
          - Diary_4 == 0 ?
            [4/7] This page is missing.
        }
      - {
          - Diary_5 == 1 ?
            "[5/7] January 1480: I didn't feel very well today. My head was spinning when I woke up, and a doctor was immediately summoned to check up on me. Apparently I've contracted a very deadly disease which only can be cured by an extremely rare herb. My stomach hurts and my body feels weak, but I know I'll be fine. Seth has been sent out to go look for the medicine; if there's anyone who can do it, it's him"
          - Diary_5 == 0 ?
            [5/7] This page is missing.
        }
      - {
          - Diary_6 == 1 ?
            "[6/7] May 1480: Everyday my body gets weaker, and I'm slowly unable to do things I could usually do. Everyone in the castle is worried for me, especially Lucy. So I try my best to put on a smile as much as I can. But really, I don't know how much more I can hold on any longer. I've come to like the {clr3}{wvy}night{wvy}{clr3}; with all the restrictions being put on me, there are really only {clr3}{wvy}certain places{wvy}{clr3} that I can {clr3}{wvy}visit{wvy}{clr3} when the sun goes down. There's an old folklore which says that if you bring {clr3}{wvy}four flowers{wvy}{clr3} of specific colors to a place deep into the forest, you'll be granted a wish. It's been four months since Seth left, and quite honestly I'm not really longing that much to be cured anymore. If I could wish for anything, it would be for Seth to get back safely, just so I can see him again..."
          - Diary_6 == 0 ?
            [6/7] This page is missing.
        }
      - {
          - Diary_7 == 1 ?
            "[7/7] August 1480: I've coughed out blood for the third time this week, and the week has barely even started. At this point, I've already accepted being sickly as a given. The whole castle is swarming because of me, and father has forbidden me from leaving the castle for my own safety. {shk}But I'm so sick of this place!{shk} Ever since Seth left, I've not had anyone to confide in, let alone have a decent conversation with. Even Lucy hasn't been able to come visit me for fear of her contracting the disease too. I've had enough, I'm honestly grasping at straws at this point. There's a {clr3}{wvy}secret passage{wvy}{clr3} I know hidden behind the {clr3}{wvy}church{wvy}{clr3} through the {clr3}{wvy}rightmost stained glass window{wvy}{clr3} which is left unlocked at night. It leads in the direction of the {clr3}{wvy}forest{wvy}{clr3}, and I've collected my own four flowers. I can only pray for my wish to be granted. Seth, wherever you are, I miss you..."
          - Diary_7 == 0 ?
            [7/7] This page is missing.
        }
    }
}
"""

DLG SPR_4n
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_4o
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_4p
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_4q
Your closet is full of clothes. I mean, what else were you expecting?

DLG SPR_4r
It's an empty chest.

DLG SPR_4s
"""
{
  - Flowers == 4 ?
    Four full {clr3}{wvy}flowers{wvy}{clr3} adorn the old wooden table. (4/4)
  - Flowers == 3 ?
    Three full {clr3}{wvy}flowers{wvy}{clr3} sit comfortably on the old wooden table. (3/4)
  - Flowers == 2 ?
    Two full {clr3}{wvy}flowers{wvy}{clr3} sit nicely on the old wooden table. (2/4)
  - Flowers == 1 ?
    A lone full {clr3}{wvy}flower{wvy}{clr3} sits pretty on the old wooden table. (1/4)
  - Flowers == 0 ?
    Loose {wvy}{clr3}flower{clr3}{wvy} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
  - Flowers == 100 ?
    {Flowers = 0}Loose {clr3}{wvy}flower{wvy}{clr3} petals of various colors are scattered across the table. None of which, however, are of any interest to you. (0/4)
}
"""

DLG SPR_4t
It's a chair.

DLG SPR_4u
It's a chair.

DLG SPR_4v
It's a chair.

DLG SPR_4w
You've just woken up, and you want to go back to sleep?

DLG SPR_4x
You've just woken up, and you want to go back to sleep?

DLG SPR_4y
The chair looks like it's give way even if you didn't sit on it.

DLG SPR_4z
The numerous coffee stains on the table lead you to believe that this might be a coffee table.

DLG SPR_50
A strong aroma comes from the pots upon the burning stove.

DLG SPR_51
A strong aroma comes from the pots upon the burning stove.

DLG SPR_52
A coat hanger without any coats.

DLG SPR_53
The ephemeral flames of the fireplace burn with a comfortable warmth.

DLG SPR_54
The ephemeral flames of the fireplace burn with a comfortable warmth.

DLG SPR_55
The chair looks like it's give way even if you didn't sit on it.

DLG SPR_56
"""
{shuffle
  - Are you trying to bribe me?
  - What kind of kind neglects his citizens?
  - We did nothing wrong, people's livelihoods were at stake.
}
"""

DLG SPR_57
"""
{shuffle
  - Sorry bud, rules are rules.
  - Did we really do the right thing?
  - Sometimes I do feel sorry for the king.
}
"""

DLG SPR_58
The ephemeral flames of the fireplace burn with a comfortable warmth.

DLG SPR_59
The ephemeral flames of the fireplace burn with a comfortable warmth.

DLG SPR_5a
A strong aroma comes from the pots upon the burning stove.

DLG SPR_5b
A strong aroma comes from the pots upon the burning stove.

DLG SPR_5c
It's a chair.

DLG SPR_5d
It's a chair.

DLG SPR_5e
The numerous coffee stains on the table lead you to believe that this might be a coffee table.

DLG SPR_5f
Looks like a loom, used for spinning wool. It's not really something I know how to use.

DLG SPR_5g
The candle burns relentlessly, weakly but stubbornly persisting against the wavering wind.

DLG SPR_5h
The candle burns relentlessly, weakly but stubbornly persisting against the wavering wind.

DLG SPR_5i
The candle burns relentlessly, weakly but stubbornly persisting against the wavering wind.

DLG SPR_5j
The candle burns relentlessly, weakly but stubbornly persisting against the wavering wind.

DLG SPR_5k
The candle burns relentlessly, weakly but stubbornly persisting against the wavering wind. On the table draped in white are pieces of bread that look like they've been left out for way too long.

DLG SPR_5l
The candle burns relentlessly, weakly but stubbornly persisting against the wavering wind. On the table draped in white are pieces of bread that look like they've been left out for way too long.

DLG SPR_5m
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_5n
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_5o
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_5p
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_5q
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_5r
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_5s
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_5t
The flowers seem to have withered from prolonged negligence. Nothing could bring them back to their former beauty.

DLG SPR_5u
Its an abandoned stall. Nothing of interest here.

DLG SPR_5v
Its an abandoned stall. Nothing of interest here.

DLG SPR_5w
Its an abandoned stall. Nothing of interest here.

DLG SPR_5x
Its an abandoned stall. Nothing of interest here.

DLG SPR_5y
Its an abandoned stall. Nothing of interest here.

DLG SPR_5z
Its an abandoned stall. Nothing of interest here.

DLG SPR_60
Its an abandoned stall. Nothing of interest here.

DLG SPR_61
Its an abandoned stall. Nothing of interest here.

DLG SPR_62
Its an abandoned stall. Nothing of interest here.

DLG SPR_63
Its an abandoned stall. Nothing of interest here.

DLG SPR_64
Its an abandoned stall. Nothing of interest here.

DLG SPR_65
Its an abandoned stall. Nothing of interest here.

DLG SPR_66
Its an abandoned stall. Nothing of interest here.

DLG SPR_67
"""
{
  - ChestT == 0 ?
    {ChestT = 1}
{Flowers = Flowers + 1}You found a {clr3}{wvy}Black Orchid{wvy}{clr3}. ({say Flowers}/4)
  - else ?
    It's an empty chest
}
"""

DLG SPR_68
The castle gates are locked shut.

DLG SPR_69
The castle gates are locked shut.

DLG ITM_2
"""
{Diary = Diary + 1}
{Diary_1 = 1}You have obtained Freya's torn {clr3}{wvy}diary page{wvy}{clr3}. ({say Diary}/7)

"[Page 1] June 1470: As a member of royalty, I've had a relatively good life growing up. But going out of the castle for the first time today has opened my eyes to the many problems the citizens face on a daily basis. So I've decided to write this diary to record the things I've seen and experienced. Hopefully I'll learn to be a good leader when I grow up."
"""

DLG ITM_4
"""
{Diary = Diary + 1}
{Diary_2 = 1}You have obtained Freya's torn {clr3}{wvy}diary page{wvy}{clr3}. ({say Diary}/7)

"[Page 2] March 1472: Today was Lucy's birthday. She turns four this year, wow time flies doesn't it? It feels like it was just yesterday when I found her at the steps of the church! I bought her a {clr3}{wvy}stuffed teddy bear{wvy}{clr3} from a stall at the {clr3}{wvy}marketplace{wvy}{clr3} as a present, and she seemed really happy about it! I'm really looking forward to seeing her grow up!"
"""

DLG ITM_5
"""
{Diary = Diary + 1}
{Diary_3 = 1}You have obtained Freya's torn {clr3}{wvy}diary page{wvy}{clr3}. ({say Diary}/7)

"[Page 3] August 1474: Today I was was introduced to my personal guard. His name is Seth, and he's around my age! He was a little shy and stiff around me at first, but after we talked for a bit I managed to get him to warm up to me. He grew up in a poor family in this city, and he joined the military to help support his parents and young siblings. I hope to learn more about him as time goes by!"
"""

DLG ITM_6
"""
{Diary = Diary + 1}
{Diary_4 = 1}You have obtained Freya's torn {clr3}{wvy}diary page{wvy}{clr3}. ({say Diary}/7)

"[Page 4] June 1478: Today I was really overwhelmed by my visit to the residential areas. Plenty of poor and hungry citizens were strewn along the roads, most without a place to live. It made me wonder what I did to deserve such a good life in the castle, and I honestly felt quite bad about myself. But Seth assured me that even if it isn't fair, it's also not my fault. He told me that all I could do was to try my best for the people, and hope that they'll appreciate it. Formalities aside, Seth is a really good friend. I'm really glad to have him by my side these past few years."
"""

DLG ITM_7
"""
{Diary = Diary + 1}
{Diary_5 = 1}You have obtained Freya's torn {clr3}{wvy}diary page{wvy}{clr3}. ({say Diary}/7)

"[Page 5] January 1480: I didn't feel very well today. My head was spinning when I woke up, and a doctor was immediately summoned to check up on me. Apparently I've contracted a very deadly disease which only can be cured by an extremely rare herb. My stomach hurts and my body feels weak, but I know I'll be fine. Seth has been sent out to go look for the medicine; if there's anyone who can do it, it's him"
"""

DLG ITM_8
"""
{Diary = Diary + 1}
{Diary_6 = 1}You have obtained Freya's torn {clr3}{wvy}diary page{wvy}{clr3}. ({say Diary}/7)

"[Page 6] May 1480: Everyday my body gets weaker, and I'm slowly unable to do things I could usually do. Everyone in the castle is worried for me, especially Lucy. So I try my best to put on a smile as much as I can. But really, I don't know how much more I can hold on any longer. I've come to like the {clr3}{wvy}night{wvy}{clr3}; with all the restrictions being put on me, there are really only {clr3}{wvy}certain places{wvy}{clr3} that I can {clr3}{wvy}visit{wvy}{clr3} when the sun goes down. There's an old folklore which says that if you bring {clr3}{wvy}four flowers{wvy}{clr3} of specific colors to a place deep into the forest, you'll be granted a wish. It's been four months since Seth left, and quite honestly I'm not really longing that much to be cured anymore. If I could wish for anything, it would be for Seth to get back safely, just so I can see him again..."
"""

DLG ITM_9
"""
{Diary = Diary + 1}
{Diary_7 = 1}You have obtained Freya's torn {clr3}{wvy}diary page{wvy}{clr3}. ({say Diary}/7)

"[Page 7] August 1480: I've coughed out blood for the third time this week, and the week has barely even started. At this point, I've already accepted being sickly as a given. The whole castle is swarming because of me, and father has forbidden me from leaving the castle for my own safety. {shk}But I'm so sick of this place!{shk} Ever since Seth left, I've not had anyone to confide in, let alone have a decent conversation with. Even Lucy hasn't been able to come visit me for fear of her contracting the disease too. I've had enough, I'm honestly grasping at straws at this point. There's a {clr3}{wvy}secret passage{wvy}{clr3} I know hidden behind the {clr3}{wvy}church{wvy}{clr3} through the {clr3}{wvy}rightmost stained glass window{wvy}{clr3} which is left unlocked at night. It leads in the direction of the {clr3}{wvy}forest{wvy}{clr3}, and I've collected my own four flowers. I can only pray for my wish to be granted. Seth, wherever you are, I miss you..."
"""

DLG SPR_6a
Hey, where are you going? You can't just explore peoples' houses in like that!

DLG ITM_a
"""
{
  - Flowers < 4 ?

  - Diary < 7 ?

  - else ?
    There once was a mighty city, whose princess had a heart of gold.
}
"""

DLG ITM_b
"""
{
  - Flowers < 4 ?

  - Diary < 7 ?

  - else ?
    Accompanying her was her knight in shining armor and best friend. They were as inseparable as can be.
}
"""

DLG ITM_c
"""
{
  - Flowers < 4 ?

  - Diary < 7 ?

  - else ?
    But one day the princess fell deathly ill. And the knight went out to far away lands to seek out a cure for her.
}
"""

DLG ITM_d
"""
{
  - Flowers < 4 ?

  - Diary < 7 ?

  - else ?
    The princess was in even greater distress, wishing upon the four fabled flowers just for her best friend to be with her in her time of need.
}
"""

DLG ITM_e
"""
{
  - Flowers < 4 ?

  - Diary < 7 ?

  - else ?
    But alas, by the time the knight returned with the antidote, it had already been too late.
}
"""

DLG ITM_f
"""
{
  - Flowers < 4 ?

  - Diary < 7 ?

  - else ?
    The king fell into despair from losing his daughter, and the great city fell into a state of unrest.
}
"""

DLG ITM_g
"""
{
  - Flowers < 4 ?
    A tomb? Perhaps you should have {clr3}{wvy}explored the city more{wvy}{clr3}.
  - Diary < 7 ?
    A tomb? Perhaps you should have {clr3}{wvy}explored the city more{wvy}{clr3}.
  - else ?
    And so the knight brings flowers to her grave ever so regularly, secretly also wishing upon the same four flowers for his beloved princess back.
}
"""

DLG SPR_6b
To the Marketplace.

DLG SPR_6c
To the Marketplace

DLG SPR_6d
To the Residences.

DLG SPR_6e
To the Castle.

DLG SPR_6f
To the City Gates.

DLG SPR_6g
To the Marketplace.

DLG SPR_6h
To the Residences.

DLG SPR_6i
To the Castle.

DLG SPR_6j
To the City Gates.

DLG SPR_6k
To the Church.

DLG SPR_6l
To the Marketplace.

DLG SPR_6m
To the Royal Garden

DLG SPR_6n
To the Residences.

DLG SPR_6o
To the Church.

DLG SPR_6p
To the Marketplace.

DLG SPR_6q
To the Royal Castle.

DLG SPR_6r
To the Residences.

DLG SPR_6s
To the Royal Garden.

DLG SPR_6t
To the Marketplace.

DLG SPR_6u
To the Royal Castle.

DLG SPR_6v
"""
{shuffle
  - Forgive these people, for they know not what they have done.
  - All that is left of this city is a desolate ruin. A rose withered of its former beauty.
  - O King, what has happened to you...
}
"""

DLG SPR_6w
To the Royal Garden.

END 0
{say Ending}

END undefined


VAR Flowers
0

VAR Diary
0

VAR Quest_Lucy
0

VAR Coins
0

VAR Stuffed_Toy
0

VAR Quest_Gary
0

VAR Equipment
0

VAR Quest_Jason
0

VAR Clothes
0

VAR Quest_Weaver
0

VAR Locket
0

VAR Quest_Kid
0

VAR Bread
0

VAR Large_Key
0

VAR Small_Key
0

VAR Quest_George
0

VAR Knowledge
0

VAR Quest_Mystery
0

VAR Diary_1
0

VAR Diary_2
0

VAR Diary_7
0

VAR Diary_5
0

VAR Diary_3
0

VAR Diary_4
0

VAR Diary_6
0

VAR CheckD
0

VAR CheckF
0

VAR Ending
Thus is the Memoir of a Withered Rose.

VAR ChestT
0


</script>

<style>
html {
	margin:0px;
	padding:0px;
}

body {
	margin:0px;
	padding:0px;
	overflow:hidden;
	background:#c0c0c0;
}

#game {
	background:black;
	width:100vw;
	max-width:100vh;
	margin:auto;
	display:block;
}
</style>

<!-- SCRIPTS -->
<script>
function startExportedGame() {
	attachCanvas( document.getElementById("game") );
	load_game( document.getElementById("exportedGameData").text.slice(1) );
}
</script>

<script>
//hex-to-rgb method borrowed from stack overflow
function hexToRgb(hex) {
	// Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
	var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
	hex = hex.replace(shorthandRegex, function(m, r, g, b) {
		return r + r + g + g + b + b;
	});

	var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
	return result ? {
		r: parseInt(result[1], 16),
		g: parseInt(result[2], 16),
		b: parseInt(result[3], 16)
	} : null;
}
function componentToHex(c) {
    var hex = c.toString(16);
    return hex.length == 1 ? "0" + hex : hex;
}
function rgbToHex(r, g, b) {
    return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
}

function hslToHex(h,s,l) {
    var rgbArr = hslToRgb(h,s,l);
    return rgbToHex( Math.floor(rgbArr[0]), Math.floor(rgbArr[1]), Math.floor(rgbArr[2]) );
}

function hexToHsl(hex) {
    var rgb = hexToRgb(hex);
    return rgbToHsl(rgb.r, rgb.g, rgb.b);
}

// really just a vector distance
function colorDistance(a1,b1,c1,a2,b2,c2) {
    return Math.sqrt( Math.pow(a1 - a2, 2) + Math.pow(b1 - b2, 2) + Math.pow(c1 - c2, 2) );
}

function hexColorDistance(hex1,hex2) {
    var color1 = hexToRgb(hex1);
    var color2 = hexToRgb(hex2);
    return rgbColorDistance(color1.r, color1.g, color1.b, color2.r, color2.g, color2.b);
}


// source : http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c
/* accepts parameters
 * h  Object = {h:x, s:y, v:z}
 * OR 
 * h, s, v
*/
function HSVtoRGB(h, s, v) {
    var r, g, b, i, f, p, q, t;
    if (arguments.length === 1) {
        s = h.s, v = h.v, h = h.h;
    }
    i = Math.floor(h * 6);
    f = h * 6 - i;
    p = v * (1 - s);
    q = v * (1 - f * s);
    t = v * (1 - (1 - f) * s);
    switch (i % 6) {
        case 0: r = v, g = t, b = p; break;
        case 1: r = q, g = v, b = p; break;
        case 2: r = p, g = v, b = t; break;
        case 3: r = p, g = q, b = v; break;
        case 4: r = t, g = p, b = v; break;
        case 5: r = v, g = p, b = q; break;
    }
    return {
        r: Math.round(r * 255),
        g: Math.round(g * 255),
        b: Math.round(b * 255)
    };
}

/* accepts parameters
 * r  Object = {r:x, g:y, b:z}
 * OR 
 * r, g, b
*/
function RGBtoHSV(r, g, b) {
    if (arguments.length === 1) {
        g = r.g, b = r.b, r = r.r;
    }
    var max = Math.max(r, g, b), min = Math.min(r, g, b),
        d = max - min,
        h,
        s = (max === 0 ? 0 : d / max),
        v = max / 255;

    switch (max) {
        case min: h = 0; break;
        case r: h = (g - b) + d * (g < b ? 6: 0); h /= 6 * d; break;
        case g: h = (b - r) + d * 2; h /= 6 * d; break;
        case b: h = (r - g) + d * 4; h /= 6 * d; break;
    }

    return {
        h: h,
        s: s,
        v: v
    };
}

// source : https://gist.github.com/mjackson/5311256
/**
 * Converts an HSL color value to RGB. Conversion formula
 * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
 * Assumes h, s, and l are contained in the set [0, 1] and
 * returns r, g, and b in the set [0, 255].
 *
 * @param   Number  h       The hue
 * @param   Number  s       The saturation
 * @param   Number  l       The lightness
 * @return  Array           The RGB representation
 */
function hslToRgb(h, s, l) {
  var r, g, b;

  if (s == 0) {
    r = g = b = l; // achromatic
  } else {
    function hue2rgb(p, q, t) {
      if (t < 0) t += 1;
      if (t > 1) t -= 1;
      if (t < 1/6) return p + (q - p) * 6 * t;
      if (t < 1/2) return q;
      if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
      return p;
    }

    var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
    var p = 2 * l - q;

    r = hue2rgb(p, q, h + 1/3);
    g = hue2rgb(p, q, h);
    b = hue2rgb(p, q, h - 1/3);
  }

  return [ r * 255, g * 255, b * 255 ];
}

/**
 * From: http://stackoverflow.com/questions/2353211/hsl-to-rgb-color-conversion
 *
 * Converts an RGB color value to HSL. Conversion formula
 * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
 * Assumes r, g, and b are contained in the set [0, 255] and
 * returns h, s, and l in the set [0, 1].
 *
 * @param   {number}  r       The red color value
 * @param   {number}  g       The green color value
 * @param   {number}  b       The blue color value
 * @return  {Array}           The HSL representation
 */
function rgbToHsl(r, g, b){
    r /= 255, g /= 255, b /= 255;
    var max = Math.max(r, g, b), min = Math.min(r, g, b);
    var h, s, l = (max + min) / 2;

    if(max == min){
        h = s = 0; // achromatic
    }else{
        var d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch(max){
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
    }

    return [h, s, l];
}
</script>

<script>
var TransitionManager = function() {
	var transitionStart = null;
	var transitionEnd = null;
	var effectImage = null;

	var isTransitioning = false;
	var transitionTime = 0; // milliseconds
	var frameRate = 8; // cap the FPS
	var prevStep = -1; // used to avoid running post-process effect constantly

	this.BeginTransition = function(startRoom,startX,startY,endRoom,endX,endY,effectName) {
		// console.log("--- START ROOM TRANSITION ---");

		curEffect = effectName;

		var tmpRoom = player().room;
		var tmpX = player().x;
		var tmpY = player().y;

		if (transitionEffects[curEffect].showPlayerStart) {
			player().room = startRoom;
			player().x = startX;
			player().y = startY;
		}
		else {
			player().room = "_transition_none"; // kind of hacky!!
		}

		drawRoom(room[startRoom]);
		var startPalette = getPal( room[startRoom].pal );
		var startImage = new PostProcessImage( ctx.getImageData(0,0,canvas.width,canvas.height) ); // TODO : don't use global ctx?
		transitionStart = new TransitionInfo(startImage, startPalette, startX, startY);

		if (transitionEffects[curEffect].showPlayerEnd) {
			player().room = endRoom;
			player().x = endX;
			player().y = endY;
		}
		else {
			player().room = "_transition_none";
		}

		drawRoom(room[endRoom]);
		var endPalette = getPal( room[endRoom].pal );
		var endImage = new PostProcessImage( ctx.getImageData(0,0,canvas.width,canvas.height) );
		transitionEnd = new TransitionInfo(endImage, endPalette, endX, endY);

		effectImage = new PostProcessImage( ctx.createImageData(canvas.width,canvas.height) );

		isTransitioning = true;
		transitionTime = 0;
		prevStep = -1;

		player().room = tmpRoom;
		player().x = tmpX;
		player().y = tmpY;
	}

	this.UpdateTransition = function(dt) {
		if (!isTransitioning) {
			return;
		}

		transitionTime += dt;

		var transitionDelta = transitionTime / transitionEffects[curEffect].duration;
		var maxStep = Math.floor(frameRate * (transitionEffects[curEffect].duration / 1000));
		var step = Math.floor(transitionDelta * maxStep);

		if (step != prevStep) {
			// console.log("step! " + step + " " + transitionDelta);
			for (var y = 0; y < effectImage.Height; y++) {
				for (var x = 0; x < effectImage.Width; x++) {
					var color = transitionEffects[curEffect].pixelEffectFunc(transitionStart,transitionEnd,x,y,(step / maxStep));
					effectImage.SetPixel(x,y,color);
				}
			}
		}
		prevStep = step;

		ctx.putImageData(effectImage.GetData(), 0, 0);

		if (transitionTime >= transitionEffects[curEffect].duration) {
			isTransitioning = false;
			transitionTime = 0;
			transitionStart = null;
			transitionEnd = null;
			effectImage = null;
			prevStep = -1;
		}
	}

	this.IsTransitionActive = function() {
		return isTransitioning;
	}

	var transitionEffects = {};
	var curEffect = "none";
	this.RegisterTransitionEffect = function(name, effect) {
		transitionEffects[name] = effect;
	}

	this.RegisterTransitionEffect("none", {
		showPlayerStart : false,
		showPlayerEnd : false,
		pixelEffectFunc : function() {},
	});

	this.RegisterTransitionEffect("fade_w", { // TODO : have it linger on full white briefly?
		showPlayerStart : false,
		showPlayerEnd : true,
		duration : 750,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var pixelColorA = delta < 0.5 ? start.Image.GetPixel(pixelX,pixelY) : {r:255,g:255,b:255,a:255};
			var pixelColorB = delta < 0.5 ? {r:255,g:255,b:255,a:255} : end.Image.GetPixel(pixelX,pixelY);

			delta = delta < 0.5 ? (delta / 0.5) : ((delta - 0.5) / 0.5); // hacky

			return PostProcessUtilities.LerpColor(pixelColorA, pixelColorB, delta);
		}
	});

	this.RegisterTransitionEffect("fade_b", {
		showPlayerStart : false,
		showPlayerEnd : true,
		duration : 750,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var pixelColorA = delta < 0.5 ? start.Image.GetPixel(pixelX,pixelY) : {r:0,g:0,b:0,a:255};
			var pixelColorB = delta < 0.5 ? {r:0,g:0,b:0,a:255} : end.Image.GetPixel(pixelX,pixelY);

			delta = delta < 0.5 ? (delta / 0.5) : ((delta - 0.5) / 0.5); // hacky

			return PostProcessUtilities.LerpColor(pixelColorA, pixelColorB, delta);
		}
	});

	this.RegisterTransitionEffect("wave", {
		showPlayerStart : true,
		showPlayerEnd : true,
		duration : 1500,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var waveDelta = delta < 0.5 ? delta / 0.5 : 1 - ((delta - 0.5) / 0.5);

			var offset = (pixelY + (waveDelta * waveDelta * 0.2 * start.Image.Height));
			var freq = 4;
			var size = 2 + (14 * waveDelta);
			pixelX += Math.floor(Math.sin(offset / freq) * size);

			if (pixelX < 0) {
				pixelX += start.Image.Width;
			}
			else if (pixelX >= start.Image.Width) {
				pixelX -= start.Image.Width;
			}

			var curImage = delta < 0.5 ? start.Image : end.Image;
			return curImage.GetPixel(pixelX,pixelY);
		}
	});

	this.RegisterTransitionEffect("tunnel", {
		showPlayerStart : true,
		showPlayerEnd : true,
		duration : 1500,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			if (delta <= 0.4) {
				var tunnelDelta = 1 - (delta / 0.4);

				var xDist = start.PlayerCenter.x - pixelX;
				var yDist = start.PlayerCenter.y - pixelY;
				var dist = Math.sqrt((xDist * xDist) + (yDist * yDist));

				if (dist > start.Image.Width * tunnelDelta) {
					return {r:0,g:0,b:0,a:255};
				}
				else {
					return start.Image.GetPixel(pixelX,pixelY);
				}
			}
			else if (delta <= 0.6)
			{
				return {r:0,g:0,b:0,a:255};
			}
			else {
				var tunnelDelta = (delta - 0.6) / 0.4;

				var xDist = end.PlayerCenter.x - pixelX;
				var yDist = end.PlayerCenter.y - pixelY;
				var dist = Math.sqrt((xDist * xDist) + (yDist * yDist));

				if (dist > end.Image.Width * tunnelDelta) {
					return {r:0,g:0,b:0,a:255};
				}
				else {
					return end.Image.GetPixel(pixelX,pixelY);
				}
			}
		}
	});

	this.RegisterTransitionEffect("slide_u", {
		showPlayerStart : false,
		showPlayerEnd : true,
		duration : 1000,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var pixelOffset = -1 * Math.floor(start.Image.Height * delta);
			var slidePixelY = pixelY + pixelOffset;

			var colorDelta = clampLerp(delta, 0.4);

			if (slidePixelY >= 0) {
				var colorA = start.Image.GetPixel(pixelX,slidePixelY);
				var colorB = PostProcessUtilities.GetCorrespondingColorFromPal(colorA,start.Palette,end.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
			else {
				slidePixelY += start.Image.Height;
				var colorB = end.Image.GetPixel(pixelX,slidePixelY);
				var colorA = PostProcessUtilities.GetCorrespondingColorFromPal(colorB,end.Palette,start.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
		}
	});

	this.RegisterTransitionEffect("slide_d", {
		showPlayerStart : false,
		showPlayerEnd : true,
		duration : 1000,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var pixelOffset = Math.floor(start.Image.Height * delta);
			var slidePixelY = pixelY + pixelOffset;

			var colorDelta = clampLerp(delta, 0.4);

			if (slidePixelY < start.Image.Height) {
				var colorA = start.Image.GetPixel(pixelX,slidePixelY);
				var colorB = PostProcessUtilities.GetCorrespondingColorFromPal(colorA,start.Palette,end.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
			else {
				slidePixelY -= start.Image.Height;
				var colorB = end.Image.GetPixel(pixelX,slidePixelY);
				var colorA = PostProcessUtilities.GetCorrespondingColorFromPal(colorB,end.Palette,start.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
		}
	});

	this.RegisterTransitionEffect("slide_l", {
		showPlayerStart : false,
		showPlayerEnd : true,
		duration : 1000,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var pixelOffset = -1 * Math.floor(start.Image.Width * delta);
			var slidePixelX = pixelX + pixelOffset;

			var colorDelta = clampLerp(delta, 0.4);

			if (slidePixelX >= 0) {
				var colorA = start.Image.GetPixel(slidePixelX,pixelY);
				var colorB = PostProcessUtilities.GetCorrespondingColorFromPal(colorA,start.Palette,end.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
			else {
				slidePixelX += start.Image.Width;
				var colorB = end.Image.GetPixel(slidePixelX,pixelY);
				var colorA = PostProcessUtilities.GetCorrespondingColorFromPal(colorB,end.Palette,start.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
		}
	});

	this.RegisterTransitionEffect("slide_r", {
		showPlayerStart : false,
		showPlayerEnd : true,
		duration : 1000,
		pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
			var pixelOffset = Math.floor(start.Image.Width * delta);
			var slidePixelX = pixelX + pixelOffset;

			var colorDelta = clampLerp(delta, 0.4);

			if (slidePixelX < start.Image.Width) {
				var colorA = start.Image.GetPixel(slidePixelX,pixelY);
				var colorB = PostProcessUtilities.GetCorrespondingColorFromPal(colorA,start.Palette,end.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
			else {
				slidePixelX -= start.Image.Width;
				var colorB = end.Image.GetPixel(slidePixelX,pixelY);
				var colorA = PostProcessUtilities.GetCorrespondingColorFromPal(colorB,end.Palette,start.Palette);
				var colorLerped = PostProcessUtilities.LerpColor(colorA, colorB, colorDelta);
				return colorLerped;
			}
		}
	});

	function clampLerp(deltaIn, clampDuration) {
		var clampOffset = (1.0 - clampDuration) / 2;
		var deltaOut = Math.min(clampDuration, Math.max(0.0, deltaIn - clampOffset)) / clampDuration;
		return deltaOut;
	}

	// TODO : WIP
	// this.RegisterTransitionEffect("fuzz", {
	// 	showPlayerStart : true,
	// 	showPlayerEnd : true,
	// 	duration : 1500,
	// 	pixelEffectFunc : function(start,end,pixelX,pixelY,delta) {
	// 		var curImage = delta <= 0.5 ? start : end;
	// 		var sampleSize = delta <= 0.5 ? (2 + Math.floor(14 * (delta/0.5))) : (16 - Math.floor(14 * ((delta-0.5)/0.5)));

	// 		var palIndex = 0;

	// 		var sampleX = Math.floor(pixelX / sampleSize) * sampleSize;
	// 		var sampleY = Math.floor(pixelY / sampleSize) * sampleSize;

	// 		var frameState = transitionEffects["fuzz"].frameState;

	// 		if (frameState.time != delta) {
	// 			frameState.time = delta;
	// 			frameState.preCalcSampleValues = {};
	// 		}

	// 		if (frameState.preCalcSampleValues[[sampleX,sampleY]]) {
	// 			palIndex = frameState.preCalcSampleValues[[sampleX,sampleY]];
	// 		}
	// 		else {
	// 			var paletteCount = {};
	// 			var foregroundValue = 1.0;
	// 			var backgroundValue = 0.4;
	// 			for (var y = sampleY; y < sampleY + sampleSize; y++) {
	// 				for (var x = sampleX; x < sampleX + sampleSize; x++) {
	// 					var color = curImage.Image.GetPixel(x,y)
	// 					var palIndex = PostProcessUtilities.GetColorPalIndex(color,curImage.Palette);
	// 					if (palIndex != -1) {
	// 						if (paletteCount[palIndex]) {
	// 							paletteCount[palIndex] += (palIndex != 0) ? foregroundValue : backgroundValue;
	// 						}
	// 						else {
	// 							paletteCount[palIndex] = (palIndex != 0) ? foregroundValue : backgroundValue;
	// 						}
	// 					}
	// 				}
	// 			}

	// 			var maxCount = 0;
	// 			for (var i in paletteCount) {
	// 				if (paletteCount[i] > maxCount) {
	// 					palIndex = i;
	// 					maxCount = paletteCount[i];
	// 				}
	// 			}

	// 			frameState.preCalcSampleValues[[sampleX,sampleY]] = palIndex;
	// 		}

	// 		return PostProcessUtilities.GetPalColor(curImage.Palette,palIndex);
	// 	},
	// 	frameState : { // ok this is hacky but it's for performance ok
	// 		time : -1,
	// 		preCalcSampleValues : {}
	// 	}
	// });
}; // TransitionManager()


// TODO : extract the scale variable so it can be changed?
var PostProcessUtilities = {
	SamplePixelColor : function(image,x,y) {
		var pixelIndex = (y * scale * image.width * 4) + (x * scale * 4);
		var r = image.data[pixelIndex + 0];
		var g = image.data[pixelIndex + 1];
		var b = image.data[pixelIndex + 2];
		var a = image.data[pixelIndex + 3];
		return { r:r, g:g, b:b, a:a };
	},
	SetPixelColor : function(image,x,y,colorRgba) {
		for (var yDelta = 0; yDelta <= scale; yDelta++) {
			for (var xDelta = 0; xDelta <= scale; xDelta++) {
				var pixelIndex = (((y * scale) + yDelta) * image.width * 4) + (((x * scale) + xDelta) * 4);
				image.data[pixelIndex + 0] = colorRgba.r;
				image.data[pixelIndex + 1] = colorRgba.g;
				image.data[pixelIndex + 2] = colorRgba.b;
				image.data[pixelIndex + 3] = colorRgba.a;
			}
		}
	},
	LerpColor : function(colorA,colorB,t) {
		// TODO: move to color_util.js?
		return {
			r : colorA.r + ((colorB.r - colorA.r) * t),
			g : colorA.g + ((colorB.g - colorA.g) * t),
			b : colorA.b + ((colorB.b - colorA.b) * t),
			a : colorA.a + ((colorB.a - colorA.a) * t),
		};
	},
	GetColorPalIndex : function(colorIn,curPal) {
		var colorIndex = -1;

		for (var i = 0; i < curPal.length; i++) {
			if (colorIn.r == curPal[i][0] && colorIn.g == curPal[i][1] && colorIn.b == curPal[i][2]) {
				colorIndex = i;
			}
		}

		return colorIndex;
	},
	GetPalColor : function(palette,index) {
		return { r: palette[index][0], g: palette[index][1], b: palette[index][2], a: 255 }
	},
	GetCorrespondingColorFromPal : function(colorIn,curPal,otherPal) { // this is kind of hacky!
		var colorIndex = PostProcessUtilities.GetColorPalIndex(colorIn,curPal);

		if (colorIndex >= 0 && colorIndex <= otherPal.length) {
			return PostProcessUtilities.GetPalColor(otherPal,colorIndex);
		}
		else {
			return colorIn;
		}
	},
};

var PostProcessImage = function(imageData) {
	this.Width = imageData.width / scale;
	this.Height = imageData.height / scale;

	this.GetPixel = function(x,y) {
		return PostProcessUtilities.SamplePixelColor(imageData,x,y);
	};

	this.SetPixel = function(x,y,colorRgba) {
		PostProcessUtilities.SetPixelColor(imageData,x,y,colorRgba);
	};

	this.GetData = function() {
		return imageData;
	};
};

var TransitionInfo = function(image, palette, playerX, playerY) {
	this.Image = image;
	this.Palette = palette;
	this.PlayerTilePos = { x: playerX, y: playerY };
	this.PlayerCenter = { x: Math.floor((playerX * tilesize) + (tilesize / 2)), y: Math.floor((playerY * tilesize) + (tilesize / 2)) };
};
</script>

<script>
/*
TODO:
- untangle local & external resource use in font manager (still more to do here)
*/

function FontManager(useExternalResources) {

if (useExternalResources === undefined || useExternalResources === null) {
	useExternalResources = false;
}

var self = this;

var fontExtension = ".bitsyfont";
this.GetExtension = function() {
	return fontExtension;
}

// place to store font data that is part of the local game data
var localResources = {};

// place to store font data fetched from a server (only used in editor)
var externalResources = null;
if (useExternalResources) {
	externalResources = new ResourceLoader();// NOTE : this class doesn't exist in exported game
}

this.LoadResources = function(filenames, onLoadAll) {
	if (!useExternalResources)
		return;

	// TODO : is this being called too many times?
	var onLoad = function() {
		var count = externalResources.getResourceLoadedCount();

		if (count >= filenames.length && onLoadAll != null) {
			onLoadAll();
		}
	}

	for (var i = 0; i < filenames.length; i++) {
		externalResources.load("bitsyfont", filenames[i], onLoad);
	}
}

// manually add resource
this.AddResource = function(filename, fontdata) {
	if (useExternalResources) {
		externalResources.set(filename, fontdata);
	}
	else {
		localResources[filename] = fontdata;
	}
}

this.ContainsResource = function(filename) {
	if (useExternalResources) {
		return externalResources.contains(filename);
	}
	else {
		return localResources[filename] != null;
	}
}

function GetData(fontName) {
	if (useExternalResources) {
		return externalResources.get(fontName + fontExtension);
	}
	else {
		return localResources[fontName + fontExtension];
	}
}
this.GetData = GetData;

function Create(fontData) {
	return new Font(fontData);
}
this.Create = Create;

this.Get = function(fontName) {
	var fontData = self.GetData(fontName);
	return self.Create(fontData);
}

function Font(fontData) {
	var name = "unknown";
	var width = 6; // default size so if you have NO font or an invalid font it displays boxes
	var height = 8;
	var chardata = {};
	var invalidCharData = {};

	this.getName = function() {
		return name;
	}

	this.getData = function() {
		return chardata;
	}

	this.getWidth = function() {
		return width;
	}

	this.getHeight = function() {
		return height;
	}

	this.hasChar = function(char) {
		var codepoint = char.charCodeAt(0);
		return chardata[codepoint] != null;
	}

	this.getChar = function(char) {

		var codepoint = char.charCodeAt(0);

		if (chardata[codepoint] != null) {
			return chardata[codepoint];
		}
		else {
			return invalidCharData;
		}
	}

	this.allCharCodes = function() {
		var codeList = [];
		for (var code in chardata) {
			codeList.push(code);
		}
		return codeList;
	}

	function parseFont(fontData) {
		if (fontData == null)
			return;

		var lines = fontData.split("\n");

		var isReadingChar = false;
		var isReadingCharProperties = false;
		var curCharLineCount = 0;
		var curCharCode = 0;

		for (var i = 0; i < lines.length; i++) {
			var line = lines[i];

			if (line[0] === "#") {
				continue; // skip comment lines
			}

			if (!isReadingChar) {
				// READING NON CHARACTER DATA LINE
				var args = line.split(" ");
				if (args[0] == "FONT") {
					name = args[1];
				}
				else if (args[0] == "SIZE") {
					width = parseInt(args[1]);
					height = parseInt(args[2]);
				}
				else if (args[0] == "CHAR") {
					isReadingChar = true;
					isReadingCharProperties = true;

					curCharLineCount = 0;
					curCharCode = parseInt(args[1]);
					chardata[curCharCode] = { 
						width: width,
						height: height,
						offset: {
							x: 0,
							y: 0
						},
						spacing: width,
						data: []
					};
				}
			}
			else {
				// CHAR PROPERTIES
				if (isReadingCharProperties) {
					var args = line.split(" ");
					if (args[0].indexOf("CHAR_") == 0) { // Sub-properties start with "CHAR_"
						if (args[0] == "CHAR_SIZE") {
							// Custom character size - overrides the default character size for the font
							chardata[curCharCode].width = parseInt(args[1]);
							chardata[curCharCode].height = parseInt(args[2]);
							chardata[curCharCode].spacing = parseInt(args[1]); // HACK : assumes CHAR_SIZE is always declared first
						}
						else if (args[0] == "CHAR_OFFSET") {
							// Character offset - shift the origin of the character on the X or Y axis
							chardata[curCharCode].offset.x = parseInt(args[1]);
							chardata[curCharCode].offset.y = parseInt(args[2]);
						}
						else if (args[0] == "CHAR_SPACING") {
							// Character spacing:
							// specify total horizontal space taken up by the character
							// lets chars take up more or less space on a line than its bitmap does
							chardata[curCharCode].spacing = parseInt(args[1]);
						}
					}
					else {
						isReadingCharProperties = false;
					}
				}

				// CHAR DATA
				if (!isReadingCharProperties) {
					// READING CHARACTER DATA LINE
					for (var j = 0; j < chardata[curCharCode].width; j++)
					{
						chardata[curCharCode].data.push( parseInt(line[j]) );
					}

					curCharLineCount++;
					if (curCharLineCount >= height) {
						isReadingChar = false;
					}
				}
			}
		}

		// init invalid character box
		invalidCharData = { 
			width: width,
			height: height,
			offset: {
				x: 0,
				y: 0
			},
			spacing: width, // TODO : name?
			data: []
		};
		for (var y = 0; y < height; y++) {
			for (var x = 0; x < width; x++) {
				if (x < width-1 && y < height-1) {
					invalidCharData.data.push(1);
				}
				else {
					invalidCharData.data.push(0);
				}
			}
		}
	}

	parseFont(fontData);
}

} // FontManager
</script>

<script>
function Script() {

this.CreateInterpreter = function() {
	return new Interpreter();
};

this.CreateUtils = function() {
	return new Utils();
};

var Interpreter = function() {
	var env = new Environment();
	var parser = new Parser( env );

	this.SetDialogBuffer = function(buffer) { env.SetDialogBuffer( buffer ); };

	// TODO -- maybe this should return a string instead othe actual script??
	this.Compile = function(scriptName, scriptStr) {
		// console.log("COMPILE");
		var script = parser.Parse( scriptStr );
		env.SetScript( scriptName, script );
	}
	this.Run = function(scriptName, exitHandler) { // Runs pre-compiled script
		// console.log("RUN");
		// console.log(env.GetScript( scriptName ));
		env.GetScript( scriptName )
			.Eval( env, function(result) { OnScriptReturn(result, exitHandler); } );

		// console.log("SERIALIZE!!!!");
		// console.log( env.GetScript( scriptName ).Serialize() );
	}
	this.Interpret = function(scriptStr, exitHandler) { // Compiles and runs code immediately
		// console.log("INTERPRET");
		var script = parser.Parse( scriptStr );
		script.Eval( env, function(result) { OnScriptReturn(result, exitHandler); } );
	}
	this.HasScript = function(name) { return env.HasScript(name); };

	this.ResetEnvironment = function() {
		env = new Environment();
		parser = new Parser( env );
	}

	this.Parse = function(scriptStr) { // parses a script but doesn't save it
		return parser.Parse( scriptStr );
	}
	this.Eval = function(scriptTree, exitHandler) { // runs a script stored externally
		scriptTree.Eval( env, function(result) { OnScriptReturn(result, exitHandler); } );
	}

	function OnScriptReturn(result, exitHandler) {
		if (isReturnObject(result)) {
			result = result.result; // pull out the contained result
		}

		// console.log("RESULT " + result);

		if (exitHandler != null) {
			exitHandler(result);
		}
	}

	this.CreateExpression = function(expStr) {
		return parser.CreateExpression( expStr );
	}

	this.SetVariable = function(name,value,useHandler) {
		env.SetVariable(name,value,useHandler);
	}

	this.DeleteVariable = function(name,useHandler) {
		env.DeleteVariable(name,useHandler);
	}
	this.HasVariable = function(name) {
		return env.HasVariable(name);
	}

	this.SetOnVariableChangeHandler = function(onVariableChange) {
		env.SetOnVariableChangeHandler(onVariableChange);
	}
	this.GetVariableNames = function() {
		return env.GetVariableNames();
	}
	this.GetVariable = function(name) {
		return env.GetVariable(name);
	}

	this.DebugVisualizeScriptTree = function(scriptName) {
		var printVisitor = {
			Visit : function(node,depth) {
				console.log("-".repeat(depth) + "- " + node.ToString());
			},
		};

		env.GetScript( scriptName ).VisitAll( printVisitor );
	}
}


var Utils = function() {
	// for editor ui
	this.CreateDialogBlock = function(children,doIndentFirstLine) {
		if(doIndentFirstLine === undefined) doIndentFirstLine = true;
		var block = new BlockNode( BlockMode.Dialog, doIndentFirstLine );
		for(var i = 0; i < children.length; i++) {
			block.AddChild( children[i] );
		}
		return block;
	}

	this.ChangeSequenceType = function(oldSequence,type) {
		if(type === "sequence") {
			return new SequenceNode( oldSequence.options );
		}
		else if(type === "cycle") {
			return new CycleNode( oldSequence.options );
		}
		else if(type === "shuffle") {
			return new ShuffleNode( oldSequence.options );
		}
		return oldSequence;
	}

	this.CreateSequenceBlock = function() {
		var option1 = new BlockNode( BlockMode.Dialog, false /*doIndentFirstLine*/ );
		var option2 = new BlockNode( BlockMode.Dialog, false /*doIndentFirstLine*/ );
		var sequence = new SequenceNode( [ option1, option2 ] );
		var block = new BlockNode( BlockMode.Code );
		block.AddChild( sequence );
		return block;
	}

	this.CreateIfBlock = function() {
		var leftNode = new BlockNode( BlockMode.Code );
		leftNode.AddChild( new FuncNode("item", [new LiteralNode("0")] ) );
		var rightNode = new LiteralNode( 1 );
		var condition1 = new ExpNode("==", leftNode, rightNode );

		var condition2 = new ElseNode();

		var result1 = new BlockNode( BlockMode.Dialog );
		var result2 = new BlockNode( BlockMode.Dialog );

		var ifNode = new IfNode( [ condition1, condition2 ], [ result1, result2 ] );
		var block = new BlockNode( BlockMode.Code );
		block.AddChild( ifNode );
		return block;
	}

	this.ReadDialogScript = function(lines, i) {
		var scriptStr = "";
		if (lines[i] === Sym.DialogOpen) {
			scriptStr += lines[i] + "\n";
			i++;
			while(lines[i] != Sym.DialogClose) {
				scriptStr += lines[i] + "\n";
				i++;
			}
			scriptStr += lines[i];
			i++;
		}
		else {
			scriptStr += lines[i];
		}
		return { script:scriptStr, index:i };
	}

	// TODO this.ReadCodeScript (reads through code open and close symbols), and this.ReadScript

	this.EnsureDialogBlockFormat = function(dialogStr) {
		// TODO -- what if it's already enclosed in dialog symbols??
		if(dialogStr.indexOf('\n') > -1) {
			dialogStr = Sym.DialogOpen + "\n" + dialogStr + "\n" + Sym.DialogClose;
		}
		return dialogStr;
	}

	this.RemoveDialogBlockFormat = function(source) {
		var sourceLines = source.split("\n");
		var dialogStr = "";
		if(sourceLines[0] === Sym.DialogOpen) {
			// multi line
			var i = 1;
			while (i < sourceLines.length && sourceLines[i] != Sym.DialogClose) {
				dialogStr += sourceLines[i] + (sourceLines[i+1] != Sym.DialogClose ? '\n' : '');
				i++;
			}
		}
		else {
			// single line
			dialogStr = source;
		}
		return dialogStr;
	}
}


/* BUILT-IN FUNCTIONS */ // TODO: better way to encapsulate these?
function deprecatedFunc(environment,parameters,onReturn) {
	console.log("BITSY SCRIPT WARNING: Tried to use deprecated function");
	onReturn(null);
}

// TODO : vNext
// function returnFunc(environment,parameters,onReturn) {
// 	var ret = { isReturn: true, result: null };
// 	if (parameters.length > 0 && parameters[0] != undefined && parameters[0] != null) {
// 		ret.result = parameters[0];
// 	}
// 	onReturn(ret);
// }

// TODO : vNext
// // TODO : this is kind of hacky
// // - needs to work with names too
// function changeAvatarFunc(environment,parameters,onReturn) {
// 	if( parameters[0] != undefined && parameters[0] != null ) {
// 		sprite["A"].drw = "SPR_" + parameters[0];
// 	}
// 	onReturn(null);
// }

function printFunc(environment,parameters,onReturn) {
	// console.log("PRINT FUNC");
	// console.log(parameters);
	if( parameters[0] != undefined && parameters[0] != null ) {
		// console.log(parameters[0]);
		// console.log(parameters[0].toString());
		// var textStr = parameters[0].toString();
		var textStr = "" + parameters[0];
		// console.log(textStr);
		var onFinishHandler = function() {
			// console.log("FINISHED PRINTING ---- SCRIPT");
			onReturn(null);
		}; // called when dialog is finished printing
		environment.GetDialogBuffer().AddText( textStr, onFinishHandler );
	}
	else {
		onReturn(null);
	}
}

function linebreakFunc(environment,parameters,onReturn) {
	// console.log("LINEBREAK FUNC");
	environment.GetDialogBuffer().AddLinebreak();
	onReturn(null);
}

function printDrawingFunc(environment,parameters,onReturn) {
	var drawingId = parameters[0];
	environment.GetDialogBuffer().AddDrawing( drawingId, function() {
		onReturn(null);
	});
}

function printSpriteFunc(environment,parameters,onReturn) {
	var spriteId = parameters[0];
	if(names.sprite.has(spriteId)) spriteId = names.sprite.get(spriteId); // id is actually a name
	var drawingId = sprite[spriteId].drw;
	printDrawingFunc(environment, [drawingId], onReturn);
}

function printTileFunc(environment,parameters,onReturn) {
	var tileId = parameters[0];
	if(names.tile.has(tileId)) tileId = names.tile.get(tileId); // id is actually a name
	var drawingId = tile[tileId].drw;
	printDrawingFunc(environment, [drawingId], onReturn);
}

function printItemFunc(environment,parameters,onReturn) {
	var itemId = parameters[0];
	if(names.item.has(itemId)) itemId = names.item.get(itemId); // id is actually a name
	var drawingId = item[itemId].drw;
	printDrawingFunc(environment, [drawingId], onReturn);
}

function printFontFunc(environment, parameters, onReturn) {
	var allCharacters = "";
	var font = fontManager.Get( fontName );
	var codeList = font.allCharCodes();
	for (var i = 0; i < codeList.length; i++) {
		allCharacters += String.fromCharCode(codeList[i]) + " ";
	}
	printFunc(environment, [allCharacters], onReturn);
}

function itemFunc(environment,parameters,onReturn) {
	var itemId = parameters[0];
	if(names.item.has(itemId)) itemId = names.item.get(itemId); // id is actually a name
	var itemCount = player().inventory[itemId] ? player().inventory[itemId] : 0; // TODO : ultimately the environment should include a reference to the game state
	// console.log("ITEM FUNC " + itemId + " " + itemCount);
	onReturn(itemCount);
}

function addOrRemoveTextEffect(environment,name) {
	if( environment.GetDialogBuffer().HasTextEffect(name) )
		environment.GetDialogBuffer().RemoveTextEffect(name);
	else
		environment.GetDialogBuffer().AddTextEffect(name);
}

function rainbowFunc(environment,parameters,onReturn) {
	addOrRemoveTextEffect(environment,"rbw");
	onReturn(null);
}

// TODO : should the colors use a parameter instead of special names?
function color1Func(environment,parameters,onReturn) {
	addOrRemoveTextEffect(environment,"clr1");
	onReturn(null);
}

function color2Func(environment,parameters,onReturn) {
	addOrRemoveTextEffect(environment,"clr2");
	onReturn(null);
}

function color3Func(environment,parameters,onReturn) {
	addOrRemoveTextEffect(environment,"clr3");
	onReturn(null);
}

function wavyFunc(environment,parameters,onReturn) {
	addOrRemoveTextEffect(environment,"wvy");
	onReturn(null);
}

function shakyFunc(environment,parameters,onReturn) {
	addOrRemoveTextEffect(environment,"shk");
	onReturn(null);
}

/* BUILT-IN OPERATORS */
function setExp(environment,left,right,onReturn) {
	// console.log("SET " + left.name);

	if(left.type != "variable") {
		// not a variable! return null and hope for the best D:
		onReturn( null );
		return;
	}

	right.Eval(environment,function(rVal) {
		environment.SetVariable( left.name, rVal );
		// console.log("VAL " + environment.GetVariable( left.name ) );
		left.Eval(environment,function(lVal) {
			onReturn( lVal );
		});
	});
}
function equalExp(environment,left,right,onReturn) {
	// console.log("EVAL EQUAL");
	// console.log(left);
	// console.log(right);
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal === rVal );
		});
	});
}
function greaterExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal > rVal );
		});
	});
}
function lessExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal < rVal );
		});
	});
}
function greaterEqExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal >= rVal );
		});
	});
}
function lessEqExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal <= rVal );
		});
	});
}
function multExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal * rVal );
		});
	});
}
function divExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal / rVal );
		});
	});
}
function addExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal + rVal );
		});
	});
}
function subExp(environment,left,right,onReturn) {
	right.Eval(environment,function(rVal){
		left.Eval(environment,function(lVal){
			onReturn( lVal - rVal );
		});
	});
}

/* ENVIRONMENT */
var Environment = function() {
	var dialogBuffer = null;
	this.SetDialogBuffer = function(buffer) { dialogBuffer = buffer; };
	this.GetDialogBuffer = function() { return dialogBuffer; };

	var functionMap = new Map();
	functionMap.set("print", printFunc);
	functionMap.set("say", printFunc);
	functionMap.set("br", linebreakFunc);
	functionMap.set("item", itemFunc);
	functionMap.set("rbw", rainbowFunc);
	functionMap.set("clr1", color1Func);
	functionMap.set("clr2", color2Func);
	functionMap.set("clr3", color3Func);
	functionMap.set("wvy", wavyFunc);
	functionMap.set("shk", shakyFunc);
	functionMap.set("printSprite", printSpriteFunc);
	functionMap.set("printTile", printTileFunc);
	functionMap.set("printItem", printItemFunc);
	functionMap.set("debugOnlyPrintFont", printFontFunc); // DEBUG ONLY

	// TODO : vNext
	// functionMap.set("changeAvatar", changeAvatarFunc);
	// functionMap.set("return", returnFunc);

	this.HasFunction = function(name) { return functionMap.has(name); };
	this.EvalFunction = function(name,parameters,onReturn) {
		// console.log(functionMap);
		// console.log(name);
		functionMap.get( name )( this, parameters, onReturn );
	}

	var variableMap = new Map();

	this.HasVariable = function(name) { return variableMap.has(name); };
	this.GetVariable = function(name) { return variableMap.get(name); };
	this.SetVariable = function(name,value,useHandler) {
		// console.log("SET VARIABLE " + name + " = " + value);
		if(useHandler === undefined) useHandler = true;
		variableMap.set(name, value);
		if(onVariableChangeHandler != null && useHandler)
			onVariableChangeHandler(name);
	};
	this.DeleteVariable = function(name,useHandler) {
		if(useHandler === undefined) useHandler = true;
		if(variableMap.has(name)) {
			variableMap.delete(name);
			if(onVariableChangeHandler != null && useHandler)
				onVariableChangeHandler(name);
		}
	};

	var operatorMap = new Map();
	operatorMap.set("=", setExp);
	operatorMap.set("==", equalExp);
	operatorMap.set(">", greaterExp);
	operatorMap.set("<", lessExp);
	operatorMap.set(">=", greaterEqExp);
	operatorMap.set("<=", lessEqExp);
	operatorMap.set("*", multExp);
	operatorMap.set("/", divExp);
	operatorMap.set("+", addExp);
	operatorMap.set("-", subExp);

	this.HasOperator = function(sym) { return operatorMap.get(sym); };
	this.EvalOperator = function(sym,left,right,onReturn) {
		operatorMap.get( sym )( this, left, right, onReturn );
	}

	var scriptMap = new Map();
	this.HasScript = function(name) { return scriptMap.has(name); };
	this.GetScript = function(name) { return scriptMap.get(name); };
	this.SetScript = function(name,script) { scriptMap.set(name, script); };

	var onVariableChangeHandler = null;
	this.SetOnVariableChangeHandler = function(onVariableChange) {
		onVariableChangeHandler = onVariableChange;
	}
	this.GetVariableNames = function() {
		return Array.from( variableMap.keys() );
	}
}

function leadingWhitespace(depth) {
	var str = "";
	for(var i = 0; i < depth; i++) {
		str += "  "; // two spaces per indent
	}
	// console.log("WHITESPACE " + depth + " ::" + str + "::");
	return str;
}

/* NODES */
var TreeRelationship = function() {
	this.parent = null;
	this.children = [];
	this.AddChild = function(node) {
		this.children.push( node );
		node.parent = this;
	};

	this.VisitAll = function(visitor, depth) {
		if (depth == undefined || depth == null) {
			depth = 0;
		}

		visitor.Visit( this, depth );
		for( var i = 0; i < this.children.length; i++ ) {
			this.children[i].VisitAll( visitor, depth + 1 );
		}
	};
}

function isReturnObject(val) {
	return typeof val === "object" && val != null
				&& val.isReturn != undefined && val.isReturn != null
				&& val.isReturn;
}

var BlockMode = {
	Code : "code",
	Dialog : "dialog"
};

var BlockNode = function(mode, doIndentFirstLine) {
	Object.assign( this, new TreeRelationship() );
	// Object.assign( this, new Runnable() );
	this.type = "block";
	this.mode = mode;

	this.Eval = function(environment,onReturn) {
		// console.log("EVAL BLOCK " + this.children.length);

		if( this.onEnter != null ) {
			this.onEnter();
		}

		var lastVal = null;
		var i = 0;

		function evalChildren(children,done) {
			if (i < children.length) {
				// console.log(">> CHILD " + i);
				children[i].Eval( environment, function(val) {
					// console.log("<< CHILD " + i);

					if (isReturnObject(val)) { // early return
						lastVal = val;
						done();
					}
					else {
						lastVal = val;
						i++;
						evalChildren(children,done);
					}
				} );
			}
			else {
				done();
			}
		};

		var self = this;
		evalChildren( this.children, function() {
			if( self.onExit != null ) {
				self.onExit();
			}
			onReturn(lastVal);
		} );
	}

	if(doIndentFirstLine === undefined) doIndentFirstLine = true; // This is just for serialization

	this.Serialize = function(depth) {
		if(depth === undefined) depth = 0;

		// console.log("SERIALIZE BLOCK!!!");
		// console.log(depth);
		// console.log(doIndentFirstLine);

		var str = "";
		var lastNode = null;
		if (this.mode === BlockMode.Code) str += "{"; // todo: increase scope of Sym?
		for (var i = 0; i < this.children.length; i++) {

			var curNode = this.children[i];

			if(curNode.type === "block" && lastNode && lastNode.type === "block" && !isBlockWithNoNewline(curNode) && !isBlockWithNoNewline(lastNode))
				str += "\n";

			var shouldIndentFirstLine = (i == 0 && doIndentFirstLine);
			var shouldIndentAfterLinebreak = (lastNode && lastNode.type === "function" && lastNode.name === "br");
			if(this.mode === BlockMode.Dialog && (shouldIndentFirstLine || shouldIndentAfterLinebreak))
				str += leadingWhitespace(depth);
			str += curNode.Serialize(depth);
			lastNode = curNode;
		}
		if (this.mode === BlockMode.Code) str += "}";
		return str;
	}

	this.ToString = function() {
		return this.type + " " + this.mode;
	};
}

function isBlockWithNoNewline(node) {
	return isTextEffectBlock(node) || isMultilineListBlock(node);
}

function isTextEffectBlock(node) {
	if(node.type === "block") {
		if(node.children.length > 0 && node.children[0].type === "function") {
			var func = node.children[0];
			if(func.name === "clr1" || func.name === "clr2" || func.name === "clr3" || func.name === "wvy" || func.name === "shk" || func.name === "rbw") {
				return true;
			}
		}
	}
	return false;
}

function isMultilineListBlock(node) {
	if(node.type === "block") {
		if(node.children.length > 0) {
			var child = node.children[0];
			if(child.type === "sequence" || child.type === "cycle" || child.type === "shuffle" || child.type === "if") {
				return true;
			}
		}
	}
	return false;
}

var FuncNode = function(name,arguments) {
	Object.assign( this, new TreeRelationship() );
	// Object.assign( this, new Runnable() );
	this.type = "function";
	this.name = name;
	this.arguments = arguments;

	this.Eval = function(environment,onReturn) {

		if( this.onEnter != null ) this.onEnter();

		// console.log("FUNC");
		// console.log(this.arguments);
		var argumentValues = [];
		var i = 0;
		function evalArgs(arguments,done) {
			if(i < arguments.length) {
				// Evaluate each argument
				arguments[i].Eval( environment, function(val) {
					argumentValues.push( val );
					i++;
					evalArgs(arguments,done);
				} );
			}
			else {
				done();
			}
		};
		var self = this; // hack to deal with scope
		evalArgs( this.arguments, function() {
			// Then evaluate the function
			// console.log("ARGS");
			// console.log(argumentValues);

			if( self.onExit != null ) self.onExit();

			environment.EvalFunction( self.name, argumentValues, onReturn );
		} );
	}

	this.Serialize = function(depth) {
		var isDialogBlock = this.parent.mode && this.parent.mode === BlockMode.Dialog;
		if(isDialogBlock && this.name === "print") {
			// TODO this could cause problems with "real" print functions
			return this.arguments[0].value; // first argument should be the text of the {print} func
		}
		else if(isDialogBlock && this.name === "br") {
			return "\n";
		}
		else {
			var str = "";
			str += this.name;
			for(var i = 0; i < this.arguments.length; i++) {
				str += " ";
				str += this.arguments[i].Serialize(depth);
			}
			return str;
		}
	}

	this.ToString = function() {
		return this.type + " " + this.name;
	};
}

var LiteralNode = function(value) {
	Object.assign( this, new TreeRelationship() );
	// Object.assign( this, new Runnable() );
	this.type = "literal";
	this.value = value;

	this.Eval = function(environment,onReturn) {
		onReturn(this.value);
	}

	this.Serialize = function(depth) {
		var str = "";

		if(this.value === null)
			return str;

		if(typeof this.value === "string") str += '"';
		str += this.value;
		if(typeof this.value === "string") str += '"';

		return str;
	}

	this.ToString = function() {
		return this.type + " " + this.value;
	};
}

var VarNode = function(name) {
	Object.assign( this, new TreeRelationship() );
	// Object.assign( this, new Runnable() );
	this.type = "variable";
	this.name = name;

	this.Eval = function(environment,onReturn) {
		// console.log("EVAL " + this.name + " " + environment.HasVariable(this.name) + " " + environment.GetVariable(this.name));
		if( environment.HasVariable(this.name) )
			onReturn( environment.GetVariable( this.name ) );
		else
			onReturn(null); // not a valid variable -- return null and hope that's ok
	} // TODO: might want to store nodes in the variableMap instead of values???

	this.Serialize = function(depth) {
		var str = "" + this.name;
		return str;
	}

	this.ToString = function() {
		return this.type + " " + this.name;
	};
}

var ExpNode = function(operator, left, right) {
	Object.assign( this, new TreeRelationship() );
	this.type = "operator";
	this.operator = operator;
	this.left = left;
	this.right = right;

	this.Eval = function(environment,onReturn) {
		// console.log("EVAL " + this.operator);
		var self = this; // hack to deal with scope
		environment.EvalOperator( this.operator, this.left, this.right, 
			function(val){
				// console.log("EVAL EXP " + self.operator + " " + val);
				onReturn(val);
			} );
		// NOTE : sadly this pushes a lot of complexity down onto the actual operator methods
	}

	this.Serialize = function(depth) {
		var isNegativeNumber = this.operator === "-" && this.left.type === "literal" && this.left.value === null;

		if(!isNegativeNumber) {
			var str = "";
			str += this.left.Serialize(depth);
			str += " " + this.operator + " ";
			str += this.right.Serialize(depth);
			return str;
		}
		else {
			return this.operator + this.right.Serialize(depth); // hacky but seems to work
		}
	}

	this.VisitAll = function(visitor, depth) {
		if (depth == undefined || depth == null) {
			depth = 0;
		}

		visitor.Visit( this, depth );
		if(this.left != null)
			this.left.VisitAll( visitor, depth + 1 );
		if(this.right != null)
			this.right.VisitAll( visitor, depth + 1 );
	};

	this.ToString = function() {
		return this.type + " " + this.operator;
	};
}

var SequenceBase = function() {
	this.Serialize = function(depth) {
		var str = "";
		str += this.type + "\n";
		for (var i = 0; i < this.options.length; i++) {
			// console.log("SERIALIZE SEQUENCE ");
			// console.log(depth);
			str += leadingWhitespace(depth + 1) + Sym.List + " " + this.options[i].Serialize(depth + 2) + "\n";
		}
		str += leadingWhitespace(depth);
		return str;
	}

	this.VisitAll = function(visitor, depth) {
		if (depth == undefined || depth == null) {
			depth = 0;
		}

		visitor.Visit( this, depth );
		for( var i = 0; i < this.options.length; i++ ) {
			this.options[i].VisitAll( visitor, depth + 1 );
		}
	};

	this.ToString = function() {
		return this.type;
	};
}

var SequenceNode = function(options) {
	Object.assign( this, new TreeRelationship() );
	Object.assign( this, new SequenceBase() );
	this.type = "sequence";
	this.options = options;

	var index = 0;
	this.Eval = function(environment,onReturn) {
		// console.log("SEQUENCE " + index);
		this.options[index].Eval( environment, onReturn );

		var next = index + 1;
		if(next < this.options.length)
			index = next;
	}
}

var CycleNode = function(options) {
	Object.assign( this, new TreeRelationship() );
	Object.assign( this, new SequenceBase() );
	this.type = "cycle";
	this.options = options;

	var index = 0;
	this.Eval = function(environment,onReturn) {
		// console.log("CYCLE " + index);
		this.options[index].Eval( environment, onReturn );

		var next = index + 1;
		if(next < this.options.length)
			index = next;
		else
			index = 0;
	}
}

var ShuffleNode = function(options) {
	Object.assign( this, new TreeRelationship() );
	Object.assign( this, new SequenceBase() );
	this.type = "shuffle";
	this.options = options;

	var optionsShuffled = [];
	function shuffle(options) {
		optionsShuffled = [];
		var optionsUnshuffled = options.slice();
		while(optionsUnshuffled.length > 0) {
			var i = Math.floor( Math.random() * optionsUnshuffled.length );
			optionsShuffled.push( optionsUnshuffled.splice(i,1)[0] );
		}
	}
	shuffle(this.options);

	var index = 0;
	this.Eval = function(environment,onReturn) {
		// OLD RANDOM VERSION
		// var index = Math.floor(Math.random() * this.options.length);
		// this.options[index].Eval( environment, onReturn );

		optionsShuffled[index].Eval( environment, onReturn );
		
		index++;
		if (index >= this.options.length) {
			shuffle(this.options);
			index = 0;
		}
	}
}

var IfNode = function(conditions, results, isSingleLine) {
	Object.assign( this, new TreeRelationship() );
	this.type = "if";
	this.conditions = conditions;
	this.results = results;

	this.Eval = function(environment,onReturn) {
		// console.log("EVAL IF");
		var i = 0;
		var self = this;
		function TestCondition() {
			// console.log("EVAL " + i);
			self.conditions[i].Eval(environment, function(val) {
				// console.log(val);
				if(val == true) {
					self.results[i].Eval(environment, onReturn);
				}
				else if(i+1 < self.conditions.length) {
					i++;
					TestCondition(); // test next condition
				}
				else {
					onReturn(null); // out of conditions and none were true
				}
			});
		};
		TestCondition();
	}

	if(isSingleLine === undefined) isSingleLine = false; // This is just for serialization

	this.Serialize = function(depth) {
		var str = "";
		if(isSingleLine) {
			str += this.conditions[0].Serialize() + " ? " + this.results[0].Serialize();
			if(this.conditions.length > 1 && this.conditions[1].type === "else")
				str += " : " + this.results[1].Serialize();
		}
		else {
			str += "\n";
			for (var i = 0; i < this.conditions.length; i++) {
				str += leadingWhitespace(depth + 1) + Sym.List + " " + this.conditions[i].Serialize(depth) + " ?\n";
				str += this.results[i].Serialize(depth + 2) + "\n";
			}
			str += leadingWhitespace(depth);
		}
		return str;
	}

	this.IsSingleLine = function() {
		return isSingleLine;
	}

	this.VisitAll = function(visitor, depth) {
		if (depth == undefined || depth == null) {
			depth = 0;
		}

		visitor.Visit( this, depth );
		for( var i = 0; i < this.conditions.length; i++ ) {
			this.conditions[i].VisitAll( visitor, depth + 1 );
		}
		for( var i = 0; i < this.results.length; i++ ) {
			this.results[i].VisitAll( visitor, depth + 1 );
		}
	};

	this.ToString = function() {
		return this.type + " " + this.mode;
	};
}

var ElseNode = function() {
	Object.assign( this, new TreeRelationship() );
	this.type = "else";

	this.Eval = function(environment,onReturn) {
		onReturn(true);
	}

	this.Serialize = function() {
		return "else";
	}

	this.ToString = function() {
		return this.type + " " + this.mode;
	};
}

var Sym = {
	// DialogOpen : "/\"",
	// DialogClose : "\"/",
	DialogOpen : '"""',
	DialogClose : '"""',
	CodeOpen : "{",
	CodeClose : "}",
	Linebreak : "\n", // just call it "break" ?
	Separator : ":",
	List : "-",
	String : '"'
};

var Parser = function(env) {
	var environment = env;

	this.Parse = function(scriptStr) {
		// console.log("NEW PARSE!!!!!!");

		// TODO : make this work for single-line, no dialog block scripts

		var state = new ParserState( new BlockNode(BlockMode.Dialog), scriptStr );

		if( state.MatchAhead(Sym.DialogOpen) ) {
			// multi-line dialog block
			var dialogStr = state.ConsumeBlock( Sym.DialogOpen, Sym.DialogClose );
			state = new ParserState( new BlockNode(BlockMode.Dialog), dialogStr );
			state = ParseDialog( state );
		}
		// else if( state.MatchAhead(Sym.CodeOpen) ) { // NOTE: This causes problems when you lead with a code block
		// 	// code-block: should this ever happen?
		// 	state = ParseCodeBlock( state );
		// }
		else {
			// single-line dialog block
			state = ParseDialog( state );
		}

		// console.log( state.rootNode );
		return state.rootNode;
	};

	var ParserState = function( rootNode, str ) {
		this.rootNode = rootNode;
		this.curNode = this.rootNode;

		var sourceStr = str;
		var i = 0;
		this.Index = function() { return i; };
		this.Count = function() { return sourceStr.length; };
		this.Done = function() { return i >= sourceStr.length; };
		this.Char = function() { return sourceStr[i]; };
		this.Step = function(n) { if(n===undefined) n=1; i += n; };
		this.MatchAhead = function(str) {
			// console.log(str);
			str = "" + str; // hack to turn single chars into strings
			// console.log(str);
			// console.log(str.length);
			for(var j = 0; j < str.length; j++) {
				if( i + j >= sourceStr.length )
					return false;
				else if( str[j] != sourceStr[i+j] )
					return false;
			}
			return true;
		}
		this.Peak = function(end) {
			var str = "";
			var j = i;
			// console.log(j);
			while(j < sourceStr.length && end.indexOf( sourceStr[j] ) == -1 ) {
				str += sourceStr[j];
				j++;
			}
			// console.log("PEAK ::" + str + "::");
			return str;
		}
		this.ConsumeBlock = function( open, close ) {
			var startIndex = i;

			var matchCount = 0;
			if( this.MatchAhead( open ) ) {
				matchCount++;
				this.Step( open.length );
			}

			while( matchCount > 0 && !this.Done() ) {
				if( this.MatchAhead( close ) ) {
					matchCount--;
					this.Step( close.length );
				}
				else if( this.MatchAhead( open ) ) {
					matchCount++;
					this.Step( open.length );
				}
				else {
					this.Step();
				}
			}

			// console.log("!!! " + startIndex + " " + i);

			return sourceStr.slice( startIndex + open.length, i - close.length );
		}
		this.Print = function() { console.log(sourceStr); };
		this.Source = function() { return sourceStr; };
	};

	function ParseDialog(state) {
		// console.log("PARSE DIALOG");
		state.Print();

		// for linebreak logic: add linebreaks after lines with dialog or empty lines (if it's not the very first line)
		var hasBlock = false;
		var hasDialog = false;
		var isFirstLine = true;

		// console.log("---- PARSE DIALOG ----");

		var text = "";
		var addTextNode = function() {
			// console.log("TEXT " + text.length);
			if (text.length > 0) {
				// console.log("TEXT " + text);
				// console.log("text!!");
				// console.log([text]);

				state.curNode.AddChild( new FuncNode( "print", [new LiteralNode(text)] ) );
				text = "";

				hasDialog = true;
			}
		}

		while ( !state.Done() ) {

			if( state.MatchAhead(Sym.CodeOpen) ) {
				addTextNode();
				state = ParseCodeBlock( state );

				// console.log("CODE");

				var len = state.curNode.children.length;
				if(len > 0 && state.curNode.children[len-1].type === "block") {
					var block = state.curNode.children[len-1];
					if(isMultilineListBlock(block))
						hasDialog = true; // hack to get correct newline behavior for multiline blocks
				}

				hasBlock = true;
			}
			// NOTE: nested dialog blocks disabled for now
			// else if( state.MatchAhead(Sym.DialogOpen) ) {
			// 	addTextNode();
			// 	state = ParseDialogBlock( state ); // These can be nested (should they though???)

			// 	hasBlock = true;
			// }
			else {
				if ( state.MatchAhead(Sym.Linebreak) ) {
					addTextNode();

					/*
					NOTES:
					linebreaks SHOULD happen on
					- lines with text (including the first or last line)
					- empty lines (that are NOT the first or last line)
					linebreaks should NOT happen on
					- lines with only CODE blocks
					- empty FIRST or LAST lines

					also, apparently:
					- NEVER line break on the last line
					*/
					var isLastLine = (state.Index() + 1) == state.Count();
					// console.log("block " + hasBlock);
					// console.log("dialog " + hasDialog);
					var isEmptyLine = !hasBlock && !hasDialog;
					// console.log("empty " + isEmptyLine);
					var isValidEmptyLine = isEmptyLine && !(isFirstLine || isLastLine);
					// console.log("valid empty " + isValidEmptyLine);
					var shouldAddLinebreak = (hasDialog || isValidEmptyLine) && !isLastLine; // last clause is a hack (but it works - why?)
					// console.log("LINEBREAK? " + shouldAddLinebreak);
					if( shouldAddLinebreak ) {
						// console.log("NEWLINE");
						// console.log("empty? " + isEmptyLine);
						// console.log("dialog? " + hasDialog);
						state.curNode.AddChild( new FuncNode( "br", [] ) ); // use function or character?
					}

					// linebreak logic
					isFirstLine = false;
					hasBlock = false;
					hasDialog = false;

					text = "";
				}
				else {
					text += state.Char();
				}
				state.Step();
			}

		}
		addTextNode();

		// console.log("---- PARSE DIALOG ----");

		// console.log(state);
		return state;
	}

	function ParseDialogBlock(state) {
		var dialogStr = state.ConsumeBlock( Sym.DialogOpen, Sym.DialogClose );

		var dialogState = new ParserState( new BlockNode(BlockMode.Dialog), dialogStr );
		dialogState = ParseDialog( dialogState );

		state.curNode.AddChild( dialogState.rootNode );

		return state;
	}

	function ParseIf(state) {
		var conditionStrings = [];
		var resultStrings = [];
		var curIndex = -1;
		var isNewline = true;
		var isConditionDone = false;
		var codeBlockCount = 0;

		while( !state.Done() ) {
			if(state.Char() === Sym.CodeOpen)
				codeBlockCount++;
			else if(state.Char() === Sym.CodeClose)
				codeBlockCount--;

			var isWhitespace = (state.Char() === " " || state.Char() === "\t");
			var isSkippableWhitespace = isNewline && isWhitespace;
			var isNewListItem = isNewline && (codeBlockCount <= 0) && (state.Char() === Sym.List);

			if(isNewListItem) {
				curIndex++;
				isConditionDone = false;
				conditionStrings[curIndex] = "";
				resultStrings[curIndex] = "";
			}
			else if(curIndex > -1) {
				if(!isConditionDone) {
					if(state.Char() === "?" || state.Char() === "\n") { // TODO: use Sym
						// end of condition
						isConditionDone = true;
					}
					else {
						// read in condition
						conditionStrings[curIndex] += state.Char();
					}
				}
				else {
					// read in result
					if(!isSkippableWhitespace)
						resultStrings[curIndex] += state.Char();
				}
			}

			isNewline = (state.Char() === Sym.Linebreak) || isSkippableWhitespace || isNewListItem;

			state.Step();
		}

		// console.log("PARSE IF:");
		// console.log(conditionStrings);
		// console.log(resultStrings);

		var conditions = [];
		for(var i = 0; i < conditionStrings.length; i++) {
			var str = conditionStrings[i].trim();
			if(str === "else") {
				conditions.push( new ElseNode() );
			}
			else {
				var exp = CreateExpression( str );
				conditions.push( exp );
			}
		}

		var results = [];
		for(var i = 0; i < resultStrings.length; i++) {
			var str = resultStrings[i];
			var dialogBlockState = new ParserState( new BlockNode(BlockMode.Dialog), str );
			dialogBlockState = ParseDialog( dialogBlockState );
			var dialogBlock = dialogBlockState.rootNode;
			results.push( dialogBlock );
		}

		state.curNode.AddChild( new IfNode( conditions, results ) );

		return state;
	}

	function IsSequence(str) {
		// console.log("IsSequence? " + str);
		return str === "sequence" || str === "cycle" || str === "shuffle";
	}

	// TODO: don't forget about eating whitespace
	function ParseSequence(state, sequenceType) {
		// console.log("SEQUENCE " + sequenceType);
		state.Print();

		var isNewline = false;
		var itemStrings = [];
		var curItemIndex = -1; // -1 indicates not reading an item yet
		var codeBlockCount = 0;

		while( !state.Done() ) {
			if(state.Char() === Sym.CodeOpen)
				codeBlockCount++;
			else if(state.Char() === Sym.CodeClose)
				codeBlockCount--;

			var isWhitespace = (state.Char() === " " || state.Char() === "\t");
			var isSkippableWhitespace = isNewline && isWhitespace;
			var isNewListItem = isNewline && (codeBlockCount <= 0) && (state.Char() === Sym.List);

			if(isNewListItem) {
				// console.log("found next list item");
				curItemIndex++;
				itemStrings[curItemIndex] = "";
			}
			else if(curItemIndex > -1) {
				if(!isSkippableWhitespace)
					itemStrings[curItemIndex] += state.Char();
			}

			isNewline = (state.Char() === Sym.Linebreak) || isSkippableWhitespace || isNewListItem;

			// console.log(state.Char());
			state.Step();
		}
		// console.log(itemStrings);
		// console.log("SEQUENCE DONE");

		var options = [];
		for(var i = 0; i < itemStrings.length; i++) {
			var str = itemStrings[i];
			var dialogBlockState = new ParserState( new BlockNode( BlockMode.Dialog, false /* doIndentFirstLine */ ), str );
			dialogBlockState = ParseDialog( dialogBlockState );
			var dialogBlock = dialogBlockState.rootNode;
			options.push( dialogBlock );
		}

		// console.log(options);

		if(sequenceType === "sequence")
			state.curNode.AddChild( new SequenceNode( options ) );
		else if(sequenceType === "cycle")
			state.curNode.AddChild( new CycleNode( options ) );
		else if(sequenceType === "shuffle")
			state.curNode.AddChild( new ShuffleNode( options ) );

		return state;
	}

	function ParseFunction(state, funcName) {
		console.log("~~~ PARSE FUNCTION " + funcName);

		var args = [];

		var curSymbol = "";
		function OnSymbolEnd() {
			curSymbol = curSymbol.trim();
			// console.log("PARAMTER " + curSymbol);
			args.push( StringToValue(curSymbol) );
			// console.log(args);
			curSymbol = "";
		}

		while( !( state.Char() === "\n" || state.Done() ) ) {
			if( state.MatchAhead(Sym.CodeOpen) ) {
				var codeBlockState = new ParserState( new BlockNode(BlockMode.Code), state.ConsumeBlock( Sym.CodeOpen, Sym.CodeClose ) );
				codeBlockState = ParseCode( codeBlockState );
				var codeBlock = codeBlockState.rootNode;
				args.push( codeBlock );
				curSymbol = "";
			}
			else if( state.MatchAhead(Sym.String) ) {
				/* STRING LITERAL */
				var str = state.ConsumeBlock(Sym.String, Sym.String);
				// console.log("STRING " + str);
				args.push( new LiteralNode(str) );
				curSymbol = "";
			}
			else if(state.Char() === " " && curSymbol.length > 0) {
				OnSymbolEnd();
			}
			else {
				curSymbol += state.Char();
			}
			state.Step();
		}

		if(curSymbol.length > 0) {
			OnSymbolEnd();
		}

		state.curNode.AddChild( new FuncNode( funcName, args ) );

		return state;
	}

	function IsValidVariableName(str) {
		var reg = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;
		var isValid = reg.test(str);
		// console.log("VALID variable??? " + isValid);
		return isValid;
	}

	function StringToValue(valStr) {
		if(valStr[0] === Sym.CodeOpen) {
			// CODE BLOCK!!!
			var codeStr = (new ParserState( null, valStr )).ConsumeBlock(Sym.CodeOpen, Sym.CodeClose); //hacky
			var codeBlockState = new ParserState( new BlockNode( BlockMode.Code ), codeStr );
			codeBlockState = ParseCode( codeBlockState );
			return codeBlockState.rootNode;
		}
		else if(valStr[0] === Sym.String) {
			// STRING!!
			// console.log("STRING");
			var str = "";
			var i = 1;
			while (i < valStr.length && valStr[i] != Sym.String) {
				str += valStr[i];
				i++;
			}
			// console.log(str);
			return new LiteralNode( str );
		}
		else if(valStr === "true") {
			// BOOL
			return new LiteralNode( true );
		}
		else if(valStr === "false") {
			// BOOL
			return new LiteralNode( false );
		}
		else if( !isNaN(parseFloat(valStr)) ) {
			// NUMBER!!
			// console.log("NUMBER!!! " + valStr);
			return new LiteralNode( parseFloat(valStr) );
		}
		else if(IsValidVariableName(valStr)) {
			// VARIABLE!!
			// console.log("VARIABLE");
			return new VarNode(valStr); // TODO : check for valid potential variables
		}
		else {
			// uh oh
			return new LiteralNode(null);
		}
	}

	var setSymbol = "=";
	var ifSymbol = "?";
	var elseSymbol = ":";
	var operatorSymbols = ["==", ">", "<", ">=", "<=", "-", "+", "/", "*"]; // operators need to be in reverse order of precedence
	function CreateExpression(expStr) {
		console.log("CREATE EXPRESSION --- " + expStr);

		expStr = expStr.trim();

		function IsInsideString(index) {
			var inString = false;
			for(var i = 0; i < expStr.length; i++) {
				if(expStr[i] === Sym.String)
					inString = !inString;

				if(index === i)
					return inString;
			}
			return false;
		}

		function IsInsideCode(index) {
			var count = 0;
			for(var i = 0; i < expStr.length; i++) {
				if(expStr[i] === Sym.CodeOpen)
					count++;
				else if(expStr[i] === Sym.CodeClose)
					count--;

				if(index === i)
					return count > 0;
			}
			return false;
		}

		var operator = null;

		// set is special because other operator can look like it, and it has to go first in the order of operations
		var setIndex = expStr.indexOf(setSymbol);
		if( setIndex > -1 && !IsInsideString(setIndex) && !IsInsideCode(setIndex) ) { // it might be a set operator
			if( expStr[setIndex+1] != "=" && expStr[setIndex-1] != ">" && expStr[setIndex-1] != "<" ) {
				// ok it actually IS a set operator and not ==, >=, or <=
				operator = setSymbol;
				var variableName = expStr.substring(0,setIndex).trim(); // TODO : valid variable name testing
				var left = IsValidVariableName(variableName) ? new VarNode( variableName ) : new LiteralNode(null);
				var right = CreateExpression( expStr.substring(setIndex+setSymbol.length) );
				var exp = new ExpNode( operator, left, right );
				return exp;
			}
		}

		// special if "expression" for single-line if statements
		var ifIndex = expStr.indexOf(ifSymbol);
		if( ifIndex > -1 && !IsInsideString(ifIndex) && !IsInsideCode(ifIndex) ) {
			operator = ifSymbol;
			var conditionStr = expStr.substring(0,ifIndex).trim();
			var conditions = [ CreateExpression(conditionStr) ];

			var resultStr = expStr.substring(ifIndex+ifSymbol.length);
			var results = [];
			function AddResult(str) {
				var dialogBlockState = new ParserState( new BlockNode(BlockMode.Dialog), str );
				dialogBlockState = ParseDialog( dialogBlockState );
				var dialogBlock = dialogBlockState.rootNode;
				results.push( dialogBlock );
			}

			var elseIndex = resultStr.indexOf(elseSymbol); // does this need to test for strings?
			if(elseIndex > -1) {
				conditions.push( new ElseNode() );

				var elseStr = resultStr.substring(elseIndex+elseSymbol.length);
				var resultStr = resultStr.substring(0,elseIndex);

				AddResult( resultStr.trim() );
				AddResult( elseStr.trim() );
			}
			else {
				AddResult( resultStr.trim() );
			}

			return new IfNode( conditions, results, true /*isSingleLine*/ );
		}

		for( var i = 0; (operator == null) && (i < operatorSymbols.length); i++ ) {
			var opSym = operatorSymbols[i];
			var opIndex = expStr.indexOf( opSym );
			if( opIndex > -1 && !IsInsideString(opIndex) && !IsInsideCode(opIndex) ) {
				operator = opSym;
				var left = CreateExpression( expStr.substring(0,opIndex) );
				var right = CreateExpression( expStr.substring(opIndex+opSym.length) );
				var exp = new ExpNode( operator, left, right );
				return exp;
			}
		}

		if( operator == null ) {
			return StringToValue(expStr);
		}
	}
	this.CreateExpression = CreateExpression;

	function IsWhitespace(str) {
		return ( str === " " || str === "\t" || str === "\n" );
	}

	function IsExpression(str) {
		var tempState = new ParserState(null, str); // hacky
		var nonWhitespaceCount = 0;

		while (!tempState.Done()) {
			if( IsWhitespace(tempState.Char()) ) {
				tempState.Step(); // consume whitespace
			}
			else if( tempState.MatchAhead(Sym.CodeOpen) ) {
				tempState.ConsumeBlock( Sym.CodeOpen, Sym.CodeClose );
			}
			else {
				nonWhitespaceCount++;
				tempState.Step();
			}
		}

		var isExpression = nonWhitespaceCount > 0;
		return isExpression;
	}

	function ParseExpression(state) {
		var line = state.Source(); // state.Peak( [Sym.Linebreak] ); // TODO : remove the linebreak thing
		// console.log("EXPRESSION " + line);
		var exp = CreateExpression( line );
		// console.log(exp);
		state.curNode.AddChild( exp );
		state.Step( line.length );
		return state;
	}

	function ParseCode(state) {
		console.log("PARSE CODE --- " + state.Source());

		// skip leading whitespace
		while (IsWhitespace(state.Char())) {
			state.Step();
		}

		if( state.Char() === Sym.List && (state.Peak([]).indexOf("?") > -1) ) { // TODO : symbols? matchahead?
			// console.log("PEAK IF " + state.Peak( ["?"] ));
			state = ParseIf( state );
		}
		else if( environment.HasFunction( state.Peak( [" "] ) ) ) { // TODO --- what about newlines???
			var funcName = state.Peak( [" "] );
			state.Step( funcName.length );
			state = ParseFunction( state, funcName );
		}
		else if( IsSequence( state.Peak( [" ", Sym.Linebreak] ) ) ) {
			var sequenceType = state.Peak( [" ", Sym.Linebreak] );
			state.Step( sequenceType.length );
			state = ParseSequence( state, sequenceType );
		}
		else if (IsExpression(state.Source())) {
			state = ParseExpression(state);
		}
		else {
			// multi-line code block
			while (!state.Done()) {
				if( state.MatchAhead(Sym.CodeOpen) ) {
					state = ParseCodeBlock( state );
				}
				else {
					state.Step();
				}
			}
		}

		// just go to the end now
		while (!state.Done()) {
			state.Step();
		}

		return state;
	}

	function ParseCodeBlock(state) {
		var codeStr = state.ConsumeBlock( Sym.CodeOpen, Sym.CodeClose );

		// console.log("PARSE CODE");
		// console.log(codeStr);

		var codeState = new ParserState( new BlockNode(BlockMode.Code), codeStr );
		codeState = ParseCode( codeState );
		
		state.curNode.AddChild( codeState.rootNode );

		return state;
	}

}

} // Script()
</script>

<script>
function Dialog() {

this.CreateRenderer = function() {
	return new DialogRenderer();
};

this.CreateBuffer = function() {
	return new DialogBuffer();
};

var DialogRenderer = function() {

	// TODO : refactor this eventually? remove everything from struct.. avoid the defaults?
	var textboxInfo = {
		img : null,
		width : 104,
		height : 8+4+2+5, //8 for text, 4 for top-bottom padding, 2 for line padding, 5 for arrow
		top : 12,
		left : 12,
		bottom : 12, //for drawing it from the bottom
		font_scale : 0.5, // we draw font at half-size compared to everything else
		padding_vert : 2,
		padding_horz : 4,
		arrow_height : 5,
	};

	var font = null;
	this.SetFont = function(f) {
		font = f;
		textboxInfo.height = (textboxInfo.padding_vert * 3) + (relativeFontHeight() * 2) + textboxInfo.arrow_height;
		textboxInfo.img = context.createImageData(textboxInfo.width*scale, textboxInfo.height*scale);
	}

	function textScale() {
		return scale * textboxInfo.font_scale;
	}

	function relativeFontWidth() {
		return Math.ceil( font.getWidth() * textboxInfo.font_scale );
	}

	function relativeFontHeight() {
		return Math.ceil( font.getHeight() * textboxInfo.font_scale );
	}

	var context = null;
	this.AttachContext = function(c) {
		context = c;
	};

	this.ClearTextbox = function() {
		if(context == null) return;

		//create new image none exists
		if(textboxInfo.img == null)
			textboxInfo.img = context.createImageData(textboxInfo.width*scale, textboxInfo.height*scale);

		// fill text box with black
		for (var i=0;i<textboxInfo.img.data.length;i+=4)
		{
			textboxInfo.img.data[i+0]=0;
			textboxInfo.img.data[i+1]=0;
			textboxInfo.img.data[i+2]=0;
			textboxInfo.img.data[i+3]=255;
		}
	};

	var isCentered = false;
	this.SetCentered = function(centered) {
		isCentered = centered;
	};

	this.DrawTextbox = function() {
		if(context == null) return;
		if (isCentered) {
			context.putImageData(textboxInfo.img, textboxInfo.left*scale, ((height/2)-(textboxInfo.height/2))*scale);
		}
		else if (player().y < mapsize/2) {
			//bottom
			context.putImageData(textboxInfo.img, textboxInfo.left*scale, (height-textboxInfo.bottom-textboxInfo.height)*scale);
		}
		else {
			//top
			context.putImageData(textboxInfo.img, textboxInfo.left*scale, textboxInfo.top*scale);
		}
	};

	var arrowdata = [
		1,1,1,1,1,
		0,1,1,1,0,
		0,0,1,0,0
	];
	this.DrawNextArrow = function() {
		// console.log("draw arrow!");
		var top = (textboxInfo.height-5) * scale;
		var left = (textboxInfo.width-(5+4)) * scale;
		if (textDirection === TextDirection.RightToLeft) { // RTL hack
			left = 4 * scale;
		}

		for (var y = 0; y < 3; y++) {
			for (var x = 0; x < 5; x++) {
				var i = (y * 5) + x;
				if (arrowdata[i] == 1) {
					//scaling nonsense
					for (var sy = 0; sy < scale; sy++) {
						for (var sx = 0; sx < scale; sx++) {
							var pxl = 4 * ( ((top+(y*scale)+sy) * (textboxInfo.width*scale)) + (left+(x*scale)+sx) );
							textboxInfo.img.data[pxl+0] = 255;
							textboxInfo.img.data[pxl+1] = 255;
							textboxInfo.img.data[pxl+2] = 255;
							textboxInfo.img.data[pxl+3] = 255;
						}
					}
				}
			}
		}
	};

	var text_scale = 2; //using a different scaling factor for text feels like cheating... but it looks better
	this.DrawChar = function(char, row, col, leftPos) {
		char.offset = {
			x: char.base_offset.x,
			y: char.base_offset.y
		}; // compute render offset *every* frame

		char.SetPosition(row,col);
		char.ApplyEffects(effectTime);

		var charData = char.bitmap;

		var top = (4 * scale) + (row * 2 * scale) + (row * font.getHeight() * text_scale) + Math.floor( char.offset.y );
		var left = (4 * scale) + (leftPos * text_scale) + Math.floor( char.offset.x );

		var debug_r = Math.random() * 255;

		for (var y = 0; y < char.height; y++) {
			for (var x = 0; x < char.width; x++) {

				var i = (y * char.width) + x;
				if ( charData[i] == 1 ) {

					//scaling nonsense
					for (var sy = 0; sy < text_scale; sy++) {
						for (var sx = 0; sx < text_scale; sx++) {
							var pxl = 4 * ( ((top+(y*text_scale)+sy) * (textboxInfo.width*scale)) + (left+(x*text_scale)+sx) );
							textboxInfo.img.data[pxl+0] = char.color.r;
							textboxInfo.img.data[pxl+1] = char.color.g;
							textboxInfo.img.data[pxl+2] = char.color.b;
							textboxInfo.img.data[pxl+3] = char.color.a;
						}
					}
				}
				// else {
				// 	// DEBUG

				// 	//scaling nonsense
				// 	for (var sy = 0; sy < text_scale; sy++) {
				// 		for (var sx = 0; sx < text_scale; sx++) {
				// 			var pxl = 4 * ( ((top+(y*text_scale)+sy) * (textboxInfo.width*scale)) + (left+(x*text_scale)+sx) );
				// 			textboxInfo.img.data[pxl+0] = debug_r;
				// 			textboxInfo.img.data[pxl+1] = 0;
				// 			textboxInfo.img.data[pxl+2] = 0;
				// 			textboxInfo.img.data[pxl+3] = 255;
				// 		}
				// 	}
				// }

			}
		}
		
		// call printHandler for character
		char.OnPrint();
	};

	var effectTime = 0; // TODO this variable should live somewhere better
	this.Draw = function(buffer,dt) {
		effectTime += dt;

		this.ClearTextbox();

		buffer.ForEachActiveChar( this.DrawChar );

		if( buffer.CanContinue() )
			this.DrawNextArrow();

		this.DrawTextbox();

		if( buffer.DidPageFinishThisFrame() && onPageFinish != null )
			onPageFinish();
	};

	/* this is a hook for GIF rendering */
	var onPageFinish = null;
	this.SetPageFinishHandler = function(handler) {
		onPageFinish = handler;
	};

	this.Reset = function() {
		effectTime = 0;
		// TODO - anything else?
	}

	// this.CharsPerRow = function() {
	// 	return textboxInfo.charsPerRow;
	// }
}


var DialogBuffer = function() {
	var buffer = [[[]]]; // holds dialog in an array buffer
	var pageIndex = 0;
	var rowIndex = 0;
	var charIndex = 0;
	var nextCharTimer = 0;
	var nextCharMaxTime = 50; // in milliseconds
	var isDialogReadyToContinue = false;
	var activeTextEffects = [];
	var font = null;
	var arabicHandler = new ArabicHandler();
	var onDialogEndCallbacks = [];

	this.SetFont = function(f) {
		font = f;
	}

	this.CurPage = function() { return buffer[ pageIndex ]; };
	this.CurRow = function() { return this.CurPage()[ rowIndex ]; };
	this.CurChar = function() { return this.CurRow()[ charIndex ]; };
	this.CurPageCount = function() { return buffer.length; };
	this.CurRowCount = function() { return this.CurPage().length; };
	this.CurCharCount = function() { return this.CurRow().length; };

	this.ForEachActiveChar = function(handler) { // Iterates over visible characters on the active page
		var rowCount = rowIndex + 1;
		for (var i = 0; i < rowCount; i++) {
			var row = this.CurPage()[i];
			var charCount = (i == rowIndex) ? charIndex+1 : row.length;
			// console.log(charCount);

			var leftPos = 0;
			if (textDirection === TextDirection.RightToLeft) {
				leftPos = 24 * 8; // hack -- I think this is correct?
			}

			for(var j = 0; j < charCount; j++) {
				var char = row[j];
				if(char) {
					if (textDirection === TextDirection.RightToLeft) {
						leftPos -= char.spacing;
					}
					// console.log(j + " " + leftPos);

					// handler( char, i /*rowIndex*/, j /*colIndex*/ );
					handler(char, i /*rowIndex*/, j /*colIndex*/, leftPos)

					if (textDirection === TextDirection.LeftToRight) {
						leftPos += char.spacing;
					}
				}
			}
		}
	}

	this.Reset = function() {
		buffer = [[[]]];
		pageIndex = 0;
		rowIndex = 0;
		charIndex = 0;
		isDialogReadyToContinue = false;

		activeTextEffects = [];

		onDialogEndCallbacks = [];

		isActive = false;
	};

	this.DoNextChar = function() {
		// console.log("DO NEXT CHAR");

		nextCharTimer = 0; //reset timer

		//time to update characters
		if (charIndex + 1 < this.CurCharCount()) {
			//add char to current row
			charIndex++;
		}
		else if (rowIndex + 1 < this.CurRowCount()) {
			//start next row
			rowIndex++;
			charIndex = 0;
		}
		else {
			//the page is full!
			isDialogReadyToContinue = true;
			didPageFinishThisFrame = true;

			// console.log("WAITING FOR INPUT");
		}

		// console.log(this.CurChar());
		if(this.CurChar() != null)
			this.CurChar().OnPrint(); // make sure we hit the callback before we run out of text
	};

	this.Update = function(dt) {
		didPageFinishThisFrame = false;
		didFlipPageThisFrame = false;
		// this.Draw(dt); // TODO move into a renderer object
		if (isDialogReadyToContinue) {
			return; //waiting for dialog to be advanced by player
		}

		nextCharTimer += dt; //tick timer

		if (nextCharTimer > nextCharMaxTime) {
			this.DoNextChar();
		}
	};

	this.Skip = function() {
		console.log("SKIPPP");
		didPageFinishThisFrame = false;
		didFlipPageThisFrame = false;
		// add new characters until you get to the end of the current line of dialog
		while (rowIndex < this.CurRowCount()) {
			this.DoNextChar();

			if(isDialogReadyToContinue) {
				//make sure to push the rowIndex past the end to break out of the loop
				rowIndex++;
				charIndex = 0;
			}
		}
		rowIndex = this.CurRowCount()-1;
		charIndex = this.CurCharCount()-1;
	};

	this.FlipPage = function() {
		didFlipPageThisFrame = true;
		isDialogReadyToContinue = false;
		pageIndex++;
		rowIndex = 0;
		charIndex = 0;
	}

	this.EndDialog = function() {
		isActive = false; // no more text to show... this should be a sign to stop rendering dialog

		for (var i = 0; i < onDialogEndCallbacks.length; i++) {
			onDialogEndCallbacks[i]();
		}
	}

	this.Continue = function() {
		console.log("CONTINUE");
		if (pageIndex + 1 < this.CurPageCount()) {
			//start next page
			this.FlipPage();
			return true; /* hasMoreDialog */
		}
		else {
			//end dialog mode
			this.EndDialog();
			return false; /* hasMoreDialog */
		}
	};

	var isActive = false;
	this.IsActive = function() { return isActive; };

	this.OnDialogEnd = function(callback) {
		if (!isActive) {
			callback();
		}
		else {
			onDialogEndCallbacks.push(callback);
		}
	}

	this.CanContinue = function() { return isDialogReadyToContinue; };

	function DialogChar(effectList) {
		this.effectList = effectList.slice(); // clone effect list (since it can change between chars)

		this.color = { r:255, g:255, b:255, a:255 };
		this.offset = { x:0, y:0 }; // in pixels (screen pixels?)

		this.col = 0;
		this.row = 0;

		this.SetPosition = function(row,col) {
			// console.log("SET POS");
			// console.log(this);
			this.row = row;
			this.col = col;
		}

		this.ApplyEffects = function(time) {
			// console.log("APPLY EFFECTS! " + time);
			for(var i = 0; i < this.effectList.length; i++) {
				var effectName = this.effectList[i];
				// console.log("FX " + effectName);
				TextEffects[ effectName ].DoEffect( this, time );
			}
		}

		var printHandler = null; // optional function to be called once on printing character
		this.SetPrintHandler = function(handler) {
			printHandler = handler;
		}
		this.OnPrint = function() {
			if (printHandler != null) {
				console.log("PRINT HANDLER ---- DIALOG BUFFER");
				printHandler();
				printHandler = null; // only call handler once (hacky)
			}
		}

		this.bitmap = [];
		this.width = 0;
		this.height = 0;
		this.base_offset = { // hacky name
 			x: 0,
			y: 0
		};
		this.spacing = 0;
	}

	function DialogFontChar(font, char, effectList) {
		Object.assign(this, new DialogChar(effectList));

		var charData = font.getChar(char);
		this.bitmap = charData.data;
		this.width = charData.width;
		this.height = charData.height;
		this.base_offset.x = charData.offset.x;
		this.base_offset.y = charData.offset.y;
		this.spacing = charData.spacing;
	}

	function DialogDrawingChar(drawingId, effectList) {
		Object.assign(this, new DialogChar(effectList));

		var imageData = renderer.GetImageSource(drawingId)[0];
		var imageDataFlat = [];
		for (var i = 0; i < imageData.length; i++) {
			// console.log(imageData[i]);
			imageDataFlat = imageDataFlat.concat(imageData[i]);
		}

		this.bitmap = imageDataFlat;
		this.width = 8;
		this.height = 8;
		this.spacing = 8;
	}

	function AddWordToCharArray(charArray,word,effectList) {
		for(var i = 0; i < word.length; i++) {
			charArray.push( new DialogFontChar( font, word[i], effectList ) );
		}
		return charArray;
	}

	function GetCharArrayWidth(charArray) {
		var width = 0;
		for(var i = 0; i < charArray.length; i++) {
			width += charArray[i].spacing;
		}
		return width;
	}

	function GetStringWidth(str) {
		var width = 0;
		for (var i = 0; i < str.length; i++) {
			var charData = font.getChar(str[i]);
			width += charData.spacing;
		}
		return width;
	}

	var pixelsPerRow = 192; // hard-coded fun times!!!

	this.AddDrawing = function(drawingId, onFinishHandler) {
		// console.log("DRAWING ID " + drawingId);

		var curPageIndex = buffer.length - 1;
		var curRowIndex = buffer[curPageIndex].length - 1;
		var curRowArr = buffer[curPageIndex][curRowIndex];

		var drawingChar = new DialogDrawingChar(drawingId, activeTextEffects)
		drawingChar.SetPrintHandler( onFinishHandler );

		var rowLength = GetCharArrayWidth(curRowArr);

		// TODO : clean up copy-pasted code here :/
		if (rowLength + drawingChar.spacing  <= pixelsPerRow || rowLength <= 0)
		{
			//stay on same row
			curRowArr.push( drawingChar );
		}
		else if (curRowIndex == 0)
		{
			//start next row
			buffer[ curPageIndex ][ curRowIndex ] = curRowArr;
			buffer[ curPageIndex ].push( [] );
			curRowIndex++;
			curRowArr = buffer[ curPageIndex ][ curRowIndex ];
			curRowArr.push( drawingChar );
		}
		else {
			//start next page
			buffer[ curPageIndex ][ curRowIndex ] = curRowArr;
			buffer.push( [] );
			curPageIndex++;
			buffer[ curPageIndex ].push( [] );
			curRowIndex = 0;
			curRowArr = buffer[ curPageIndex ][ curRowIndex ];
			curRowArr.push( drawingChar );
		}

		isActive = true; // this feels like a bad way to do this???
	}

	// TODO : convert this into something that takes DialogChar arrays
	this.AddText = function(textStr,onFinishHandler) {
		// console.log("ADD TEXT " + textStr);

		//process dialog so it's easier to display
		var words = textStr.split(" ");

		// var curPageIndex = this.CurPageCount() - 1;
		// var curRowIndex = this.CurRowCount() - 1;
		// var curRowArr = this.CurRow();

		var curPageIndex = buffer.length - 1;
		var curRowIndex = buffer[curPageIndex].length - 1;
		var curRowArr = buffer[curPageIndex][curRowIndex];

		for (var i = 0; i < words.length; i++) {
			var word = words[i];
			if (arabicHandler.ContainsArabicCharacters(word)) {
				word = arabicHandler.ShapeArabicCharacters(word);
			}

			var wordWithPrecedingSpace = ((i == 0) ? "" : " ") + word;
			var wordLength = GetStringWidth( wordWithPrecedingSpace );

			var rowLength = GetCharArrayWidth(curRowArr);

			if (rowLength + wordLength <= pixelsPerRow || rowLength <= 0) {
				//stay on same row
				curRowArr = AddWordToCharArray( curRowArr, wordWithPrecedingSpace, activeTextEffects );
			}
			else if (curRowIndex == 0) {
				//start next row
				buffer[ curPageIndex ][ curRowIndex ] = curRowArr;
				buffer[ curPageIndex ].push( [] );
				curRowIndex++;
				curRowArr = buffer[ curPageIndex ][ curRowIndex ];
				curRowArr = AddWordToCharArray( curRowArr, word, activeTextEffects );
			}
			else {
				//start next page
				buffer[ curPageIndex ][ curRowIndex ] = curRowArr;
				buffer.push( [] );
				curPageIndex++;
				buffer[ curPageIndex ].push( [] );
				curRowIndex = 0;
				curRowArr = buffer[ curPageIndex ][ curRowIndex ];
				curRowArr = AddWordToCharArray( curRowArr, word, activeTextEffects );
			}
		}

		//destroy any empty stuff
		var lastPage = buffer[ buffer.length-1 ];
		var lastRow = lastPage[ lastPage.length-1 ];
		if( lastRow.length == 0 )
			lastPage.splice( lastPage.length-1, 1 );
		if( lastPage.length == 0 )
			buffer.splice( buffer.length-1, 1 );

		//finish up 
		lastPage = buffer[ buffer.length-1 ];
		lastRow = lastPage[ lastPage.length-1 ];
		if( lastRow.length > 0 ) {
			var lastChar = lastRow[ lastRow.length-1 ];
			lastChar.SetPrintHandler( onFinishHandler );
		}

		console.log(buffer);

		isActive = true;
	};

	this.AddLinebreak = function() {
		var lastPage = buffer[ buffer.length-1 ];
		if( lastPage.length <= 1 ) {
			console.log("LINEBREAK - NEW ROW ");
			// add new row
			lastPage.push( [] );
		}
		else {
			// add new page
			buffer.push( [[]] );
		}
		console.log(buffer);

		isActive = true;
	}

	/* new text effects */
	this.HasTextEffect = function(name) {
		return activeTextEffects.indexOf( name ) > -1;
	}
	this.AddTextEffect = function(name) {
		activeTextEffects.push( name );
	}
	this.RemoveTextEffect = function(name) {
		activeTextEffects.splice( activeTextEffects.indexOf( name ), 1 );
	}

	/* this is a hook for GIF rendering */
	var didPageFinishThisFrame = false;
	this.DidPageFinishThisFrame = function(){ return didPageFinishThisFrame; };

	var didFlipPageThisFrame = false;
	this.DidFlipPageThisFrame = function(){ return didFlipPageThisFrame; };

	// this.SetCharsPerRow = function(num){ charsPerRow = num; }; // hacky
};

/* ARABIC */
var ArabicHandler = function() {

	var arabicCharStart = 0x0621;
	var arabicCharEnd = 0x064E;

	var CharacterForm = {
		Isolated : 0,
		Final : 1,
		Initial : 2,
		Middle : 3
	};

	// map glyphs to their character forms
	var glyphForms = {
		/*		 Isolated, Final, Initial, Middle Forms	*/
		0x0621: [0xFE80,0xFE80,0xFE80,0xFE80], /*  HAMZA  */ 
		0x0622: [0xFE81,0xFE82,0xFE81,0xFE82], /*  ALEF WITH MADDA ABOVE  */ 
		0x0623: [0xFE83,0xFE84,0xFE83,0xFE84], /*  ALEF WITH HAMZA ABOVE  */ 
		0x0624: [0xFE85,0xFE86,0xFE85,0xFE86], /*  WAW WITH HAMZA ABOVE  */ 
		0x0625: [0xFE87,0xFE88,0xFE87,0xFE88], /*  ALEF WITH HAMZA BELOW  */ 
		0x0626: [0xFE89,0xFE8A,0xFE8B,0xFE8C], /*  YEH WITH HAMZA ABOVE  */ 
		0x0627: [0xFE8D,0xFE8E,0xFE8D,0xFE8E], /*  ALEF  */ 
		0x0628: [0xFE8F,0xFE90,0xFE91,0xFE92], /*  BEH  */ 
		0x0629: [0xFE93,0xFE94,0xFE93,0xFE94], /*  TEH MARBUTA  */ 
		0x062A: [0xFE95,0xFE96,0xFE97,0xFE98], /*  TEH  */ 
		0x062B: [0xFE99,0xFE9A,0xFE9B,0xFE9C], /*  THEH  */ 
		0x062C: [0xFE9D,0xFE9E,0xFE9F,0xFEA0], /*  JEEM  */ 
		0x062D: [0xFEA1,0xFEA2,0xFEA3,0xFEA4], /*  HAH  */ 
		0x062E: [0xFEA5,0xFEA6,0xFEA7,0xFEA8], /*  KHAH  */ 
		0x062F: [0xFEA9,0xFEAA,0xFEA9,0xFEAA], /*  DAL  */ 
		0x0630: [0xFEAB,0xFEAC,0xFEAB,0xFEAC], /*  THAL */ 
		0x0631: [0xFEAD,0xFEAE,0xFEAD,0xFEAE], /*  RAA  */ 
		0x0632: [0xFEAF,0xFEB0,0xFEAF,0xFEB0], /*  ZAIN  */ 
		0x0633: [0xFEB1,0xFEB2,0xFEB3,0xFEB4], /*  SEEN  */ 
		0x0634: [0xFEB5,0xFEB6,0xFEB7,0xFEB8], /*  SHEEN  */ 
		0x0635: [0xFEB9,0xFEBA,0xFEBB,0xFEBC], /*  SAD  */ 
		0x0636: [0xFEBD,0xFEBE,0xFEBF,0xFEC0], /*  DAD  */ 
		0x0637: [0xFEC1,0xFEC2,0xFEC3,0xFEC4], /*  TAH  */ 
		0x0638: [0xFEC5,0xFEC6,0xFEC7,0xFEC8], /*  ZAH  */ 
		0x0639: [0xFEC9,0xFECA,0xFECB,0xFECC], /*  AIN  */ 
		0x063A: [0xFECD,0xFECE,0xFECF,0xFED0], /*  GHAIN  */ 
		0x063B: [0x0000,0x0000,0x0000,0x0000], /*  space */
		0x063C: [0x0000,0x0000,0x0000,0x0000], /*  space */
		0x063D: [0x0000,0x0000,0x0000,0x0000], /*  space */
		0x063E: [0x0000,0x0000,0x0000,0x0000], /*  space */
		0x063F: [0x0000,0x0000,0x0000,0x0000], /*  space */
		0x0640: [0x0640,0x0640,0x0640,0x0640], /*  TATWEEL  */ 
		0x0641: [0xFED1,0xFED2,0xFED3,0xFED4], /*  FAA  */ 
		0x0642: [0xFED5,0xFED6,0xFED7,0xFED8], /*  QAF  */ 
		0x0643: [0xFED9,0xFEDA,0xFEDB,0xFEDC], /*  KAF  */ 
		0x0644: [0xFEDD,0xFEDE,0xFEDF,0xFEE0], /*  LAM  */ 
		0x0645: [0xFEE1,0xFEE2,0xFEE3,0xFEE4], /*  MEEM  */ 
		0x0646: [0xFEE5,0xFEE6,0xFEE7,0xFEE8], /*  NOON  */ 
		0x0647: [0xFEE9,0xFEEA,0xFEEB,0xFEEC], /*  HEH  */ 
		0x0648: [0xFEED,0xFEEE,0xFEED,0xFEEE], /*  WAW  */ 
		0x0649: [0xFEEF,0xFEF0,0xFBE8,0xFBE9], /*  ALEF MAKSURA  */ 
		0x064A: [0xFEF1,0xFEF2,0xFEF3,0xFEF4], /*  YEH  */ 
		0x064B: [0xFEF5,0xFEF6,0xFEF5,0xFEF6], /*  LAM ALEF MADD*/
		0x064C: [0xFEF7,0xFEF8,0xFEF7,0xFEF8], /*  LAM ALEF HAMZA ABOVE*/
		0x064D: [0xFEF9,0xFEFa,0xFEF9,0xFEFa], /*  LAM ALEF HAMZA BELOW*/
		0x064E: [0xFEFb,0xFEFc,0xFEFb,0xFEFc], /*  LAM ALEF */
	};

	var disconnectedCharacters = [0x0621,0x0622,0x0623,0x0624,0x0625,0x0627,0x062f,0x0630,0x0631,0x0632,0x0648,0x0649,0x064b,0x064c,0x064d,0x064e];

	function IsArabicCharacter(char) {
		var code = char.charCodeAt(0);
		return (code >= arabicCharStart && code <= arabicCharEnd);
	}

	function ContainsArabicCharacters(word) {
		for (var i = 0; i < word.length; i++) {
			if (IsArabicCharacter(word[i])) {
				return true;
			}
		}
		return false;
	}

	function IsDisconnectedCharacter(char) {
		var code = char.charCodeAt(0);
		return disconnectedCharacters.indexOf(code) != -1;
	}

	function ShapeArabicCharacters(word) {
		var shapedWord = "";

		for (var i = 0; i < word.length; i++) {
			if (!IsArabicCharacter(word[i])) {
				shapedWord += word[i];
				continue;
			}

			var connectedToPreviousChar = i-1 >= 0 && IsArabicCharacter(word[i-1]) && !IsDisconnectedCharacter(word[i-1]);

			var connectedToNextChar = i+1 < word.length && IsArabicCharacter(word[i+1]) && !IsDisconnectedCharacter(word[i]);

			var form;
			if (!connectedToPreviousChar && !connectedToNextChar) {
				form = CharacterForm.Isolated;
			}
			else if (connectedToPreviousChar && !connectedToNextChar) {
				form = CharacterForm.Final;
			}
			else if (!connectedToPreviousChar && connectedToNextChar) {
				form = CharacterForm.Initial;
			}
			else if (connectedToPreviousChar && connectedToNextChar) {
				form = CharacterForm.Middle;
			}

			var code = word[i].charCodeAt(0);

			// handle lam alef special case
			if (code == 0x0644 && connectedToNextChar) {
				var nextCode = word[i+1].charCodeAt(0);
				var specialCode = null;
				if (nextCode == 0x0622) {
					// alef madd
					specialCode = glyphForms[0x064b][form];
				}
				else if (nextCode == 0x0623) {
					// hamza above
					specialCode = glyphForms[0x064c][form];
				}
				else if (nextCode == 0x0625) {
					// hamza below
					specialCode = glyphForms[0x064d][form];
				}
				else if (nextCode == 0x0627) {
					// alef
					specialCode = glyphForms[0x064e][form];
				}

				if (specialCode != null) {
					shapedWord += String.fromCharCode(specialCode);
					i++; // skip a step
					continue;
				}
			}

			// hacky?
			if (form === CharacterForm.Isolated) {
				shapedWord += word[i];
				continue;
			}

			var shapedCode = glyphForms[code][form];
			shapedWord += String.fromCharCode(shapedCode);
		}

		return shapedWord;
	}

	this.ContainsArabicCharacters = ContainsArabicCharacters;
	this.ShapeArabicCharacters = ShapeArabicCharacters;
}

/* NEW TEXT EFFECTS */
var TextEffects = new Map();

var RainbowEffect = function() { // TODO - should it be an object or just a method?
	this.DoEffect = function(char,time) {
		// console.log("RAINBOW!!!");
		// console.log(char);
		// console.log(char.color);
		// console.log(char.col);

		var h = Math.abs( Math.sin( (time / 600) - (char.col / 8) ) );
		var rgb = hslToRgb( h, 1, 0.5 );
		char.color.r = rgb[0];
		char.color.g = rgb[1];
		char.color.b = rgb[2];
		char.color.a = 255;
	}
};
TextEffects["rbw"] = new RainbowEffect();

var ColorEffect = function(index) {
	this.DoEffect = function(char) {
		var pal = getPal( curPal() );
		var color = pal[ parseInt( index ) ];
		// console.log(color);
		char.color.r = color[0];
		char.color.g = color[1];
		char.color.b = color[2];
		char.color.a = 255;
	}
};
TextEffects["clr1"] = new ColorEffect(0);
TextEffects["clr2"] = new ColorEffect(1); // TODO : should I use parameters instead of special names?
TextEffects["clr3"] = new ColorEffect(2);

var WavyEffect = function() {
	this.DoEffect = function(char,time) {
		char.offset.y += Math.sin( (time / 250) - (char.col / 2) ) * 4;
	}
};
TextEffects["wvy"] = new WavyEffect();

var ShakyEffect = function() {
	function disturb(func,time,offset,mult1,mult2) {
		return func( (time * mult1) - (offset * mult2) );
	}

	this.DoEffect = function(char,time) {
		char.offset.y += 3
						* disturb(Math.sin,time,char.col,0.1,0.5)
						* disturb(Math.cos,time,char.col,0.3,0.2)
						* disturb(Math.sin,time,char.row,2.0,1.0);
		char.offset.x += 3
						* disturb(Math.cos,time,char.row,0.1,1.0)
						* disturb(Math.sin,time,char.col,3.0,0.7)
						* disturb(Math.cos,time,char.col,0.2,0.3);
	}
};
TextEffects["shk"] = new ShakyEffect();

} // Dialog()
</script>

<script>
/*
TODO
- reset renderer function
- react to changes in: drawings, palettes
- possible future plan: limit size of cache (remove old images)
- change image store path from (pal > col > draw) to (draw > pal > col)
- get rid of old getSpriteImage (etc) methods
- get editor working again [in progress]
- move debug timer class into core (seems useful)
*/

function Renderer(tilesize, scale) {

console.log("!!!!! NEW RENDERER");

var imageStore = { // TODO : rename to imageCache
	source: {},
	render: {}
};

var palettes = null; // TODO : need null checks?
var context = null;

function setPalettes(paletteObj) {
	palettes = paletteObj;

	// TODO : should this really clear out the render cache?
	imageStore.render = {};
}

function getPaletteColor(paletteId, colorIndex) {
	var palette = palettes[paletteId];

	if (colorIndex > palette.colors.length) { // do I need this failure case? (seems un-reliable)
		colorIndex = 0;
	}

	var color = palette.colors[colorIndex];

	return {
		r : color[0],
		g : color[1],
		b : color[2]
	};
}

var debugRenderCount = 0;

// TODO : change image store path from (pal > col > draw) to (draw > pal > col)
function renderImage(drawing, paletteId) {
	// debugRenderCount++;
	// console.log("RENDER COUNT " + debugRenderCount);

	var col = drawing.col;
	var colStr = "" + col;
	var pal = paletteId;
	var drwId = drawing.drw;
	var imgSrc = imageStore.source[ drawing.drw ];

	// initialize render cache entry
	if (imageStore.render[drwId] === undefined || imageStore.render[drwId] === null) {
		imageStore.render[drwId] = {};
	}

	if (imageStore.render[drwId][pal] === undefined || imageStore.render[drwId][pal] === null) {
		imageStore.render[drwId][pal] = {};
	}

	// create array of ImageData frames
	imageStore.render[drwId][pal][colStr] = [];

	for (var i = 0; i < imgSrc.length; i++) {
		var frameSrc = imgSrc[i];
		var frameData = imageDataFromImageSource( frameSrc, pal, col );
		imageStore.render[drwId][pal][colStr].push(frameData);
	}
}

function imageDataFromImageSource(imageSource, pal, col) {
	//console.log(imageSource);

	var img = context.createImageData(tilesize*scale,tilesize*scale);

	var backgroundColor = getPaletteColor(pal,0);
	var foregroundColor = getPaletteColor(pal,col);

	for (var y = 0; y < tilesize; y++) {
		for (var x = 0; x < tilesize; x++) {
			var px = imageSource[y][x];
			for (var sy = 0; sy < scale; sy++) {
				for (var sx = 0; sx < scale; sx++) {
					var pxl = (((y * scale) + sy) * tilesize * scale * 4) + (((x*scale) + sx) * 4);
					if ( px === 1 ) {
						img.data[pxl + 0] = foregroundColor.r;
						img.data[pxl + 1] = foregroundColor.g;
						img.data[pxl + 2] = foregroundColor.b;
						img.data[pxl + 3] = 255;
					}
					else { //ch === 0
						img.data[pxl + 0] = backgroundColor.r;
						img.data[pxl + 1] = backgroundColor.g;
						img.data[pxl + 2] = backgroundColor.b;
						img.data[pxl + 3] = 255;
					}
				}
			}
		}
	}

	// convert to canvas: chrome has poor performance when working directly with image data
	var imageCanvas = document.createElement("canvas");
	imageCanvas.width = img.width;
	imageCanvas.height = img.height;
	var imageContext = imageCanvas.getContext("2d");
	imageContext.putImageData(img,0,0);

	return imageCanvas;
}

// TODO : move into core
function undefinedOrNull(x) {
	return x === undefined || x === null;
}

function isImageRendered(drawing, paletteId) {
	var col = drawing.col;
	var colStr = "" + col;
	var pal = paletteId;
	var drwId = drawing.drw;

	if (undefinedOrNull(imageStore.render[drwId]) ||
		undefinedOrNull(imageStore.render[drwId][pal]) ||
		undefinedOrNull(imageStore.render[drwId][pal][colStr])) {
			return false;
	}
	else {
		return true;
	}
}

function getImageSet(drawing, paletteId) {
	return imageStore.render[drawing.drw][paletteId][drawing.col];
}

function getImageFrame(drawing, paletteId, frameOverride) {
	var frameIndex = 0;
	if (drawing.animation.isAnimated) {
		if (frameOverride != undefined && frameOverride != null) {
			frameIndex = frameOverride;
		}
		else {
			frameIndex = drawing.animation.frameIndex;
		}
	}

	return getImageSet(drawing, paletteId)[frameIndex];
}

function getOrRenderImage(drawing, paletteId, frameOverride) {
	if (!isImageRendered(drawing, paletteId)) {
		renderImage(drawing, paletteId);
	}

	return getImageFrame(drawing, paletteId, frameOverride);
}

/* PUBLIC INTERFACE */
this.GetImage = getOrRenderImage;

this.SetPalettes = setPalettes;

this.SetImageSource = function(drawingId, imageSourceData) {
	imageStore.source[drawingId] = imageSourceData;
	imageStore.render[drawingId] = {}; // reset render cache for this image
}

this.GetImageSource = function(drawingId) {
	return imageStore.source[drawingId];
}

this.GetFrameCount = function(drawingId) {
	return imageStore.source[drawingId].length;
}

this.AttachContext = function(ctx) {
	context = ctx;
}

} // Renderer()
</script>

<script>
var xhr; // TODO : remove
var canvas;
var context; // TODO : remove if safe?
var ctx;

var title = "";
var room = {};
var tile = {};
var sprite = {};
var item = {};
var dialog = {};
var palette = {
	"0" : [[0,0,0],[255,0,0],[255,255,255]] //start off with a default palette (can be overriden)
};
var ending = {};
var variable = {}; // these are starting variable values -- they don't update (or I don't think they will)
var playerId = "A";

var defaultFontName = "ascii_small";
var fontName = defaultFontName;
var TextDirection = {
	LeftToRight : "LTR",
	RightToLeft : "RTL"
};
var textDirection = TextDirection.LeftToRight;

var names = {
	room : new Map(),
	tile : new Map(), // Note: Not currently enabled in the UI
	sprite : new Map(),
	item : new Map(),
	/*dialog : new Map()*/ // TODO
	/*ending : new Map()*/ // TODO
};
function updateNamesFromCurData() {
	names.room = new Map();
	for(id in room) {
		if(room[id].name != undefined && room[id].name != null) {
			names.room.set( room[id].name, id );
		}
	}
	names.tile = new Map();
	for(id in tile) {
		if(tile[id].name != undefined && tile[id].name != null) {
			names.tile.set( tile[id].name, id );
		}
	}
	names.sprite = new Map();
	for(id in sprite) {
		if(sprite[id].name != undefined && sprite[id].name != null) {
			names.sprite.set( sprite[id].name, id );
		}
	}
	names.item = new Map();
	for(id in item) {
		if(item[id].name != undefined && item[id].name != null) {
			names.item.set( item[id].name, id );
		}
	}
}

var spriteStartLocations = {};

/* VERSION */
var version = {
	major: 6, // major changes
	minor: 1 // smaller changes
};
function getEngineVersion() {
	return version.major + "." + version.minor;
}

/* FLAGS */
var flags;
function resetFlags() {
	flags = {
		ROOM_FORMAT : 0 // 0 = non-comma separated, 1 = comma separated
	};
}
resetFlags(); //init flags on load script

// SUPER hacky location... :/
var editorDevFlags = {
	// NONE right now!
};

function clearGameData() {
	title = "";
	room = {};
	tile = {};
	sprite = {};
	item = {};
	dialog = {};
	palette = { //start off with a default palette (can be overriden)
		"0" : {
			name : null,
			colors : [[0,0,0],[255,0,0],[255,255,255]]
		}
	};
	ending = {};
	isEnding = false; //todo - correct place for this?
	variable = {};

	// TODO RENDERER : clear data?

	spriteStartLocations = {};

	names = {
		room : new Map(),
		tile : new Map(),
		sprite : new Map(),
		item : new Map()
	};

	fontName = defaultFontName; // TODO : reset font manager too?
	textDirection = TextDirection.LeftToRight;
}

var width = 128;
var height = 128;
var scale = 4; //this is stupid but necessary
var tilesize = 8;
var mapsize = 16;

var curRoom = "0";

var key = {
	left : 37,
	right : 39,
	up : 38,
	down : 40,
	space : 32,
	enter : 13,
	w : 87,
	a : 65,
	s : 83,
	d : 68,
	r : 82,
	shift : 16,
	ctrl : 17,
	alt : 18,
	cmd : 224
};

var prevTime = 0;
var deltaTime = 0;

//methods used to trigger gif recording
var didPlayerMoveThisFrame = false;
var onPlayerMoved = null;
// var didDialogUpdateThisFrame = false;
var onDialogUpdate = null;

//inventory update UI handles
var onInventoryChanged = null;
var onVariableChanged = null;

var isPlayerEmbeddedInEditor = false;

var renderer = new Renderer(tilesize, scale);

function getGameNameFromURL() {
	var game = window.location.hash.substring(1);
	// console.log("game name --- " + game);
	return game;
}

function attachCanvas(c) {
	canvas = c;
	canvas.width = width * scale;
	canvas.height = width * scale;
	ctx = canvas.getContext("2d");
	dialogRenderer.AttachContext(ctx);
	renderer.AttachContext(ctx);
}

var curGameData = null;
function load_game(game_data, startWithTitle) {
	curGameData = game_data; //remember the current game (used to reset the game)

	dialogBuffer.Reset();
	scriptInterpreter.ResetEnvironment(); // ensures variables are reset -- is this the best way?

	parseWorld(game_data);

	if (!isPlayerEmbeddedInEditor) {
		// hack to ensure default font is available
		fontManager.AddResource(defaultFontName + fontManager.GetExtension(), document.getElementById(defaultFontName).text.slice(1));
	}

	var font = fontManager.Get( fontName );
	dialogBuffer.SetFont(font);
	dialogRenderer.SetFont(font);

	setInitialVariables();

	// setInterval(updateLoadingScreen, 300); // hack test

	onready(startWithTitle);
}

function reset_cur_game() {
	if (curGameData == null) return; //can't reset if we don't have the game data
	stopGame();
	clearGameData();
	load_game(curGameData);
}

var update_interval = null;
function onready(startWithTitle) {
	if(startWithTitle === undefined || startWithTitle === null) startWithTitle = true;

	clearInterval(loading_interval);

	input = new InputManager();

	document.addEventListener('keydown', input.onkeydown);
	document.addEventListener('keyup', input.onkeyup);

	if (isPlayerEmbeddedInEditor) {
		canvas.addEventListener('touchstart', input.ontouchstart);
		canvas.addEventListener('touchmove', input.ontouchmove);
		canvas.addEventListener('touchend', input.ontouchend);
	}
	else {
		document.addEventListener('touchstart', input.ontouchstart);
		document.addEventListener('touchmove', input.ontouchmove);
		document.addEventListener('touchend', input.ontouchend);
	}

	window.onblur = input.onblur;

	update_interval = setInterval(update,16);

	if(startWithTitle) { // used by editor 
		startNarrating(title);
	}
}

function setInitialVariables() {
	for(id in variable) {
		var value = variable[id]; // default to string
		if(value === "true") {
			value = true;
		}
		else if(value === "false") {
			value = false;
		}
		else if(!isNaN(parseFloat(value))) {
			value = parseFloat(value);
		}
		scriptInterpreter.SetVariable(id,value);
	}
	scriptInterpreter.SetOnVariableChangeHandler( onVariableChanged );
}

// TODO: this is likely broken
function breadthFirstSearch(map, from, to) {
	from.trail = [];
	var visited = [];
	var queue = [from];
	visited.push( posToString(from) );

	//console.log( "~ bfs ~");
	//console.log( posToString(from) + " to " + posToString(to) );

	while ( queue.length > 0 ) {

		//grab pos from queue and mark as visited
		var curPos = queue.shift();

		//console.log( posToString(curPos) );
		//console.log( ".. " + pathToString(curPos.trail) );
		//console.log( visited );

		if (curPos.x == to.x && curPos.y == to.y) {
			//found a path!
			var path = curPos.trail.splice(0);
			path.push( curPos );
			return path;
		}

		//look at neighbors
		neighbors(curPos).forEach( function(n) {
			var inBounds = (n.x >= 0 && n.x < 16 && n.y >= 0 && n.y < 16);
			if (inBounds) {
				var noCollision = map[n.y][n.x] <= 0;
				var notVisited = visited.indexOf( posToString(n) ) == -1;
				if (noCollision && notVisited) {
					n.trail = curPos.trail.slice();
					n.trail.push(curPos);
					queue.push( n );
					visited.push( posToString(n) );
				}
			}
		});

	}

	return []; // no path found
}

function posToString(pos) {
	return pos.x + "," + pos.y;
}

function pathToString(path) {
	var s = "";
	for (i in path) {
		s += posToString(path[i]) + " ";
	}
	return s;
}

function neighbors(pos) {
	var neighborList = [];
	neighborList.push( {x:pos.x+1, y:pos.y+0} );
	neighborList.push( {x:pos.x-1, y:pos.y+0} );
	neighborList.push( {x:pos.x+0, y:pos.y+1} );
	neighborList.push( {x:pos.x+0, y:pos.y-1} );
	return neighborList;
}

function collisionMap(roomId) {
	var map = [
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
	];

	for (r in room[roomId].tilemap) {
		var row = room[roomId].tilemap[r];
		for (var c = 0; c < row.length; c++) {
			if (room[roomId].walls.indexOf( row[x] ) != -1) {
				map[r][c] = 1;
			}
		}
	}

	for (id in sprite) {
		var spr = sprite[id];
		if (spr.room === roomId) {
			map[spr.y][spr.x] = 2;
		}
	}

	return map;
}

function getOffset(evt) {
	var offset = { x:0, y:0 };

	var el = evt.target;
	var rect = el.getBoundingClientRect();

	offset.x += rect.left + el.scrollLeft;
	offset.y += rect.top + el.scrollTop;

	offset.x = evt.clientX - offset.x;
	offset.y = evt.clientY - offset.y;

	return offset;
}

function stopGame() {
	console.log("stop GAME!");

	document.removeEventListener('keydown', input.onkeydown);
	document.removeEventListener('keyup', input.onkeyup);

	if (isPlayerEmbeddedInEditor) {
		canvas.removeEventListener('touchstart', input.ontouchstart);
		canvas.removeEventListener('touchmove', input.ontouchmove);
		canvas.removeEventListener('touchend', input.ontouchend);
	}
	else {
		document.removeEventListener('touchstart', input.ontouchstart);
		document.removeEventListener('touchmove', input.ontouchmove);
		document.removeEventListener('touchend', input.ontouchend);
	}

	window.onblur = null;

	clearInterval(update_interval);
}

/* loading animation */
var loading_anim_data = [
	[
		0,1,1,1,1,1,1,0,
		0,0,1,1,1,1,0,0,
		0,0,1,1,1,1,0,0,
		0,0,0,1,1,0,0,0,
		0,0,0,1,1,0,0,0,
		0,0,1,0,0,1,0,0,
		0,0,1,0,0,1,0,0,
		0,1,1,1,1,1,1,0,
	],
	[
		0,1,1,1,1,1,1,0,
		0,0,1,0,0,1,0,0,
		0,0,1,1,1,1,0,0,
		0,0,0,1,1,0,0,0,
		0,0,0,1,1,0,0,0,
		0,0,1,0,0,1,0,0,
		0,0,1,1,1,1,0,0,
		0,1,1,1,1,1,1,0,
	],
	[
		0,1,1,1,1,1,1,0,
		0,0,1,0,0,1,0,0,
		0,0,1,0,0,1,0,0,
		0,0,0,1,1,0,0,0,
		0,0,0,1,1,0,0,0,
		0,0,1,1,1,1,0,0,
		0,0,1,1,1,1,0,0,
		0,1,1,1,1,1,1,0,
	],
	[
		0,1,1,1,1,1,1,0,
		0,0,1,0,0,1,0,0,
		0,0,1,0,0,1,0,0,
		0,0,0,1,1,0,0,0,
		0,0,0,1,1,0,0,0,
		0,0,1,1,1,1,0,0,
		0,0,1,1,1,1,0,0,
		0,1,1,1,1,1,1,0,
	],
	[
		0,0,0,0,0,0,0,0,
		1,0,0,0,0,0,0,1,
		1,1,1,0,0,1,1,1,
		1,1,1,1,1,0,0,1,
		1,1,1,1,1,0,0,1,
		1,1,1,0,0,1,1,1,
		1,0,0,0,0,0,0,1,
		0,0,0,0,0,0,0,0,
	]
];
var loading_anim_frame = 0;
var loading_anim_speed = 500;
var loading_interval = null;

function loadingAnimation() {
	//create image
	var loadingAnimImg = ctx.createImageData(8*scale, 8*scale);
	//draw image
	for (var y = 0; y < 8; y++) {
		for (var x = 0; x < 8; x++) {
			var i = (y * 8) + x;
			if (loading_anim_data[loading_anim_frame][i] == 1) {
				//scaling nonsense
				for (var sy = 0; sy < scale; sy++) {
					for (var sx = 0; sx < scale; sx++) {
						var pxl = 4 * ( (((y*scale)+sy) * (8*scale)) + ((x*scale)+sx) );
						loadingAnimImg.data[pxl+0] = 255;
						loadingAnimImg.data[pxl+1] = 255;
						loadingAnimImg.data[pxl+2] = 255;
						loadingAnimImg.data[pxl+3] = 255;
					}
				}
			}
		}
	}
	//put image on canvas
	ctx.putImageData(loadingAnimImg,scale*(width/2 - 4),scale*(height/2 - 4));
	//update frame
	loading_anim_frame++;
	if (loading_anim_frame >= 5) loading_anim_frame = 0;
}

function updateLoadingScreen() {
	// TODO : in progress
	ctx.fillStyle = "rgb(0,0,0)";
	ctx.fillRect(0,0,canvas.width,canvas.height);

	loadingAnimation();
	drawSprite( getSpriteImage(sprite["a"],"0",0), 8, 8, ctx );
}

function update() {
	var curTime = Date.now();
	deltaTime = curTime - prevTime;

	if (curRoom == null) {
		// in the special case where there is no valid room, end the game
		startNarrating( "", true /*isEnding*/ );
	}

	if (!transition.IsTransitionActive()) {
		updateInput();
	}

	if (transition.IsTransitionActive()) {
		// transition animation takes over everything!
		transition.UpdateTransition(deltaTime);
	}
	else {
		if (!isNarrating && !isEnding) {
			updateAnimation();
			drawRoom( room[curRoom] ); // draw world if game has begun
		}
		else {
			//make sure to still clear screen
			ctx.fillStyle = "rgb(" + getPal(curPal())[0][0] + "," + getPal(curPal())[0][1] + "," + getPal(curPal())[0][2] + ")";
			ctx.fillRect(0,0,canvas.width,canvas.height);
		}

		// if (isDialogMode) { // dialog mode
		if(dialogBuffer.IsActive()) {
			dialogRenderer.Draw( dialogBuffer, deltaTime );
			dialogBuffer.Update( deltaTime );
		}
		else if (!isEnding) {
			moveSprites(); // TODO : I probably need to remove this..
		}

		// keep moving avatar if player holds down button
		if( !dialogBuffer.IsActive() && !isEnding )
		{
			if( curPlayerDirection != Direction.None ) {
				playerHoldToMoveTimer -= deltaTime;

				if( playerHoldToMoveTimer <= 0 )
				{
					movePlayer( curPlayerDirection );
					playerHoldToMoveTimer = 150;
				}
			}
		}
	}

	prevTime = curTime;

	//for gif recording
	if (didPlayerMoveThisFrame && onPlayerMoved != null) {
		onPlayerMoved();
	}
	didPlayerMoveThisFrame = false;

	/* hacky replacement */
	if (onDialogUpdate != null) {
		dialogRenderer.SetPageFinishHandler( onDialogUpdate );
	}

	input.resetKeyPressed();
	input.resetTapReleased();
}

function updateInput() {
	if( dialogBuffer.IsActive() ) {
		if (input.anyKeyPressed() || input.isTapReleased()) {
			/* CONTINUE DIALOG */
			if (dialogBuffer.CanContinue()) {
				var hasMoreDialog = dialogBuffer.Continue();
				if(!hasMoreDialog) {
					// ignore currently held keys UNTIL they are released (stops player from insta-moving)
					input.ignoreHeldKeys();
				}
			}
			else {
				dialogBuffer.Skip();
			}
		}
	}
	else if ( isEnding ) {
		if (input.anyKeyPressed() || input.isTapReleased()) {
			/* RESTART GAME */
			reset_cur_game();
		}
	}
	else {
		/* WALK */
		var prevPlayerDirection = curPlayerDirection;

		if ( input.isKeyDown( key.left ) || input.isKeyDown( key.a ) || input.swipeLeft() ) {
			curPlayerDirection = Direction.Left;
		}
		else if ( input.isKeyDown( key.right ) || input.isKeyDown( key.d ) || input.swipeRight() ) {
			curPlayerDirection = Direction.Right;
		}
		else if ( input.isKeyDown( key.up ) || input.isKeyDown( key.w ) || input.swipeUp() ) {
			curPlayerDirection = Direction.Up;
		}
		else if ( input.isKeyDown( key.down ) || input.isKeyDown( key.s ) || input.swipeDown() ) {
			curPlayerDirection = Direction.Down;
		}
		else {
			curPlayerDirection = Direction.None;
		}

		if (curPlayerDirection != Direction.None && curPlayerDirection != prevPlayerDirection) {
			movePlayer( curPlayerDirection );
			playerHoldToMoveTimer = 500;
		}
	}
}

var animationCounter = 0;
var animationTime = 400;
function updateAnimation() {
	animationCounter += deltaTime;

	if ( animationCounter >= animationTime ) {

		// animate sprites
		for (id in sprite) {
			var spr = sprite[id];
			if (spr.animation.isAnimated) {
				spr.animation.frameIndex = ( spr.animation.frameIndex + 1 ) % spr.animation.frameCount;
			}
		}

		// animate tiles
		for (id in tile) {
			var til = tile[id];
			if (til.animation.isAnimated) {
				til.animation.frameIndex = ( til.animation.frameIndex + 1 ) % til.animation.frameCount;
			}
		}

		// animate items
		for (id in item) {
			var itm = item[id];
			if (itm.animation.isAnimated) {
				itm.animation.frameIndex = ( itm.animation.frameIndex + 1 ) % itm.animation.frameCount;
			}
		}

		// reset counter
		animationCounter = 0;

	}
}

var moveCounter = 0;
var moveTime = 200;
function moveSprites() {
	moveCounter += deltaTime;

	if (moveCounter >= moveTime) {

		for (id in sprite) {
			var spr = sprite[id];
			if (spr.walkingPath.length > 0) {
				//move sprite
				var nextPos = spr.walkingPath.shift();
				spr.x = nextPos.x;
				spr.y = nextPos.y;


				var end = getEnding( spr.room, spr.x, spr.y );
				var ext = getExit( spr.room, spr.x, spr.y );
				var itmIndex = getItemIndex( spr.room, spr.x, spr.y );
				if (end) { //if the sprite hits an ending
					if (id === playerId) { // only the player can end the game
						startNarrating( ending[end.id], true /*isEnding*/ );
					}
				}
				else if (ext) { //if the sprite hits an exit
					//move it to another scene
					spr.room = ext.dest.room;
					spr.x = ext.dest.x;
					spr.y = ext.dest.y;
					if (id === playerId) {
						//if the player changes scenes, change the visible scene
						curRoom = ext.dest.room;
					}
				}
				else if(itmIndex > -1) {
					var itm = room[ spr.room ].items[ itmIndex ];
					room[ spr.room ].items.splice( itmIndex, 1 );
					if( spr.inventory[ itm.id ] )
						spr.inventory[ itm.id ] += 1;
					else
						spr.inventory[ itm.id ] = 1;

					if(onInventoryChanged != null)
						onInventoryChanged( itm.id );

					if(id === playerId)
						startItemDialog( itm.id  /*itemId*/ );

					// stop moving : is this a good idea?
					spr.walkingPath = [];
				}

				if (id === playerId) didPlayerMoveThisFrame = true;
			}
		}

		moveCounter = 0;
	}

}

function getSpriteAt(x,y) {
	for (id in sprite) {
		var spr = sprite[id];
		if (spr.room === curRoom) {
			if (spr.x == x && spr.y == y) {
				return id;
			}
		}
	}
	return null;
}

var Direction = {
	None : -1,
	Up : 0,
	Down : 1,
	Left : 2,
	Right : 3
};

var curPlayerDirection = Direction.None;
var playerHoldToMoveTimer = 0;

var InputManager = function() {
	var self = this;

	var pressed;
	var ignored;
	var newKeyPress;
	var touchState;

	function resetAll() {
		pressed = {};
		ignored = {};
		newKeyPress = false;

		touchState = {
			isDown : false,
			startX : 0,
			startY : 0,
			curX : 0,
			curY : 0,
			swipeDistance : 30,
			swipeDirection : Direction.None,
			tapReleased : false
		};
	}
	resetAll();

	function stopWindowScrolling(e) {
		if(e.keyCode == key.left || e.keyCode == key.right || e.keyCode == key.up || e.keyCode == key.down || !isPlayerEmbeddedInEditor)
			e.preventDefault();
	}

	function tryRestartGame(e) {
		/* RESTART GAME */
		if ( e.keyCode === key.r && ( e.getModifierState("Control") || e.getModifierState("Meta") ) ) {
			if ( confirm("Restart the game?") ) {
				reset_cur_game();
			}
		}
	}

	function eventIsModifier(event) {
		return (event.keyCode == key.shift || event.keyCode == key.ctrl || event.keyCode == key.alt || event.keyCode == key.cmd);
	}

	function isModifierKeyDown() {
		return ( self.isKeyDown(key.shift) || self.isKeyDown(key.ctrl) || self.isKeyDown(key.alt) || self.isKeyDown(key.cmd) );
	}

	this.ignoreHeldKeys = function() {
		for (var key in pressed) {
			if (pressed[key]) { // only ignore keys that are actually held
				ignored[key] = true;
				// console.log("IGNORE -- " + key);
			}
		}
	}

	this.onkeydown = function(event) {
		// console.log("KEYDOWN -- " + event.keyCode);

		stopWindowScrolling(event);

		tryRestartGame(event);

		// Special keys being held down can interfere with keyup events and lock movement
		// so just don't collect input when they're held
		{
			if (isModifierKeyDown()) {
				return;
			}

			if (eventIsModifier(event)) {
				resetAll();
			}
		}

		if (ignored[event.keyCode]) {
			return;
		}

		if (!self.isKeyDown(event.keyCode)) {
			newKeyPress = true;
		}

		pressed[event.keyCode] = true;
		ignored[event.keyCode] = false;
	}

	this.onkeyup = function(event) {
		// console.log("KEYUP -- " + event.keyCode);
		pressed[event.keyCode] = false;
		ignored[event.keyCode] = false;
	}

	this.ontouchstart = function(event) {
		event.preventDefault();

		if( event.changedTouches.length > 0 ) {
			touchState.isDown = true;

			touchState.startX = touchState.curX = event.changedTouches[0].clientX;
			touchState.startY = touchState.curY = event.changedTouches[0].clientY;

			touchState.swipeDirection = Direction.None;
		}
	}

	this.ontouchmove = function(event) {
		event.preventDefault();

		if( touchState.isDown && event.changedTouches.length > 0 ) {
			touchState.curX = event.changedTouches[0].clientX;
			touchState.curY = event.changedTouches[0].clientY;

			var prevDirection = touchState.swipeDirection;

			if( touchState.curX - touchState.startX <= -touchState.swipeDistance ) {
				touchState.swipeDirection = Direction.Left;
			}
			else if( touchState.curX - touchState.startX >= touchState.swipeDistance ) {
				touchState.swipeDirection = Direction.Right;
			}
			else if( touchState.curY - touchState.startY <= -touchState.swipeDistance ) {
				touchState.swipeDirection = Direction.Up;
			}
			else if( touchState.curY - touchState.startY >= touchState.swipeDistance ) {
				touchState.swipeDirection = Direction.Down;
			}

			if( touchState.swipeDirection != prevDirection ) {
				// reset center so changing directions is easier
				touchState.startX = touchState.curX;
				touchState.startY = touchState.curY;
			}
		}
	}

	this.ontouchend = function(event) {
		event.preventDefault();

		touchState.isDown = false;

		if( touchState.swipeDirection == Direction.None ) {
			// tap!
			touchState.tapReleased = true;
		}

		touchState.swipeDirection = Direction.None;
	}

	this.isKeyDown = function(keyCode) {
		return pressed[keyCode] != null && pressed[keyCode] == true && (ignored[keyCode] == null || ignored[keyCode] == false);
	}

	this.anyKeyPressed = function() {
		return newKeyPress;
	}

	this.resetKeyPressed = function() {
		newKeyPress = false;
	}

	this.swipeLeft = function() {
		return touchState.swipeDirection == Direction.Left;
	}

	this.swipeRight = function() {
		return touchState.swipeDirection == Direction.Right;
	}

	this.swipeUp = function() {
		return touchState.swipeDirection == Direction.Up;
	}

	this.swipeDown = function() {
		return touchState.swipeDirection == Direction.Down;
	}

	this.isTapReleased = function() {
		return touchState.tapReleased;
	}

	this.resetTapReleased = function() {
		touchState.tapReleased = false;
	}

	this.onblur = function() {
		// console.log("~~~ BLUR ~~");
		resetAll();
	}
}
var input = null;

function movePlayer(direction) {
	if (player().room == null || !Object.keys(room).includes(player().room)) {
		return; // player room is missing or invalid.. can't move them!
	}

	var spr = null;

	if ( curPlayerDirection == Direction.Left && !(spr = getSpriteLeft()) && !isWallLeft()) {
		player().x -= 1;
		didPlayerMoveThisFrame = true;
	}
	else if ( curPlayerDirection == Direction.Right && !(spr = getSpriteRight()) && !isWallRight()) {
		player().x += 1;
		didPlayerMoveThisFrame = true;
	}
	else if ( curPlayerDirection == Direction.Up && !(spr = getSpriteUp()) && !isWallUp()) {
		player().y -= 1;
		didPlayerMoveThisFrame = true;
	}
	else if ( curPlayerDirection == Direction.Down && !(spr = getSpriteDown()) && !isWallDown()) {
		player().y += 1;
		didPlayerMoveThisFrame = true;
	}
	
	var ext = getExit( player().room, player().x, player().y );
	var end = getEnding( player().room, player().x, player().y );
	// TODO : vNext
	// var eff = getEffect( player().room, player().x, player().y );
	var itmIndex = getItemIndex( player().room, player().x, player().y );

	// do items first, because you can pick up an item AND go through a door
	if (itmIndex > -1) {
		// TODO pick up items (what about touch?)
		// console.log("HIT ITM ");
		// console.log( itmIndex );
		var itm = room[ player().room ].items[ itmIndex ];
		// console.log(itm);
		room[ player().room ].items.splice( itmIndex, 1 );
		if( player().inventory[ itm.id ] )
			player().inventory[ itm.id ] += 1;
		else
			player().inventory[ itm.id ] = 1;

		if(onInventoryChanged != null)
			onInventoryChanged( itm.id );

		startItemDialog( itm.id  /*itemId*/ );

		// console.log( player().inventory );
	}

	if (end) {
		startNarrating( ending[end.id], true /*isEnding*/ );
	}
	else if (ext) {
		movePlayerThroughExit(ext);
	}
	// TODO : vNext
	// else if (eff) {
	// 	startDialog( script[eff.id].source, eff.id );
	// }
	else if (spr) {
		startSpriteDialog( spr /*spriteId*/ );
	}
}

var transition = new TransitionManager();

function movePlayerThroughExit(ext) {
	var GoToDest = function() {
		if (ext.transition_effect != null) {
			transition.BeginTransition(player().room, player().x, player().y, ext.dest.room, ext.dest.x, ext.dest.y, ext.transition_effect);
			transition.UpdateTransition(0);
		}

		player().room = ext.dest.room;
		player().x = ext.dest.x;
		player().y = ext.dest.y;
		curRoom = ext.dest.room;
	};

	// TODO : vNext
	// if(ext.script_id != null && script[ext.script_id]){
	// 	var scriptSourceStr = script[ext.script_id].source;
	// 	startDialog(scriptSourceStr, ext.script_id, function(isExitUnlocked) {
	// 		if (isExitUnlocked == true) {
	// 			GoToDest();
	// 		}
	// 	});
	// }
	// else {
	// 	GoToDest();
	// }

	GoToDest();
}

function getItemIndex( roomId, x, y ) {
	for( var i = 0; i < room[roomId].items.length; i++ ) {
		var itm = room[roomId].items[i];
		if ( itm.x == x && itm.y == y)
			return i;
	}
	return -1;
}

function getSpriteLeft() { //repetitive?
	return getSpriteAt( player().x - 1, player().y );
}

function getSpriteRight() {
	return getSpriteAt( player().x + 1, player().y );
}

function getSpriteUp() {
	return getSpriteAt( player().x, player().y - 1 );
}

function getSpriteDown() {
	return getSpriteAt( player().x, player().y + 1 );
}

function isWallLeft() {
	return (player().x - 1 < 0) || isWall( player().x - 1, player().y );
}

function isWallRight() {
	return (player().x + 1 >= 16) || isWall( player().x + 1, player().y );
}

function isWallUp() {
	return (player().y - 1 < 0) || isWall( player().x, player().y - 1 );
}

function isWallDown() {
	return (player().y + 1 >= 16) || isWall( player().x, player().y + 1 );
}

function isWall(x,y,roomId) {
	if(roomId == undefined || roomId == null)
		roomId = curRoom;

	var tileId = getTile( x, y );

	if( tileId === '0' )
		return false; // Blank spaces aren't walls, ya doofus

	if( tile[tileId].isWall === undefined || tile[tileId].isWall === null ) {
		// No wall-state defined: check room-specific walls
		var i = room[roomId].walls.indexOf( getTile(x,y) );
		return i > -1;
	}

	// Otherwise, use the tile's own wall-state
	return tile[tileId].isWall;
}

function getItem(roomId,x,y) {
	for (i in room[roomId].items) {
		var item = room[roomId].items[i];
		if (x == item.x && y == item.y) {
			return item;
		}
	}
	return null;
}

function getExit(roomId,x,y) {
	for (i in room[roomId].exits) {
		var e = room[roomId].exits[i];
		if (x == e.x && y == e.y) {
			return e;
		}
	}
	return null;
}

function getEnding(roomId,x,y) {
	for (i in room[roomId].endings) {
		var e = room[roomId].endings[i];
		if (x == e.x && y == e.y) {
			return e;
		}
	}
	return null;
}

// TODO : vNext
// function getEffect(roomId,x,y) {
// 	for (i in room[roomId].effects) {
// 		var e = room[roomId].effects[i];
// 		if (x == e.x && y == e.y) {
// 			return e;
// 		}
// 	}
// 	return null;
// }

function getTile(x,y) {
	// console.log(x + " " + y);
	var t = getRoom().tilemap[y][x];
	return t;
}

function player() {
	return sprite[playerId];
}

// Sort of a hack for legacy palette code (when it was just an array)
function getPal(id) {
	return palette[ id ].colors;
}

function getRoom() {
	return room[curRoom];
}

function isSpriteOffstage(id) {
	return sprite[id].room == null;
}

function parseWorld(file) {
	// console.log("~~~ PARSE WORLD ~~~");
	// console.log(file);

	// var parseTimer = new Timer();

	spriteStartLocations = {};

	resetFlags();

	var versionNumber = 0;

	var lines = file.split("\n");
	var i = 0;
	while (i < lines.length) {
		var curLine = lines[i];

		// console.log(lines[i]);

		if (i == 0) {
			i = parseTitle(lines, i);
		}
		else if (curLine.length <= 0 || curLine.charAt(0) === "#") {
			// collect version number (from a comment.. hacky I know)
			if (curLine.indexOf("# BITSY VERSION ") != -1) {
				versionNumber = parseFloat(curLine.replace("# BITSY VERSION ", ""));
			}

			//skip blank lines & comments
			i++;
		}
		else if (getType(curLine) == "PAL") {
			i = parsePalette(lines, i);
		}
		else if (getType(curLine) === "ROOM" || getType(curLine) === "SET") { //SET for back compat
			i = parseRoom(lines, i);
		}
		else if (getType(curLine) === "TIL") {
			i = parseTile(lines, i);
		}
		else if (getType(curLine) === "SPR") {
			i = parseSprite(lines, i);
		}
		else if (getType(curLine) === "ITM") {
			i = parseItem(lines, i);
		}
		else if (getType(curLine) === "DRW") {
			i = parseDrawing(lines, i);
		}
		else if (getType(curLine) === "DLG") {
			i = parseDialog(lines, i);
		}
		else if (getType(curLine) === "END") {
			i = parseEnding(lines, i);
		}
		// TODO: vNext
		// else if (getType(curLine) === "PRG") {
		// 	i = parseScript(lines, i);
		// }
		else if (getType(curLine) === "VAR") {
			i = parseVariable(lines, i);
		}
		else if (getType(curLine) === "DEFAULT_FONT") {
			i = parseFontName(lines, i);
		}
		else if (getType(curLine) === "TEXT_DIRECTION") {
			i = parseTextDirection(lines, i);
		}
		else if (getType(curLine) === "FONT") {
			i = parseFontData(lines, i);
		}
		else if (getType(curLine) === "!") {
			i = parseFlag(lines, i);
		}
		else {
			i++;
		}
	}

	placeSprites();

	var roomIds = Object.keys(room);
	if (player() != undefined && player().room != null && roomIds.includes(player().room)) {
		// player has valid room
		curRoom = player().room;
	}
	else if (roomIds.length > 0) {
		// player not in any room! what the heck
		curRoom = roomIds[0];
	}
	else {
		// uh oh there are no rooms I guess???
		curRoom = null;
	}

	console.log("START ROOM " + curRoom);

	renderer.SetPalettes(palette);

	// console.log(names);

	// console.log("~~~~~ PARSE TIME " + parseTimer.Milliseconds());

	return versionNumber;
}

//TODO this is in progress and doesn't support all features
function serializeWorld(skipFonts) {
	if (skipFonts === undefined || skipFonts === null)
		skipFonts = false;

	var worldStr = "";
	/* TITLE */
	worldStr += title + "\n";
	worldStr += "\n";
	/* VERSION */
	worldStr += "# BITSY VERSION " + getEngineVersion() + "\n"; // add version as a comment for debugging purposes
	worldStr += "\n";
	/* FLAGS */
	for (f in flags) {
		worldStr += "! " + f + " " + flags[f] + "\n";
	}
	worldStr += "\n"
	/* FONT */
	if (fontName != defaultFontName) {
		worldStr += "DEFAULT_FONT " + fontName + "\n";
		worldStr += "\n"
	}
	if (textDirection != TextDirection.LeftToRight) {
		worldStr += "TEXT_DIRECTION " + textDirection + "\n";
		worldStr += "\n"
	}
	/* PALETTE */
	for (id in palette) {
		worldStr += "PAL " + id + "\n";
		if( palette[id].name != null )
			worldStr += "NAME " + palette[id].name + "\n";
		for (i in getPal(id)) {
			for (j in getPal(id)[i]) {
				worldStr += getPal(id)[i][j];
				if (j < 2) worldStr += ",";
			}
			worldStr += "\n";
		}
		worldStr += "\n";
	}
	/* ROOM */
	for (id in room) {
		worldStr += "ROOM " + id + "\n";
		if ( flags.ROOM_FORMAT == 0 ) {
			// old non-comma separated format
			for (i in room[id].tilemap) {
				for (j in room[id].tilemap[i]) {
					worldStr += room[id].tilemap[i][j];	
				}
				worldStr += "\n";
			}
		}
		else if ( flags.ROOM_FORMAT == 1 ) {
			// new comma separated format
			for (i in room[id].tilemap) {
				for (j in room[id].tilemap[i]) {
					worldStr += room[id].tilemap[i][j];
					if (j < room[id].tilemap[i].length-1) worldStr += ","
				}
				worldStr += "\n";
			}
		}
		if (room[id].name != null) {
			/* NAME */
			worldStr += "NAME " + room[id].name + "\n";
		}
		if (room[id].walls.length > 0) {
			/* WALLS */
			worldStr += "WAL ";
			for (j in room[id].walls) {
				worldStr += room[id].walls[j];
				if (j < room[id].walls.length-1) {
					worldStr += ",";
				}
			}
			worldStr += "\n";
		}
		if (room[id].items.length > 0) {
			/* ITEMS */
			for (j in room[id].items) {
				var itm = room[id].items[j];
				worldStr += "ITM " + itm.id + " " + itm.x + "," + itm.y;
				worldStr += "\n";
			}
		}
		if (room[id].exits.length > 0) {
			/* EXITS */
			for (j in room[id].exits) {
				var e = room[id].exits[j];
				if ( isExitValid(e) ) {
					worldStr += "EXT " + e.x + "," + e.y + " " + e.dest.room + " " + e.dest.x + "," + e.dest.y;
					if (e.transition_effect != undefined && e.transition_effect != null) {
						worldStr += " FX " + e.transition_effect;
					}
					// TODO : vNext
					// if (e.script_id != undefined && e.script_id != null) {
					// 	worldStr += " PRG " + e.script_id;
					// }
					worldStr += "\n";
				}
			}
		}
		if (room[id].endings.length > 0) {
			/* ENDINGS */
			for (j in room[id].endings) {
				var e = room[id].endings[j];
				// todo isEndingValid
				worldStr += "END " + e.id + " " + e.x + "," + e.y;
				worldStr += "\n";
			}
		}
		// TODO : vNext
		// if (room[id].effects.length > 0) {
		// 	/* EFFECTS */
		// 	for (j in room[id].effects) {
		// 		var e = room[id].effects[j];
		// 		worldStr += "EFF " + e.id + " " + e.x + "," + e.y;
		// 		worldStr += "\n";
		// 	}
		// }
		if (room[id].pal != null) {
			/* PALETTE */
			worldStr += "PAL " + room[id].pal + "\n";
		}
		worldStr += "\n";
	}
	/* TILES */
	for (id in tile) {
		worldStr += "TIL " + id + "\n";
		worldStr += serializeDrawing( "TIL_" + id );
		if (tile[id].name != null && tile[id].name != undefined) {
			/* NAME */
			worldStr += "NAME " + tile[id].name + "\n";
		}
		if (tile[id].isWall != null && tile[id].isWall != undefined) {
			/* WALL */
			worldStr += "WAL " + tile[id].isWall + "\n";
		}
		if (tile[id].col != null && tile[id].col != undefined && tile[id].col != 1) {
			/* COLOR OVERRIDE */
			worldStr += "COL " + tile[id].col + "\n";
		}
		worldStr += "\n";
	}
	/* SPRITES */
	for (id in sprite) {
		worldStr += "SPR " + id + "\n";
		worldStr += serializeDrawing( "SPR_" + id );
		if (sprite[id].name != null && sprite[id].name != undefined) {
			/* NAME */
			worldStr += "NAME " + sprite[id].name + "\n";
		}
		if (sprite[id].dlg != null) {
			worldStr += "DLG " + sprite[id].dlg + "\n";
		}
		if (sprite[id].room != null) {
			/* SPRITE POSITION */
			worldStr += "POS " + sprite[id].room + " " + sprite[id].x + "," + sprite[id].y + "\n";
		}
		if (sprite[id].inventory != null) {
			for(itemId in sprite[id].inventory) {
				worldStr += "ITM " + itemId + " " + sprite[id].inventory[itemId] + "\n";
			}
		}
		if (sprite[id].col != null && sprite[id].col != undefined && sprite[id].col != 2) {
			/* COLOR OVERRIDE */
			worldStr += "COL " + sprite[id].col + "\n";
		}
		worldStr += "\n";
	}
	/* ITEMS */
	for (id in item) {
		worldStr += "ITM " + id + "\n";
		worldStr += serializeDrawing( "ITM_" + id );
		if (item[id].name != null && item[id].name != undefined) {
			/* NAME */
			worldStr += "NAME " + item[id].name + "\n";
		}
		if (item[id].dlg != null) {
			worldStr += "DLG " + item[id].dlg + "\n";
		}
		if (item[id].col != null && item[id].col != undefined && item[id].col != 2) {
			/* COLOR OVERRIDE */
			worldStr += "COL " + item[id].col + "\n";
		}
		worldStr += "\n";
	}
	/* DIALOG */
	for (id in dialog) {
		worldStr += "DLG " + id + "\n";
		worldStr += dialog[id] + "\n";
		worldStr += "\n";
	}
	/* ENDINGS */
	for (id in ending) {
		worldStr += "END " + id + "\n";
		worldStr += ending[id] + "\n";
		worldStr += "\n";
	}
	// TODO : vNext
	// /* SCRIPTS */
	// for (id in script) {
	// 	if (script[id].type == ScriptType.Dialogue) {
	// 		worldStr += "DLG " + id + "\n";
	// 	}
	// 	else if (script[id].type == ScriptType.Ending) {
	// 		worldStr += "END " + id + "\n";
	// 	}
	// 	else {
	// 		worldStr += "PRG " + id + "\n";
	// 	}
	// 	worldStr += script[id].source + "\n";
	// 	worldStr += "\n";
	// }
	/* VARIABLES */
	for (id in variable) {
		worldStr += "VAR " + id + "\n";
		worldStr += variable[id] + "\n";
		worldStr += "\n";
	}
	/* FONT */
	// TODO : support multiple fonts
	if (fontName != defaultFontName && !skipFonts) {
		worldStr += fontManager.GetData(fontName);
	}

	return worldStr;
}

function serializeDrawing(drwId) {
	var imageSource = renderer.GetImageSource(drwId);
	var drwStr = "";
	for (f in imageSource) {
		for (y in imageSource[f]) {
			var rowStr = "";
			for (x in imageSource[f][y]) {
				rowStr += imageSource[f][y][x];
			}
			drwStr += rowStr + "\n";
		}
		if (f < (imageSource.length-1)) drwStr += ">\n";
	}
	return drwStr;
}

function isExitValid(e) {
	var hasValidStartPos = e.x >= 0 && e.x < 16 && e.y >= 0 && e.y < 16;
	var hasDest = e.dest != null;
	var hasValidRoomDest = (e.dest.room != null && e.dest.x >= 0 && e.dest.x < 16 && e.dest.y >= 0 && e.dest.y < 16);
	return hasValidStartPos && hasDest && hasValidRoomDest;
}

function placeSprites() {
	for (id in spriteStartLocations) {
		//console.log(id);
		//console.log( spriteStartLocations[id] );
		//console.log(sprite[id]);
		sprite[id].room = spriteStartLocations[id].room;
		sprite[id].x = spriteStartLocations[id].x;
		sprite[id].y = spriteStartLocations[id].y;
		//console.log(sprite[id]);
	}
}

/* ARGUMENT GETTERS */
function getType(line) {
	return getArg(line,0);
}

function getId(line) {
	return getArg(line,1);
}

function getArg(line,arg) {
	return line.split(" ")[arg];
}

function getCoord(line,arg) {
	return getArg(line,arg).split(",");
}

function parseTitle(lines, i) {
	title = lines[i];
	i++;
	return i;
}

function parseRoom(lines, i) {
	var id = getId(lines[i]);
	room[id] = {
		id : id,
		tilemap : [],
		walls : [],
		exits : [],
		endings : [],
		// effects : [], // TODO vNext
		items : [],
		pal : null,
		name : null
	};
	i++;

	// create tile map
	if ( flags.ROOM_FORMAT == 0 ) {
		// old way: no commas, single char tile ids
		var end = i + mapsize;
		var y = 0;
		for (; i<end; i++) {
			room[id].tilemap.push( [] );
			for (x = 0; x<mapsize; x++) {
				room[id].tilemap[y].push( lines[i].charAt(x) );
			}
			y++;
		}
	}
	else if ( flags.ROOM_FORMAT == 1 ) {
		// new way: comma separated, multiple char tile ids
		var end = i + mapsize;
		var y = 0;
		for (; i<end; i++) {
			room[id].tilemap.push( [] );
			var lineSep = lines[i].split(",");
			for (x = 0; x<mapsize; x++) {
				room[id].tilemap[y].push( lineSep[x] );
			}
			y++;
		}
	}

	while (i < lines.length && lines[i].length > 0) { //look for empty line
		// console.log(getType(lines[i]));
		if (getType(lines[i]) === "SPR") {
			/* NOTE SPRITE START LOCATIONS */
			var sprId = getId(lines[i]);
			if (sprId.indexOf(",") == -1 && lines[i].split(" ").length >= 3) { //second conditional checks for coords
				/* PLACE A SINGLE SPRITE */
				var sprCoord = lines[i].split(" ")[2].split(",");
				spriteStartLocations[sprId] = {
					room : id,
					x : parseInt(sprCoord[0]),
					y : parseInt(sprCoord[1])
				};
			}
			else if ( flags.ROOM_FORMAT == 0 ) { // TODO: right now this shortcut only works w/ the old comma separate format
				/* PLACE MULTIPLE SPRITES*/ 
				//Does find and replace in the tilemap (may be hacky, but its convenient)
				var sprList = sprId.split(",");
				for (row in room[id].tilemap) {
					for (s in sprList) {
						var col = room[id].tilemap[row].indexOf( sprList[s] );
						//if the sprite is in this row, replace it with the "null tile" and set its starting position
						if (col != -1) {
							room[id].tilemap[row][col] = "0";
							spriteStartLocations[ sprList[s] ] = {
								room : id,
								x : parseInt(col),
								y : parseInt(row)
							};
						}
					}
				}
			}
		}
		else if (getType(lines[i]) === "ITM") {
			var itmId = getId(lines[i]);
			var itmCoord = lines[i].split(" ")[2].split(",");
			var itm = {
				id: itmId,
				x : parseInt(itmCoord[0]),
				y : parseInt(itmCoord[1])
			};
			room[id].items.push( itm );
		}
		else if (getType(lines[i]) === "WAL") {
			/* DEFINE COLLISIONS (WALLS) */
			room[id].walls = getId(lines[i]).split(",");
		}
		else if (getType(lines[i]) === "EXT") {
			/* ADD EXIT */
			var exitArgs = lines[i].split(" ");
			//arg format: EXT 10,5 M 3,2 [AVA:7 LCK:a,9] [AVA 7 LCK a 9]
			var exitCoords = exitArgs[1].split(",");
			var destName = exitArgs[2];
			var destCoords = exitArgs[3].split(",");
			var ext = {
				x : parseInt(exitCoords[0]),
				y : parseInt(exitCoords[1]),
				dest : {
					room : destName,
					x : parseInt(destCoords[0]),
					y : parseInt(destCoords[1])
				},
				transition_effect : null,
				// TODO : vNext
				// script_id : null,
			};

			// optional arguments
			var exitArgIndex = 4;
			while (exitArgIndex < exitArgs.length) {
				if (exitArgs[exitArgIndex] == "FX") {
					ext.transition_effect = exitArgs[exitArgIndex+1];
					exitArgIndex += 2;
				}
				// TODO : vNext
				// else if (exitArgs[exitArgIndex] == "PRG") {
				// 	ext.script_id = exitArgs[exitArgIndex+1];
				// 	exitArgIndex += 2;
				// }
				else {
					exitArgIndex += 1;
				}
			}

			room[id].exits.push(ext);
		}
		else if (getType(lines[i]) === "END") {
			/* ADD ENDING */
			var endId = getId( lines[i] );
			var endCoords = getCoord( lines[i], 2 );
			var end = {
				id : endId,
				x : parseInt( endCoords[0] ),
				y : parseInt( endCoords[1] )
			};
			room[id].endings.push(end);
		}
		// TODO : vNext
		// else if (getType(lines[i]) === "EFF") {
		// 	/* ADD EFFECT */
		// 	var effectId = getId( lines[i] );
		// 	var effectCoords = getCoord( lines[i], 2 );
		// 	var effect = {
		// 		id : effectId,
		// 		x : parseInt( effectCoords[0] ),
		// 		y : parseInt( effectCoords[1] ),
		// 	};
		// 	room[id].effects.push(effect);
		// }
		else if (getType(lines[i]) === "PAL") {
			/* CHOOSE PALETTE (that's not default) */
			room[id].pal = getId(lines[i]);
		}
		else if (getType(lines[i]) === "NAME") {
			var name = lines[i].split(/\s(.+)/)[1];
			room[id].name = name;
			names.room.set( name, id);
		}
		i++;
	}
	return i;
}

function parsePalette(lines,i) { //todo this has to go first right now :(
	var id = getId(lines[i]);
	i++;
	var colors = [];
	var name = null;
	while (i < lines.length && lines[i].length > 0) { //look for empty line
		var args = lines[i].split(" ");
		if(args[0] === "NAME") {
			name = lines[i].split(/\s(.+)/)[1];
		}
		else {
			var col = [];
			lines[i].split(",").forEach(function(i) {
				col.push(parseInt(i));
			});
			colors.push(col);
		}
		i++;
	}
	palette[id] = {
		id : id,
		name : name,
		colors : colors
	};
	return i;
}

function parseTile(lines, i) {
	var id = getId(lines[i]);
	var drwId = null;
	var name = null;

	i++;

	if (getType(lines[i]) === "DRW") { //load existing drawing
		drwId = getId(lines[i]);
		i++;
	}
	else {
		// store tile source
		drwId = "TIL_" + id;
		i = parseDrawingCore( lines, i, drwId );
	}

	//other properties
	var colorIndex = 1; // default palette color index is 1
	var isWall = null; // null indicates it can vary from room to room (original version)
	while (i < lines.length && lines[i].length > 0) { //look for empty line
		if (getType(lines[i]) === "COL") {
			colorIndex = parseInt( getId(lines[i]) );
		}
		else if (getType(lines[i]) === "NAME") {
			/* NAME */
			name = lines[i].split(/\s(.+)/)[1];
			names.tile.set( name, id );
		}
		else if (getType(lines[i]) === "WAL") {
			var wallArg = getArg( lines[i], 1 );
			if( wallArg === "true" ) {
				isWall = true;
			}
			else if( wallArg === "false" ) {
				isWall = false;
			}
		}
		i++;
	}

	//tile data
	tile[id] = {
		id : id,
		drw : drwId, //drawing id
		col : colorIndex,
		animation : {
			isAnimated : (renderer.GetFrameCount(drwId) > 1),
			frameIndex : 0,
			frameCount : renderer.GetFrameCount(drwId)
		},
		name : name,
		isWall : isWall
	};

	return i;
}

function parseSprite(lines, i) {
	var id = getId(lines[i]);
	var drwId = null;
	var name = null;

	i++;

	if (getType(lines[i]) === "DRW") { //load existing drawing
		drwId = getId(lines[i]);
		i++;
	}
	else {
		// store sprite source
		drwId = "SPR_" + id;
		i = parseDrawingCore( lines, i, drwId );
	}

	//other properties
	var colorIndex = 2; //default palette color index is 2
	var dialogId = null;
	var startingInventory = {};
	while (i < lines.length && lines[i].length > 0) { //look for empty line
		if (getType(lines[i]) === "COL") {
			/* COLOR OFFSET INDEX */
			colorIndex = parseInt( getId(lines[i]) );
		}
		else if (getType(lines[i]) === "POS") {
			/* STARTING POSITION */
			var posArgs = lines[i].split(" ");
			var roomId = posArgs[1];
			var coordArgs = posArgs[2].split(",");
			spriteStartLocations[id] = {
				room : roomId,
				x : parseInt(coordArgs[0]),
				y : parseInt(coordArgs[1])
			};
		}
		else if(getType(lines[i]) === "DLG") {
			dialogId = getId(lines[i]);
		}
		else if (getType(lines[i]) === "NAME") {
			/* NAME */
			name = lines[i].split(/\s(.+)/)[1];
			names.sprite.set( name, id );
		}
		else if (getType(lines[i]) === "ITM") {
			/* ITEM STARTING INVENTORY */
			var itemId = getId(lines[i]);
			var itemCount = parseFloat( getArg(lines[i], 2) );
			startingInventory[itemId] = itemCount;
		}
		i++;
	}

	//sprite data
	sprite[id] = {
		id : id,
		drw : drwId, //drawing id
		col : colorIndex,
		dlg : dialogId,
		room : null, //default location is "offstage"
		x : -1,
		y : -1,
		walkingPath : [], //tile by tile movement path (isn't saved)
		animation : {
			isAnimated : (renderer.GetFrameCount(drwId) > 1),
			frameIndex : 0,
			frameCount : renderer.GetFrameCount(drwId)
		},
		inventory : startingInventory,
		name : name
	};
	return i;
}

function parseItem(lines, i) {
	var id = getId(lines[i]);
	var drwId = null;
	var name = null;

	i++;

	if (getType(lines[i]) === "DRW") { //load existing drawing
		drwId = getId(lines[i]);
		i++;
	}
	else {
		// store item source
		drwId = "ITM_" + id; // these prefixes are maybe a terrible way to differentiate drawing tyepes :/
		i = parseDrawingCore( lines, i, drwId );
	}

	//other properties
	var colorIndex = 2; //default palette color index is 2
	var dialogId = null;
	while (i < lines.length && lines[i].length > 0) { //look for empty line
		if (getType(lines[i]) === "COL") {
			/* COLOR OFFSET INDEX */
			colorIndex = parseInt( getArg( lines[i], 1 ) );
		}
		// else if (getType(lines[i]) === "POS") {
		// 	/* STARTING POSITION */
		// 	var posArgs = lines[i].split(" ");
		// 	var roomId = posArgs[1];
		// 	var coordArgs = posArgs[2].split(",");
		// 	spriteStartLocations[id] = {
		// 		room : roomId,
		// 		x : parseInt(coordArgs[0]),
		// 		y : parseInt(coordArgs[1])
		// 	};
		// }
		else if(getType(lines[i]) === "DLG") {
			dialogId = getId(lines[i]);
		}
		else if (getType(lines[i]) === "NAME") {
			/* NAME */
			name = lines[i].split(/\s(.+)/)[1];
			names.item.set( name, id );
		}
		i++;
	}

	//item data
	item[id] = {
		id : id,
		drw : drwId, //drawing id
		col : colorIndex,
		dlg : dialogId,
		// room : null, //default location is "offstage"
		// x : -1,
		// y : -1,
		animation : {
			isAnimated : (renderer.GetFrameCount(drwId) > 1),
			frameIndex : 0,
			frameCount : renderer.GetFrameCount(drwId)
		},
		name : name
	};

	// console.log("ITM " + id);
	// console.log(item[id]);

	return i;
}

function parseDrawing(lines, i) {
	// store drawing source
	var drwId = getId( lines[i] );
	return parseDrawingCore( lines, i, drwId );
}

function parseDrawingCore(lines, i, drwId) {
	var frameList = []; //init list of frames
	frameList.push( [] ); //init first frame
	var frameIndex = 0;
	var y = 0;
	while ( y < tilesize ) {
		var l = lines[i+y];
		var row = [];
		for (x = 0; x < tilesize; x++) {
			row.push( parseInt( l.charAt(x) ) );
		}
		frameList[frameIndex].push( row );
		y++;

		if (y === tilesize) {
			i = i + y;
			if ( lines[i] != undefined && lines[i].charAt(0) === ">" ) {
				// start next frame!
				frameList.push( [] );
				frameIndex++;
				//start the count over again for the next frame
				i++;
				y = 0;
			}
		}
	}

	renderer.SetImageSource(drwId, frameList);

	return i;
}

// TODO : vNext
// var ScriptType = {
// 	Script : 0,
// 	Dialogue : 1, // TODO : move everything to this spelling?
// 	Ending : 2,
// };

function parseScript(lines, i, objectStore) {
	// TODO : vNext
	// if (scriptType === undefined || scriptType === null) {
	// 	scriptType = ScriptType.Script;
	// }

	var id = getId(lines[i]);
	i++;

	var results = scriptUtils.ReadDialogScript(lines,i);

	// TODO : vNext
	// script[id] = {
	// 	source: results.script,
	// 	type: scriptType,
	// };

	objectStore[id] = results.script;

	i = results.index;

	return i;
}

function parseDialog(lines, i) {
	return parseScript(lines, i, dialog);
}

function parseEnding(lines, i) {
	return parseScript(lines, i, ending);
}

function parseVariable(lines, i) {
	var id = getId(lines[i]);
	i++;
	var value = lines[i];
	i++;
	variable[id] = value;
	return i;
}

function parseFontName(lines, i) {
	fontName = getArg(lines[i], 1);
	i++;
	return i;
}

function parseTextDirection(lines, i) {
	textDirection = getArg(lines[i], 1);
	i++;
	return i;
}

function parseFontData(lines, i) {
	// NOTE : we're not doing the actual parsing here --
	// just grabbing the block of text that represents the font
	// and giving it to the font manager to use later

	var localFontName = getId(lines[i]);
	var localFontData = lines[i];
	i++;

	while (i < lines.length && lines[i] != "") {
		localFontData += "\n" + lines[i];
		i++;
	}

	var localFontFilename = localFontName + fontManager.GetExtension();
	fontManager.AddResource( localFontFilename, localFontData );

	return i;
}

function parseFlag(lines, i) {
	var id = getId(lines[i]);
	var valStr = lines[i].split(" ")[2];
	flags[id] = parseInt( valStr );
	i++;
	return i;
}

function drawTile(img,x,y,context) {
	if (!context) { //optional pass in context; otherwise, use default
		context = ctx;
	}
	// NOTE: images are now canvases, instead of raw image data (for chrome performance reasons)
	context.drawImage(img,x*tilesize*scale,y*tilesize*scale,tilesize*scale,tilesize*scale);
}

function drawSprite(img,x,y,context) { //this may differ later (or not haha)
	drawTile(img,x,y,context);
}

function drawItem(img,x,y,context) {
	drawTile(img,x,y,context); //TODO these methods are dumb and repetitive
}

// var debugLastRoomDrawn = "0";

function drawRoom(room,context,frameIndex) { // context & frameIndex are optional
	if (!context) { //optional pass in context; otherwise, use default (ok this is REAL hacky isn't it)
		context = ctx;
	}

	// if (room.id != debugLastRoomDrawn) {
	// 	debugLastRoomDrawn = room.id;
	// 	console.log("DRAW ROOM " + debugLastRoomDrawn);
	// }

	if (room === undefined) {
		// protect against invalid rooms -- but it assumes there is a "0" pal
		context.fillStyle = "rgb(" + getPal("0")[0][0] + "," + getPal("0")[0][1] + "," + getPal("0")[0][2] + ")";
		context.fillRect(0,0,canvas.width,canvas.height);
		return;
	}

	//clear screen
	context.fillStyle = "rgb(" + getPal(room.pal)[0][0] + "," + getPal(room.pal)[0][1] + "," + getPal(room.pal)[0][2] + ")";
	context.fillRect(0,0,canvas.width,canvas.height);

	//draw tiles
	for (i in room.tilemap) {
		for (j in room.tilemap[i]) {
			var id = room.tilemap[i][j];
			if (id != "0") {
				//console.log(id);
				if (tile[id] == null) { // hack-around to avoid corrupting files (not a solution though!)
					id = "0";
					room.tilemap[i][j] = id;
				}
				else {
					// console.log(id);
					drawTile( getTileImage(tile[id],getRoomPal(room.id),frameIndex), j, i, context );
				}
			}
		}
	}

	//draw items
	for (var i = 0; i < room.items.length; i++) {
		var itm = room.items[i];
		drawItem( getItemImage(item[itm.id],getRoomPal(room.id),frameIndex), itm.x, itm.y, context );
	}

	//draw sprites
	for (id in sprite) {
		var spr = sprite[id];
		if (spr.room === room.id) {
			drawSprite( getSpriteImage(spr,getRoomPal(room.id),frameIndex), spr.x, spr.y, context );
		}
	}
}

// TODO : remove these get*Image methods
function getTileImage(t,palId,frameIndex) {
	return renderer.GetImage(t,palId,frameIndex);
}

function getSpriteImage(s,palId,frameIndex) {
	return renderer.GetImage(s,palId,frameIndex);
}

function getItemImage(itm,palId,frameIndex) {
	return renderer.GetImage(itm,palId,frameIndex);
}

function curPal() {
	return getRoomPal(curRoom);
}

function getRoomPal(roomId) {
	if (roomId == null) {
		return "0";
	}
	else if (room[roomId].pal != null) {
		//a specific palette was chosen
		return room[roomId].pal;
	}
	else {
		if (roomId in palette) {
			//there is a palette matching the name of the room
			return roomId;
		}
		else {
			//use the default palette
			return "0";
		}
	}
	return "0";	
}

var isDialogMode = false;
var isNarrating = false;
var isEnding = false;
var dialogModule = new Dialog();
var dialogRenderer = dialogModule.CreateRenderer();
var dialogBuffer = dialogModule.CreateBuffer();
var fontManager = new FontManager();

function onExitDialog(scriptResult, dialogCallback) {
	isDialogMode = false;
	if (isNarrating) isNarrating = false;
	if (isDialogPreview) {
		isDialogPreview = false;
		if (onDialogPreviewEnd != null)
			onDialogPreviewEnd();
	}

	if (dialogCallback != undefined && dialogCallback != null) {
		dialogCallback(scriptResult);
	}
}

/*
TODO
- titles and endings should also take advantage of the script pre-compilation if possible??
- could there be a namespace collision?
- what about dialog NAMEs vs IDs?
- what about a special script block separate from DLG?
*/
function startNarrating(dialogStr,end) {
	console.log("NARRATE " + dialogStr);

	if(end === undefined) end = false;

	isNarrating = true;
	isEnding = end;
	startDialog(dialogStr);
}

function startItemDialog(itemId) {
	var dialogId = item[itemId].dlg;
	// console.log("START ITEM DIALOG " + dialogId);
	if(dialog[dialogId]){
		var dialogStr = dialog[dialogId];
		startDialog(dialogStr,dialogId);
	}
}

function startSpriteDialog(spriteId) {
	var spr = sprite[spriteId];
	var dialogId = spr.dlg ? spr.dlg : spriteId;
	// console.log("START SPRITE DIALOG " + dialogId);
	if(dialog[dialogId]){
		var dialogStr = dialog[dialogId];
		startDialog(dialogStr,dialogId);
	}
}

function startDialog(dialogStr,scriptId,dialogCallback) {
	// console.log("START DIALOG ");
	if(dialogStr.length <= 0) {
		// console.log("ON EXIT DIALOG -- startDialog 1");
		onExitDialog(dialogCallback);
		return;
	}

	isDialogMode = true;

	dialogRenderer.Reset();
	dialogRenderer.SetCentered( isNarrating /*centered*/ );
	dialogBuffer.Reset();
	scriptInterpreter.SetDialogBuffer( dialogBuffer );

	var onScriptEnd = function(scriptResult) {
		dialogBuffer.OnDialogEnd(function() {
			onExitDialog(scriptResult, dialogCallback);
		});
	};

	if(scriptId === undefined) {
		scriptInterpreter.Interpret( dialogStr, onScriptEnd );
	}
	else {
		if( !scriptInterpreter.HasScript(scriptId) ) {
			scriptInterpreter.Compile( scriptId, dialogStr );
		}
		scriptInterpreter.DebugVisualizeScriptTree(scriptId);
		scriptInterpreter.Run( scriptId, onScriptEnd );
	}

}

var isDialogPreview = false;
function startPreviewDialog(script, onScriptEnd) {
	isNarrating = true;

	isDialogMode = true;

	isDialogPreview = true;

	dialogRenderer.Reset();
	dialogRenderer.SetCentered( true );
	dialogBuffer.Reset();
	scriptInterpreter.SetDialogBuffer( dialogBuffer );

	onDialogPreviewEnd = onScriptEnd;

	scriptInterpreter.Eval( script, null );
}

/* NEW SCRIPT STUFF */
var scriptModule = new Script();
var scriptInterpreter = scriptModule.CreateInterpreter();
var scriptUtils = scriptModule.CreateUtils(); // TODO: move to editor.js?
// scriptInterpreter.SetDialogBuffer( dialogBuffer );
</script>

<!-- store default font in separate script tag for back compat-->
<script type="bitsyFontData" id="ascii_small">
FONT ascii_small
SIZE 6 8
CHAR 0
000000
000000
000000
000000
000000
000000
000000
000000
CHAR 1
001110
010001
011011
010001
010101
010001
001110
000000
CHAR 2
001110
011111
010101
011111
010001
011111
001110
000000
CHAR 3
000000
001010
011111
011111
011111
001110
000100
000000
CHAR 4
000000
000000
001010
001110
001110
000100
000000
000000
CHAR 5
000100
001110
001110
000100
011111
011111
000100
000000
CHAR 6
000000
000100
001110
011111
011111
000100
001110
000000
CHAR 7
000000
000000
000000
001100
001100
000000
000000
000000
CHAR 8
111111
111111
111111
110011
110011
111111
111111
111111
CHAR 9
000000
000000
011110
010010
010010
011110
000000
000000
CHAR 10
111111
111111
100001
101101
101101
100001
111111
111111
CHAR 11
000000
000111
000011
001101
010010
010010
001100
000000
CHAR 12
001110
010001
010001
001110
000100
001110
000100
000000
CHAR 13
000100
000110
000101
000100
001100
011100
011000
000000
CHAR 14
000011
001101
001011
001101
001011
011011
011000
000000
CHAR 15
000000
010101
001110
011011
001110
010101
000000
000000
CHAR 16
001000
001100
001110
001111
001110
001100
001000
000000
CHAR 17
000010
000110
001110
011110
001110
000110
000010
000000
CHAR 18
000100
001110
011111
000100
011111
001110
000100
000000
CHAR 19
001010
001010
001010
001010
001010
000000
001010
000000
CHAR 20
001111
010101
010101
001101
000101
000101
000101
000000
CHAR 21
001110
010001
001100
001010
000110
010001
001110
000000
CHAR 22
000000
000000
000000
000000
000000
011110
011110
000000
CHAR 23
000100
001110
011111
000100
011111
001110
000100
001110
CHAR 24
000100
001110
011111
000100
000100
000100
000100
000000
CHAR 25
000100
000100
000100
000100
011111
001110
000100
000000
CHAR 26
000000
000100
000110
011111
000110
000100
000000
000000
CHAR 27
000000
000100
001100
011111
001100
000100
000000
000000
CHAR 28
000000
000000
000000
010000
010000
010000
011111
000000
CHAR 29
000000
001010
001010
011111
001010
001010
000000
000000
CHAR 30
000100
000100
001110
001110
011111
011111
000000
000000
CHAR 31
011111
011111
001110
001110
000100
000100
000000
000000
CHAR 32
000000
000000
000000
000000
000000
000000
000000
000000
CHAR 33
000100
001110
001110
000100
000100
000000
000100
000000
CHAR 34
011011
011011
010010
000000
000000
000000
000000
000000
CHAR 35
000000
001010
011111
001010
001010
011111
001010
000000
CHAR 36
001000
001110
010000
001100
000010
011100
000100
000000
CHAR 37
011001
011001
000010
000100
001000
010011
010011
000000
CHAR 38
001000
010100
010100
001000
010101
010010
001101
000000
CHAR 39
001100
001100
001000
000000
000000
000000
000000
000000
CHAR 40
000100
001000
001000
001000
001000
001000
000100
000000
CHAR 41
001000
000100
000100
000100
000100
000100
001000
000000
CHAR 42
000000
001010
001110
011111
001110
001010
000000
000000
CHAR 43
000000
000100
000100
011111
000100
000100
000000
000000
CHAR 44
000000
000000
000000
000000
000000
001100
001100
001000
CHAR 45
000000
000000
000000
011111
000000
000000
000000
000000
CHAR 46
000000
000000
000000
000000
000000
001100
001100
000000
CHAR 47
000000
000001
000010
000100
001000
010000
000000
000000
CHAR 48
001110
010001
010011
010101
011001
010001
001110
000000
CHAR 49
000100
001100
000100
000100
000100
000100
001110
000000
CHAR 50
001110
010001
000001
000110
001000
010000
011111
000000
CHAR 51
001110
010001
000001
001110
000001
010001
001110
000000
CHAR 52
000010
000110
001010
010010
011111
000010
000010
000000
CHAR 53
011111
010000
010000
011110
000001
010001
001110
000000
CHAR 54
000110
001000
010000
011110
010001
010001
001110
000000
CHAR 55
011111
000001
000010
000100
001000
001000
001000
000000
CHAR 56
001110
010001
010001
001110
010001
010001
001110
000000
CHAR 57
001110
010001
010001
001111
000001
000010
001100
000000
CHAR 58
000000
000000
001100
001100
000000
001100
001100
000000
CHAR 59
000000
000000
001100
001100
000000
001100
001100
001000
CHAR 60
000010
000100
001000
010000
001000
000100
000010
000000
CHAR 61
000000
000000
011111
000000
000000
011111
000000
000000
CHAR 62
001000
000100
000010
000001
000010
000100
001000
000000
CHAR 63
001110
010001
000001
000110
000100
000000
000100
000000
CHAR 64
001110
010001
010111
010101
010111
010000
001110
000000
CHAR 65
001110
010001
010001
010001
011111
010001
010001
000000
CHAR 66
011110
010001
010001
011110
010001
010001
011110
000000
CHAR 67
001110
010001
010000
010000
010000
010001
001110
000000
CHAR 68
011110
010001
010001
010001
010001
010001
011110
000000
CHAR 69
011111
010000
010000
011110
010000
010000
011111
000000
CHAR 70
011111
010000
010000
011110
010000
010000
010000
000000
CHAR 71
001110
010001
010000
010111
010001
010001
001111
000000
CHAR 72
010001
010001
010001
011111
010001
010001
010001
000000
CHAR 73
001110
000100
000100
000100
000100
000100
001110
000000
CHAR 74
000001
000001
000001
000001
010001
010001
001110
000000
CHAR 75
010001
010010
010100
011000
010100
010010
010001
000000
CHAR 76
010000
010000
010000
010000
010000
010000
011111
000000
CHAR 77
010001
011011
010101
010001
010001
010001
010001
000000
CHAR 78
010001
011001
010101
010011
010001
010001
010001
000000
CHAR 79
001110
010001
010001
010001
010001
010001
001110
000000
CHAR 80
011110
010001
010001
011110
010000
010000
010000
000000
CHAR 81
001110
010001
010001
010001
010101
010010
001101
000000
CHAR 82
011110
010001
010001
011110
010010
010001
010001
000000
CHAR 83
001110
010001
010000
001110
000001
010001
001110
000000
CHAR 84
011111
000100
000100
000100
000100
000100
000100
000000
CHAR 85
010001
010001
010001
010001
010001
010001
001110
000000
CHAR 86
010001
010001
010001
010001
010001
001010
000100
000000
CHAR 87
010001
010001
010101
010101
010101
010101
001010
000000
CHAR 88
010001
010001
001010
000100
001010
010001
010001
000000
CHAR 89
010001
010001
010001
001010
000100
000100
000100
000000
CHAR 90
011110
000010
000100
001000
010000
010000
011110
000000
CHAR 91
001110
001000
001000
001000
001000
001000
001110
000000
CHAR 92
000000
010000
001000
000100
000010
000001
000000
000000
CHAR 93
001110
000010
000010
000010
000010
000010
001110
000000
CHAR 94
000100
001010
010001
000000
000000
000000
000000
000000
CHAR 95
000000
000000
000000
000000
000000
000000
000000
111111
CHAR 96
001100
001100
000100
000000
000000
000000
000000
000000
CHAR 97
000000
000000
001110
000001
001111
010001
001111
000000
CHAR 98
010000
010000
011110
010001
010001
010001
011110
000000
CHAR 99
000000
000000
001110
010001
010000
010001
001110
000000
CHAR 100
000001
000001
001111
010001
010001
010001
001111
000000
CHAR 101
000000
000000
001110
010001
011110
010000
001110
000000
CHAR 102
000110
001000
001000
011110
001000
001000
001000
000000
CHAR 103
000000
000000
001111
010001
010001
001111
000001
001110
CHAR 104
010000
010000
011100
010010
010010
010010
010010
000000
CHAR 105
000100
000000
000100
000100
000100
000100
000110
000000
CHAR 106
000010
000000
000110
000010
000010
000010
010010
001100
CHAR 107
010000
010000
010010
010100
011000
010100
010010
000000
CHAR 108
000100
000100
000100
000100
000100
000100
000110
000000
CHAR 109
000000
000000
011010
010101
010101
010001
010001
000000
CHAR 110
000000
000000
011100
010010
010010
010010
010010
000000
CHAR 111
000000
000000
001110
010001
010001
010001
001110
000000
CHAR 112
000000
000000
011110
010001
010001
010001
011110
010000
CHAR 113
000000
000000
001111
010001
010001
010001
001111
000001
CHAR 114
000000
000000
010110
001001
001000
001000
011100
000000
CHAR 115
000000
000000
001110
010000
001110
000001
001110
000000
CHAR 116
000000
001000
011110
001000
001000
001010
000100
000000
CHAR 117
000000
000000
010010
010010
010010
010110
001010
000000
CHAR 118
000000
000000
010001
010001
010001
001010
000100
000000
CHAR 119
000000
000000
010001
010001
010101
011111
001010
000000
CHAR 120
000000
000000
010010
010010
001100
010010
010010
000000
CHAR 121
000000
000000
010010
010010
010010
001110
000100
011000
CHAR 122
000000
000000
011110
000010
001100
010000
011110
000000
CHAR 123
000110
001000
001000
011000
001000
001000
000110
000000
CHAR 124
000100
000100
000100
000100
000100
000100
000100
000100
CHAR 125
001100
000010
000010
000011
000010
000010
001100
000000
CHAR 126
001010
010100
000000
000000
000000
000000
000000
000000
CHAR 127
000100
001110
011011
010001
010001
011111
000000
000000
CHAR 128
001110
010001
010000
010000
010001
001110
000100
001100
CHAR 129
010010
000000
010010
010010
010010
010110
001010
000000
CHAR 130
000011
000000
001110
010001
011110
010000
001110
000000
CHAR 131
001110
000000
001110
000001
001111
010001
001111
000000
CHAR 132
001010
000000
001110
000001
001111
010001
001111
000000
CHAR 133
001100
000000
001110
000001
001111
010001
001111
000000
CHAR 134
001110
001010
001110
000001
001111
010001
001111
000000
CHAR 135
000000
001110
010001
010000
010001
001110
000100
001100
CHAR 136
001110
000000
001110
010001
011110
010000
001110
000000
CHAR 137
001010
000000
001110
010001
011110
010000
001110
000000
CHAR 138
001100
000000
001110
010001
011110
010000
001110
000000
CHAR 139
001010
000000
000100
000100
000100
000100
000110
000000
CHAR 140
000100
001010
000000
000100
000100
000100
000110
000000
CHAR 141
001000
000000
000100
000100
000100
000100
000110
000000
CHAR 142
001010
000000
000100
001010
010001
011111
010001
000000
CHAR 143
001110
001010
001110
011011
010001
011111
010001
000000
CHAR 144
000011
000000
011111
010000
011110
010000
011111
000000
CHAR 145
000000
000000
011110
000101
011111
010100
001111
000000
CHAR 146
001111
010100
010100
011111
010100
010100
010111
000000
CHAR 147
001110
000000
001100
010010
010010
010010
001100
000000
CHAR 148
001010
000000
001100
010010
010010
010010
001100
000000
CHAR 149
011000
000000
001100
010010
010010
010010
001100
000000
CHAR 150
001110
000000
010010
010010
010010
010110
001010
000000
CHAR 151
011000
000000
010010
010010
010010
010110
001010
000000
CHAR 152
001010
000000
010010
010010
010010
001110
000100
011000
CHAR 153
010010
001100
010010
010010
010010
010010
001100
000000
CHAR 154
001010
000000
010010
010010
010010
010010
001100
000000
CHAR 155
000000
000100
001110
010000
010000
001110
000100
000000
CHAR 156
000110
001001
001000
011110
001000
001001
010111
000000
CHAR 157
010001
001010
000100
011111
000100
011111
000100
000000
CHAR 158
011000
010100
010100
011010
010111
010010
010010
000000
CHAR 159
000010
000101
000100
001110
000100
000100
010100
001000
CHAR 160
000110
000000
001110
000001
001111
010001
001111
000000
CHAR 161
000110
000000
000100
000100
000100
000100
000110
000000
CHAR 162
000110
000000
001100
010010
010010
010010
001100
000000
CHAR 163
000110
000000
010010
010010
010010
010110
001010
000000
CHAR 164
001010
010100
000000
011100
010010
010010
010010
000000
CHAR 165
001010
010100
000000
010010
011010
010110
010010
000000
CHAR 166
001110
000001
001111
010001
001111
000000
001111
000000
CHAR 167
001100
010010
010010
010010
001100
000000
011110
000000
CHAR 168
000100
000000
000100
001100
010000
010001
001110
000000
CHAR 169
000000
000000
011111
010000
010000
010000
000000
000000
CHAR 170
000000
000000
111111
000001
000001
000000
000000
000000
CHAR 171
010000
010010
010100
001110
010001
000010
000111
000000
CHAR 172
010000
010010
010100
001011
010101
000111
000001
000000
CHAR 173
000100
000000
000100
000100
001110
001110
000100
000000
CHAR 174
000000
000000
001001
010010
001001
000000
000000
000000
CHAR 175
000000
000000
010010
001001
010010
000000
000000
000000
CHAR 176
010101
000000
101010
000000
010101
000000
101010
000000
CHAR 177
010101
101010
010101
101010
010101
101010
010101
101010
CHAR 178
101010
111111
010101
111111
101010
111111
010101
111111
CHAR 179
000100
000100
000100
000100
000100
000100
000100
000100
CHAR 180
000100
000100
000100
111100
000100
000100
000100
000100
CHAR 181
000000
000000
010010
010010
010010
011100
010000
010000
CHAR 182
010100
010100
010100
110100
010100
010100
010100
010100
CHAR 183
000000
000000
000000
111100
010100
010100
010100
010100
CHAR 184
000000
111100
000100
111100
000100
000100
000100
000100
CHAR 185
010100
110100
000100
110100
010100
010100
010100
010100
CHAR 186
010100
010100
010100
010100
010100
010100
010100
010100
CHAR 187
000000
111100
000100
110100
010100
010100
010100
010100
CHAR 188
010100
110100
000100
111100
000000
000000
000000
000000
CHAR 189
010100
010100
010100
111100
000000
000000
000000
000000
CHAR 190
000100
111100
000100
111100
000000
000000
000000
000000
CHAR 191
000000
000000
000000
111100
000100
000100
000100
000100
CHAR 192
000100
000100
000100
000111
000000
000000
000000
000000
CHAR 193
000100
000100
000100
111111
000000
000000
000000
000000
CHAR 194
000000
000000
000000
111111
000100
000100
000100
000100
CHAR 195
000100
000100
000100
000111
000100
000100
000100
000100
CHAR 196
000000
000000
000000
111111
000000
000000
000000
000000
CHAR 197
000100
000100
000100
111111
000100
000100
000100
000100
CHAR 198
000100
000111
000100
000111
000100
000100
000100
000100
CHAR 199
010100
010100
010100
010111
010100
010100
010100
010100
CHAR 200
010100
010111
010000
011111
000000
000000
000000
000000
CHAR 201
000000
011111
010000
010111
010100
010100
010100
010100
CHAR 202
010100
110111
000000
111111
000000
000000
000000
000000
CHAR 203
000000
111111
000000
110111
010100
010100
010100
010100
CHAR 204
010100
010111
010000
010111
010100
010100
010100
010100
CHAR 205
000000
111111
000000
111111
000000
000000
000000
000000
CHAR 206
010100
110111
000000
110111
010100
010100
010100
010100
CHAR 207
000100
111111
000000
111111
000000
000000
000000
000000
CHAR 208
010100
010100
010100
111111
000000
000000
000000
000000
CHAR 209
000000
111111
000000
111111
000100
000100
000100
000100
CHAR 210
000000
000000
000000
111111
010100
010100
010100
010100
CHAR 211
010100
010100
010100
011111
000000
000000
000000
000000
CHAR 212
000000
000000
000000
000000
000000
000000
000000
111111
CHAR 213
000000
000000
000000
000000
000000
000000
111111
111111
CHAR 214
000000
000000
000000
000000
000000
111111
111111
111111
CHAR 215
000000
000000
000000
000000
111111
111111
111111
111111
CHAR 216
000000
000000
000000
111111
111111
111111
111111
111111
CHAR 217
000000
000000
111111
111111
111111
111111
111111
111111
CHAR 218
000000
111111
111111
111111
111111
111111
111111
111111
CHAR 219
111111
111111
111111
111111
111111
111111
111111
111111
CHAR 220
100000
100000
100000
100000
100000
100000
100000
100000
CHAR 221
110000
110000
110000
110000
110000
110000
110000
110000
CHAR 222
111000
111000
111000
111000
111000
111000
111000
111000
CHAR 223
111100
111100
111100
111100
111100
111100
111100
111100
CHAR 224
111110
111110
111110
111110
111110
111110
111110
111110
CHAR 225
000000
011100
010010
011100
010010
010010
011100
010000
CHAR 226
011110
010010
010000
010000
010000
010000
010000
000000
CHAR 227
000000
011111
001010
001010
001010
001010
001010
000000
CHAR 228
001010
000000
001110
000001
001111
010001
001111
000000
CHAR 229
000000
000000
001111
010010
010010
001100
000000
000000
CHAR 230
000000
000000
010010
010010
010010
011100
010000
010000
CHAR 231
000000
000000
001010
010100
000100
000100
000100
000000
CHAR 232
001110
000100
001110
010001
001110
000100
001110
000000
CHAR 233
001100
010010
010010
011110
010010
010010
001100
000000
CHAR 234
000000
001110
010001
010001
001010
001010
011011
000000
CHAR 235
001100
010000
001000
000100
001110
010010
001100
000000
CHAR 236
000000
000000
001010
010101
010101
001010
000000
000000
CHAR 237
000000
000100
001110
010101
010101
001110
000100
000000
CHAR 238
000000
001110
010000
011110
010000
001110
000000
000000
CHAR 239
000000
001100
010010
010010
010010
010010
000000
000000
CHAR 240
000000
011110
000000
011110
000000
011110
000000
000000
CHAR 241
000000
000100
001110
000100
000000
001110
000000
000000
CHAR 242
010000
001100
000010
001100
010000
000000
011110
000000
CHAR 243
000000
000000
111111
111000
100110
100001
100000
111111
CHAR 244
000000
000000
111111
000111
011001
100001
000001
111111
CHAR 245
000100
000100
000100
000100
000100
010100
001000
000000
CHAR 246
001010
000000
001110
010001
010001
010001
001110
000000
CHAR 247
111110
111110
111110
111110
111110
111110
111110
111110
CHAR 248
111100
111100
111100
111100
111100
111100
111100
111100
CHAR 249
111000
111000
111000
111000
111000
111000
111000
111000
CHAR 250
110000
110000
110000
110000
110000
110000
110000
110000
CHAR 251
100000
100000
100000
100000
100000
100000
100000
100000
CHAR 252
001010
000000
010010
010010
010010
010110
001010
000000
CHAR 253
011000
000100
001000
011100
000000
000000
000000
000000
CHAR 254
000000
000000
000000
011110
110010
110011
111110
001111
CHAR 255
010010
111111
010010
010010
111111
010010
000000
000000
</script>

</head>


<!-- DOCUMENT BODY -->
<body onload='startExportedGame()'>
	<!-- GAME CANVAS -->
	<canvas id='game'></canvas>
</body>


</html>